<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TREDING STORE - Exchange | Investment | NFT</title>
    
    <!-- Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --black: #0a0a0a;
            --dark-gray: #1a1a1a;
            --darker-gray: #2d2d2d;
            --gold: #ffd700;
            --light-gold: #ffed4e;
            --yellow: #ffc107;
            --text-gray: #cccccc;
            --white: #ffffff;
            --red: #ff4444;
            --green: #00c851;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--black);
            color: var(--text-gray);
            overflow-x: hidden;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: var(--dark-gray);
        }
        ::-webkit-scrollbar-thumb {
            background: var(--gold);
            border-radius: 4px;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, var(--dark-gray) 0%, var(--black) 100%);
            border-bottom: 2px solid var(--gold);
            padding: 1rem 2rem;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 20px rgba(255, 215, 0, 0.1);
        }

        .logo {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--gold);
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
            letter-spacing: 2px;
        }

        .logo span {
            color: var(--white);
        }

        .nav-menu {
            display: flex;
            gap: 2rem;
            list-style: none;
        }

        .nav-menu a {
            color: var(--text-gray);
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            position: relative;
        }

        .nav-menu a:hover, .nav-menu a.active {
            color: var(--gold);
            background: rgba(255, 215, 0, 0.1);
        }

        .nav-menu a::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 2px;
            background: var(--gold);
            transition: width 0.3s;
        }

        .nav-menu a:hover::after, .nav-menu a.active::after {
            width: 80%;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .balance-display {
            background: rgba(255, 215, 0, 0.1);
            border: 1px solid var(--gold);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            color: var(--gold);
            font-weight: bold;
        }

        .btn {
            padding: 0.5rem 1.5rem;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-gold {
            background: linear-gradient(135deg, var(--gold) 0%, var(--yellow) 100%);
            color: var(--black);
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
        }

        .btn-gold:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 215, 0, 0.5);
        }

        .btn-dark {
            background: transparent;
            border: 1px solid var(--gold);
            color: var(--gold);
        }

        .btn-dark:hover {
            background: rgba(255, 215, 0, 0.1);
        }

        /* Main Container */
        .main-container {
            margin-top: 80px;
            padding: 2rem;
            min-height: calc(100vh - 80px);
        }

        .section {
            display: none;
            animation: fadeIn 0.5s;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Cards */
        .card {
            background: linear-gradient(135deg, var(--dark-gray) 0%, var(--darker-gray) 100%);
            border: 1px solid rgba(255, 215, 0, 0.2);
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            transition: transform 0.3s;
        }

        .card:hover {
            transform: translateY(-5px);
            border-color: var(--gold);
        }

        .card-header {
            border-bottom: 1px solid rgba(255, 215, 0, 0.2);
            padding-bottom: 1rem;
            margin-bottom: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-title {
            color: var(--gold);
            font-size: 1.3rem;
            font-weight: bold;
        }

        /* Grid Systems */
        .grid-3 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 1.5rem;
        }

        /* Forms */
        .form-group {
            margin-bottom: 1rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--gold);
            font-weight: 500;
        }

        .form-input {
            width: 100%;
            padding: 0.8rem;
            background: var(--black);
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 8px;
            color: var(--white);
            transition: all 0.3s;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--gold);
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.2);
        }

        select.form-input {
            cursor: pointer;
        }

        /* Tables */
        .table-container {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            background: rgba(255, 215, 0, 0.1);
            color: var(--gold);
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid var(--gold);
        }

        td {
            padding: 1rem;
            border-bottom: 1px solid rgba(255, 215, 0, 0.1);
        }

        tr:hover {
            background: rgba(255, 215, 0, 0.05);
        }

        /* Status Badges */
        .badge {
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .badge-pending {
            background: rgba(255, 193, 7, 0.2);
            color: var(--yellow);
            border: 1px solid var(--yellow);
        }

        .badge-approved {
            background: rgba(0, 200, 81, 0.2);
            color: var(--green);
            border: 1px solid var(--green);
        }

        .badge-rejected {
            background: rgba(255, 68, 68, 0.2);
            color: var(--red);
            border: 1px solid var(--red);
        }

        /* Login Section */
        #loginSection {
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background: radial-gradient(circle at center, var(--dark-gray) 0%, var(--black) 100%);
        }

        .login-box {
            background: linear-gradient(135deg, var(--dark-gray) 0%, var(--darker-gray) 100%);
            border: 2px solid var(--gold);
            border-radius: 20px;
            padding: 3rem;
            width: 100%;
            max-width: 450px;
            box-shadow: 0 20px 60px rgba(255, 215, 0, 0.2);
            text-align: center;
        }

        .login-box h2 {
            color: var(--gold);
            margin-bottom: 2rem;
            font-size: 2rem;
        }

        .social-login {
            margin-top: 1rem;
        }

        /* NFT Cards */
        .nft-card {
            background: linear-gradient(135deg, var(--dark-gray) 0%, #1f1f1f 100%);
            border-radius: 15px;
            overflow: hidden;
            border: 1px solid rgba(255, 215, 0, 0.2);
            transition: all 0.3s;
        }

        .nft-card:hover {
            transform: scale(1.02);
            border-color: var(--gold);
            box-shadow: 0 10px 30px rgba(255, 215, 0, 0.2);
        }

        .nft-image {
            width: 100%;
            height: 250px;
            object-fit: cover;
            border-bottom: 2px solid var(--gold);
        }

        .nft-info {
            padding: 1.5rem;
        }

        .nft-title {
            color: var(--gold);
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
        }

        .nft-price {
            color: var(--white);
            font-size: 1.5rem;
            font-weight: bold;
            margin: 1rem 0;
        }

        .nft-price span {
            color: var(--text-gray);
            font-size: 0.9rem;
        }

        /* Investment Cards */
        .investment-card {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.1) 0%, var(--dark-gray) 100%);
            border: 2px solid var(--gold);
            border-radius: 15px;
            padding: 2rem;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .investment-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 215, 0, 0.1) 0%, transparent 70%);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .investment-card:hover::before {
            opacity: 1;
        }

        .investment-returns {
            font-size: 2.5rem;
            color: var(--gold);
            font-weight: bold;
            margin: 1rem 0;
        }

        .investment-duration {
            color: var(--text-gray);
            margin-bottom: 1rem;
        }

        /* Exchange Order Book */
        .order-book {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .order-list {
            background: var(--black);
            border-radius: 10px;
            padding: 1rem;
            max-height: 400px;
            overflow-y: auto;
        }

        .order-item {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem;
            margin-bottom: 0.5rem;
            border-radius: 5px;
            font-size: 0.9rem;
        }

        .buy-order {
            background: rgba(0, 200, 81, 0.1);
            color: var(--green);
        }

        .sell-order {
            background: rgba(255, 68, 68, 0.1);
            color: var(--red);
        }

        /* Admin Panel Specifics */
        .admin-grid {
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: 2rem;
        }

        .admin-sidebar {
            background: var(--dark-gray);
            border-radius: 15px;
            padding: 1.5rem;
            border: 1px solid rgba(255, 215, 0, 0.2);
            height: fit-content;
        }

        .admin-nav {
            list-style: none;
        }

        .admin-nav li {
            margin-bottom: 0.5rem;
        }

        .admin-nav a {
            display: block;
            padding: 1rem;
            color: var(--text-gray);
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.3s;
        }

        .admin-nav a:hover, .admin-nav a.active {
            background: rgba(255, 215, 0, 0.1);
            color: var(--gold);
            border-left: 4px solid var(--gold);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: linear-gradient(135deg, var(--dark-gray) 0%, var(--darker-gray) 100%);
            border: 2px solid var(--gold);
            border-radius: 20px;
            padding: 2rem;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }

        .modal-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gold);
            background: none;
            border: none;
        }

        /* Image Upload Preview */
        .image-preview {
            width: 100%;
            height: 200px;
            border: 2px dashed var(--gold);
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 1rem;
            overflow: hidden;
            background: var(--black);
        }

        .image-preview img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        /* Copyright */
        .copyright {
            text-align: center;
            padding: 2rem;
            color: var(--gold);
            border-top: 1px solid rgba(255, 215, 0, 0.2);
            margin-top: 2rem;
            font-size: 0.9rem;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .nav-menu {
                display: none;
            }
            .admin-grid {
                grid-template-columns: 1fr;
            }
            .grid-2, .grid-3 {
                grid-template-columns: 1fr;
            }
        }

        /* Loading Spinner */
        .spinner {
            border: 4px solid rgba(255, 215, 0, 0.1);
            border-left-color: var(--gold);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--dark-gray);
            border: 1px solid var(--gold);
            color: var(--gold);
            padding: 1rem 2rem;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
            z-index: 3000;
            transform: translateX(400px);
            transition: transform 0.3s;
        }

        .toast.show {
            transform: translateX(0);
        }
    </style>
</head>
<body>

    <!-- Login Section -->
    <div id="loginSection">
        <div class="login-box">
            <h2><i class="fas fa-crown"></i> TREDING STORE</h2>
            <p style="margin-bottom: 2rem; color: var(--text-gray);">Exchange | Investment | NFT Marketplace</p>
            
            <div class="form-group">
                <input type="email" id="loginEmail" class="form-input" placeholder="Email Address">
            </div>
            
            <div class="form-group">
                <input type="password" id="loginPassword" class="form-input" placeholder="Password">
            </div>

            <button class="btn btn-gold" style="width: 100%; margin-bottom: 1rem;" onclick="loginWithEmail()">
                <i class="fas fa-envelope"></i> Login with Email
            </button>

            <button class="btn btn-dark" style="width: 100%;" onclick="loginWithGoogle()">
                <i class="fab fa-google"></i> Login with Google
            </button>

            <div style="margin-top: 1.5rem; font-size: 0.9rem;">
                <p>Don't have an account? <a href="#" onclick="showSignup()" style="color: var(--gold);">Sign Up</a></p>
            </div>

            <div class="copyright" style="border: none; margin-top: 2rem; padding: 0;">
                © SQL 2021
            </div>
        </div>
    </div>

    <!-- Signup Modal -->
    <div id="signupModal" class="modal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeSignup()"><i class="fas fa-times"></i></button>
            <h2 style="color: var(--gold); margin-bottom: 1.5rem;">Create Account</h2>
            
            <div class="form-group">
                <label class="form-label">Full Name</label>
                <input type="text" id="signupName" class="form-input" placeholder="Your Name">
            </div>

            <div class="form-group">
                <label class="form-label">Email</label>
                <input type="email" id="signupEmail" class="form-input" placeholder="email@example.com">
            </div>

            <div class="form-group">
                <label class="form-label">Password</label>
                <input type="password" id="signupPassword" class="form-input" placeholder="Min 6 characters">
            </div>

            <button class="btn btn-gold" style="width: 100%;" onclick="signup()">
                <i class="fas fa-user-plus"></i> Create Account
            </button>
        </div>
    </div>

    <!-- Main App (Hidden initially) -->
    <div id="mainApp" style="display: none;">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <i class="fas fa-crown"></i> TREDING <span>STORE</span>
            </div>
            
            <ul class="nav-menu">
                <li><a href="#" class="active" onclick="showSection('exchange')"><i class="fas fa-chart-line"></i> Exchange</a></li>
                <li><a href="#" onclick="showSection('investment')"><i class="fas fa-piggy-bank"></i> Investment</a></li>
                <li><a href="#" onclick="showSection('nft')"><i class="fas fa-image"></i> NFT Market</a></li>
                <li><a href="#" onclick="showSection('wallet')"><i class="fas fa-wallet"></i> Wallet</a></li>
                <li id="adminNavItem" style="display: none;"><a href="#" onclick="showSection('admin')"><i class="fas fa-cog"></i> Admin</a></li>
            </ul>

            <div class="user-info">
                <div class="balance-display">
                    <i class="fas fa-rupee-sign"></i> <span id="inrBalance">0</span> | 
                    <i class="fas fa-coins"></i> <span id="usdtBalance">0</span>
                </div>
                <button class="btn btn-dark" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
        </header>

        <div class="main-container">
            <!-- Exchange Section -->
            <div id="exchange" class="section active">
                <div class="grid-2">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title"><i class="fas fa-chart-area"></i> BTC/USDT Trading</div>
                            <span class="badge badge-approved">Live</span>
                        </div>
                        
                        <canvas id="tradingChart" height="200"></canvas>

                        <div style="margin-top: 1.5rem; display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                            <div>
                                <h4 style="color: var(--green); margin-bottom: 0.5rem;">Buy BTC</h4>
                                <div class="form-group">
                                    <input type="number" id="buyAmount" class="form-input" placeholder="Amount (USDT)">
                                </div>
                                <button class="btn btn-gold" style="width: 100%; background: var(--green); color: white;" onclick="placeOrder('buy')">
                                    <i class="fas fa-arrow-up"></i> Buy
                                </button>
                            </div>
                            <div>
                                <h4 style="color: var(--red); margin-bottom: 0.5rem;">Sell BTC</h4>
                                <div class="form-group">
                                    <input type="number" id="sellAmount" class="form-input" placeholder="Amount (BTC)">
                                </div>
                                <button class="btn btn-gold" style="width: 100%; background: var(--red); color: white;" onclick="placeOrder('sell')">
                                    <i class="fas fa-arrow-down"></i> Sell
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <div class="card-title"><i class="fas fa-list"></i> Order Book</div>
                        </div>
                        <div class="order-book">
                            <div>
                                <h4 style="color: var(--green); margin-bottom: 1rem;">Buy Orders</h4>
                                <div class="order-list" id="buyOrders">
                                    <div class="order-item buy-order">
                                        <span>28,450.00</span>
                                        <span>0.542 BTC</span>
                                    </div>
                                    <div class="order-item buy-order">
                                        <span>28,440.00</span>
                                        <span>1.200 BTC</span>
                                    </div>
                                    <div class="order-item buy-order">
                                        <span>28,430.00</span>
                                        <span>0.850 BTC</span>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <h4 style="color: var(--red); margin-bottom: 1rem;">Sell Orders</h4>
                                <div class="order-list" id="sellOrders">
                                    <div class="order-item sell-order">
                                        <span>28,460.00</span>
                                        <span>0.300 BTC</span>
                                    </div>
                                    <div class="order-item sell-order">
                                        <span>28,470.00</span>
                                        <span>0.750 BTC</span>
                                    </div>
                                    <div class="order-item sell-order">
                                        <span>28,480.00</span>
                                        <span>1.100 BTC</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-title"><i class="fas fa-history"></i> Recent Trades</div>
                    </div>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Time</th>
                                    <th>Pair</th>
                                    <th>Type</th>
                                    <th>Price</th>
                                    <th>Amount</th>
                                    <th>Total</th>
                                </tr>
                            </thead>
                            <tbody id="tradeHistory">
                                <tr>
                                    <td>10:45:22</td>
                                    <td>BTC/USDT</td>
                                    <td style="color: var(--green);">Buy</td>
                                    <td>28,450.00</td>
                                    <td>0.100</td>
                                    <td>2,845.00</td>
                                </tr>
                                <tr>
                                    <td>10:42:15</td>
                                    <td>BTC/USDT</td>
                                    <td style="color: var(--red);">Sell</td>
                                    <td>28,460.00</td>
                                    <td>0.050</td>
                                    <td>1,423.00</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Investment Section -->
            <div id="investment" class="section">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title"><i class="fas fa-rocket"></i> Investment Plans</div>
                        <span style="color: var(--gold);">Choose your plan and earn daily returns</span>
                    </div>
                </div>

                <div class="grid-3" id="investmentPlans">
                    <!-- Investment cards will be loaded here dynamically -->
                    <div class="investment-card">
                        <h3 style="color: var(--white);">Starter Plan</h3>
                        <div class="investment-returns">0.5% <small style="font-size: 1rem;">Daily</small></div>
                        <div class="investment-duration">Min: ₹1,000 | Max: ₹50,000</div>
                        <div style="color: var(--text-gray); margin-bottom: 1rem;">Duration: 30 Days</div>
                        <button class="btn btn-gold" onclick="invest('starter')">Invest Now</button>
                    </div>

                    <div class="investment-card">
                        <h3 style="color: var(--white);">Pro Plan</h3>
                        <div class="investment-returns">1.0% <small style="font-size: 1rem;">Daily</small></div>
                        <div class="investment-duration">Min: ₹50,000 | Max: ₹5,00,000</div>
                        <div style="color: var(--text-gray); margin-bottom: 1rem;">Duration: 60 Days</div>
                        <button class="btn btn-gold" onclick="invest('pro')">Invest Now</button>
                    </div>

                    <div class="investment-card">
                        <h3 style="color: var(--white);">VIP Plan</h3>
                        <div class="investment-returns">1.5% <small style="font-size: 1rem;">Daily</small></div>
                        <div class="investment-duration">Min: ₹5,00,000 | Max: Unlimited</div>
                        <div style="color: var(--text-gray); margin-bottom: 1rem;">Duration: 90 Days</div>
                        <button class="btn btn-gold" onclick="invest('vip')">Invest Now</button>
                    </div>
                </div>

                <div class="card" style="margin-top: 2rem;">
                    <div class="card-header">
                        <div class="card-title"><i class="fas fa-history"></i> My Investments</div>
                    </div>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Plan</th>
                                    <th>Amount (INR)</th>
                                    <th>Daily Return</th>
                                    <th>Total Return</th>
                                    <th>Start Date</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="myInvestments">
                                <tr>
                                    <td colspan="6" style="text-align: center; color: var(--text-gray);">
                                        No active investments. Start earning today!
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- NFT Section -->
            <div id="nft" class="section">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title"><i class="fas fa-palette"></i> NFT Marketplace</div>
                        <div>
                            <button class="btn btn-dark" onclick="showMyNFTs()">My Collection</button>
                            <button class="btn btn-gold" onclick="openCreateNFT()">Create NFT</button>
                        </div>
                    </div>
                </div>

                <div class="grid-3" id="nftMarket">
                    <!-- NFTs will be loaded here -->
                </div>
            </div>

            <!-- Wallet Section -->
            <div id="wallet" class="section">
                <div class="grid-2">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title"><i class="fas fa-wallet"></i> Deposit Funds</div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Select Currency</label>
                            <select id="depositCurrency" class="form-input" onchange="updateDepositInfo()">
                                <option value="INR">INR (Indian Rupee)</option>
                                <option value="USDT">USDT (Tether)</option>
                            </select>
                        </div>

                        <div id="depositInfo" class="card" style="background: rgba(255, 215, 0, 0.05);">
                            <h4 style="color: var(--gold); margin-bottom: 1rem;">Deposit Details</h4>
                            <div id="upiDetails" style="display: block;">
                                <p style="margin-bottom: 0.5rem;"><strong>UPI ID:</strong> <span id="adminUpiId" style="color: var(--gold); font-size: 1.2rem;">Loading...</span></p>
                                <p style="font-size: 0.9rem; color: var(--text-gray); margin-bottom: 1rem;">
                                    Send money via Google Pay, PhonePe, or any UPI app to above ID
                                </p>
                            </div>
                            <div id="usdtDetails" style="display: none;">
                                <p style="margin-bottom: 0.5rem;"><strong>USDT Address (TRC20):</strong></p>
                                <p id="adminUsdtAddress" style="color: var(--gold); font-size: 0.9rem; word-break: break-all; margin-bottom: 1rem;">Loading...</p>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Amount</label>
                            <input type="number" id="depositAmount" class="form-input" placeholder="Enter amount">
                        </div>

                        <div class="form-group">
                            <label class="form-label">Transaction Screenshot / Reference</label>
                            <div class="image-preview" id="depositPreview" onclick="document.getElementById('depositImage').click()">
                                <span style="color: var(--text-gray);"><i class="fas fa-cloud-upload-alt"></i> Click to upload proof</span>
                            </div>
                            <input type="file" id="depositImage" style="display: none;" accept="image/*" onchange="previewImage(this, 'depositPreview')">
                        </div>

                        <button class="btn btn-gold" style="width: 100%;" onclick="submitDeposit()">
                            <i class="fas fa-paper-plane"></i> Submit Deposit Request
                        </button>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <div class="card-title"><i class="fas fa-money-bill-wave"></i> Withdraw Funds</div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Select Currency</label>
                            <select id="withdrawCurrency" class="form-input">
                                <option value="INR">INR (Bank/UPI)</option>
                                <option value="USDT">USDT (Crypto Wallet)</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Amount</label>
                            <input type="number" id="withdrawAmount" class="form-input" placeholder="Enter amount">
                        </div>

                        <div class="form-group" id="withdrawUpiField">
                            <label class="form-label">UPI ID / Bank Details</label>
                            <input type="text" id="withdrawAddress" class="form-input" placeholder="yourname@upi">
                        </div>

                        <button class="btn btn-gold" style="width: 100%; background: var(--red);" onclick="submitWithdrawal()">
                            <i class="fas fa-arrow-right"></i> Request Withdrawal
                        </button>
                    </div>
                </div>

                <div class="card" style="margin-top: 2rem;">
                    <div class="card-header">
                        <div class="card-title"><i class="fas fa-list-alt"></i> Transaction History</div>
                    </div>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Type</th>
                                    <th>Method</th>
                                    <th>Amount</th>
                                    <th>Status</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody id="transactionHistory">
                                <!-- Transactions loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Admin Section -->
            <div id="admin" class="section">
                <div class="admin-grid">
                    <div class="admin-sidebar">
                        <h3 style="color: var(--gold); margin-bottom: 1.5rem;"><i class="fas fa-cog"></i> Admin Panel</h3>
                        <ul class="admin-nav">
                            <li><a href="#" class="active" onclick="showAdminTab('depositSettings')"><i class="fas fa-university"></i> Payment Settings</a></li>
                            <li><a href="#" onclick="showAdminTab('pendingDeposits')"><i class="fas fa-arrow-down"></i> Pending Deposits</a></li>
                            <li><a href="#" onclick="showAdminTab('pendingWithdrawals')"><i class="fas fa-arrow-up"></i> Pending Withdrawals</a></li>
                            <li><a href="#" onclick="showAdminTab('manageInvestments')"><i class="fas fa-piggy-bank"></i> Investment Plans</a></li>
                            <li><a href="#" onclick="showAdminTab('manageNFTs')"><i class="fas fa-images"></i> Manage NFTs</a></li>
                            <li><a href="#" onclick="showAdminTab('userManagement')"><i class="fas fa-users"></i> Users</a></li>
                        </ul>
                    </div>

                    <div>
                        <!-- Deposit Settings -->
                        <div id="depositSettings" class="admin-tab active">
                            <div class="card">
                                <div class="card-header">
                                    <div class="card-title">Payment Gateway Settings</div>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">Active UPI ID (for INR deposits)</label>
                                    <input type="text" id="settingsUpi" class="form-input" placeholder="admin@upi">
                                </div>

                                <div class="form-group">
                                    <label class="form-label">USDT Deposit Address (TRC20)</label>
                                    <input type="text" id="settingsUsdt" class="form-input" placeholder="TRX address...">
                                </div>

                                <button class="btn btn-gold" onclick="savePaymentSettings()">
                                    <i class="fas fa-save"></i> Save Settings
                                </button>
                            </div>
                        </div>

                        <!-- Pending Deposits -->
                        <div id="pendingDeposits" class="admin-tab" style="display: none;">
                            <div class="card">
                                <div class="card-header">
                                    <div class="card-title">Pending Deposit Requests</div>
                                </div>
                                <div class="table-container">
                                    <table>
                                        <thead>
                                            <tr>
                                                <th>User</th>
                                                <th>Method</th>
                                                <th>Amount</th>
                                                <th>Proof</th>
                                                <th>Date</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="adminDepositsTable">
                                            <!-- Populated dynamically -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <!-- Pending Withdrawals -->
                        <div id="pendingWithdrawals" class="admin-tab" style="display: none;">
                            <div class="card">
                                <div class="card-header">
                                    <div class="card-title">Pending Withdrawal Requests</div>
                                </div>
                                <div class="table-container">
                                    <table>
                                        <thead>
                                            <tr>
                                                <th>User</th>
                                                <th>Method</th>
                                                <th>Amount</th>
                                                <th>Destination</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="adminWithdrawalsTable">
                                            <!-- Populated dynamically -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <!-- Manage Investments -->
                        <div id="manageInvestments" class="admin-tab" style="display: none;">
                            <div class="card">
                                <div class="card-header">
                                    <div class="card-title">Create Investment Plan</div>
                                </div>
                                
                                <div class="grid-2">
                                    <div class="form-group">
                                        <label class="form-label">Plan Name</label>
                                        <input type="text" id="planName" class="form-input" placeholder="e.g., Gold Plan">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Daily Return (%)</label>
                                        <input type="number" id="planReturn" class="form-input" placeholder="e.g., 1.5" step="0.1">
                                    </div>
                                </div>

                                <div class="grid-2">
                                    <div class="form-group">
                                        <label class="form-label">Min Amount (INR)</label>
                                        <input type="number" id="planMin" class="form-input" placeholder="1000">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Max Amount (INR)</label>
                                        <input type="number" id="planMax" class="form-input" placeholder="100000">
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="form-label">Duration (Days)</label>
                                    <input type="number" id="planDuration" class="form-input" placeholder="30">
                                </div>

                                <button class="btn btn-gold" onclick="createInvestmentPlan()">
                                    <i class="fas fa-plus"></i> Create Plan
                                </button>
                            </div>

                            <div class="card" style="margin-top: 1rem;">
                                <div class="card-header">
                                    <div class="card-title">Existing Plans</div>
                                </div>
                                <div id="adminPlansList" class="grid-3">
                                    <!-- Plans listed here -->
                                </div>
                            </div>
                        </div>

                        <!-- Manage NFTs -->
                        <div id="manageNFTs" class="admin-tab" style="display: none;">
                            <div class="card">
                                <div class="card-header">
                                    <div class="card-title">Mint New NFT</div>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">NFT Name</label>
                                    <input type="text" id="nftName" class="form-input" placeholder="Artwork name">
                                </div>

                                <div class="form-group">
                                    <label class="form-label">Description</label>
                                    <textarea id="nftDesc" class="form-input" rows="3" placeholder="Description..."></textarea>
                                </div>

                                <div class="grid-2">
                                    <div class="form-group">
                                        <label class="form-label">Price (INR)</label>
                                        <input type="number" id="nftPriceInr" class="form-input" placeholder="0">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Price (USDT)</label>
                                        <input type="number" id="nftPriceUsdt" class="form-input" placeholder="0">
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="form-label">Upload Image</label>
                                    <div class="image-preview" id="nftPreview" onclick="document.getElementById('nftImage').click()">
                                        <span style="color: var(--text-gray);"><i class="fas fa-image"></i> Click to upload NFT image</span>
                                    </div>
                                    <input type="file" id="nftImage" style="display: none;" accept="image/*" onchange="previewImage(this, 'nftPreview')">
                                </div>

                                <button class="btn btn-gold" onclick="createNFT()">
                                    <i class="fas fa-hammer"></i> Mint NFT
                                </button>
                            </div>

                            <div class="card" style="margin-top: 1rem;">
                                <div class="card-header">
                                    <div class="card-title">Manage Existing NFTs</div>
                                </div>
                                <div id="adminNFTList" class="grid-3">
                                    <!-- Admin NFT management -->
                                </div>
                            </div>
                        </div>

                        <!-- User Management -->
                        <div id="userManagement" class="admin-tab" style="display: none;">
                            <div class="card">
                                <div class="card-header">
                                    <div class="card-title">All Users</div>
                                </div>
                                <div class="table-container">
                                    <table>
                                        <thead>
                                            <tr>
                                                <th>Email</th>
                                                <th>Name</th>
                                                <th>INR Balance</th>
                                                <th>USDT Balance</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="usersTable">
                                            <!-- Users loaded here -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="copyright">
                <p>© SQL 2021 | TREDING STORE - Premium Trading Platform</p>
                <p style="font-size: 0.8rem; margin-top: 0.5rem; color: var(--text-gray);">
                    Powered by Open Source Technologies
                </p>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toast" class="toast"></div>

    <script>
        // ==========================================
        // CONFIGURATION - YOUR PROVIDED CREDENTIALS
        // ==========================================
        
        // Supabase Config
        const SUPABASE_URL = 'https://pqifnpafmiqntzlgtfkx.supabase.co';
        const SUPABASE_KEY = 'sb_publishable_mdYQ1LM9Xq_b79x8VbeVIw_EeRvJpCX';
        const supabase = supabaseJs.createClient(SUPABASE_URL, SUPABASE_KEY);

        // Firebase Config
        const firebaseConfig = {
            apiKey: "AIzaSyDCHUmML-3xe57TJAiZKSTHouFxIiFHGoE",
            authDomain: "etf-rm.firebaseapp.com",
            projectId: "etf-rm",
            storageBucket: "etf-rm.firebasestorage.app",
            messagingSenderId: "1013121735332",
            appId: "1:1013121735332:web:2665a687123c2a95416431",
            measurementId: "G-D8HR00JZBM"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const auth = firebase.auth();

        // Cloudinary Config
        const CLOUDINARY_CLOUD_NAME = 'debp1kjtm';
        const CLOUDINARY_UPLOAD_PRESET = 'sql_admin';

        // ==========================================
        // GLOBAL STATE
        // ==========================================
        let currentUser = null;
        let isAdmin = false;
        let userBalances = { INR: 0, USDT: 0 };

        // ==========================================
        // AUTHENTICATION FUNCTIONS
        // ==========================================
        
        async function loginWithEmail() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            try {
                const { data, error } = await supabase.auth.signInWithPassword({
                    email: email,
                    password: password
                });
                
                if (error) throw error;
                
                currentUser = data.user;
                await initializeUser();
                showToast('Login successful!', 'success');
            } catch (error) {
                showToast(error.message, 'error');
            }
        }

        async function loginWithGoogle() {
            try {
                const { data, error } = await supabase.auth.signInWithOAuth({
                    provider: 'google',
                    options: {
                        redirectTo: window.location.href
                    }
                });
                
                if (error) throw error;
            } catch (error) {
                showToast(error.message, 'error');
            }
        }

        async function signup() {
            const name = document.getElementById('signupName').value;
            const email = document.getElementById('signupEmail').value;
            const password = document.getElementById('signupPassword').value;
            
            try {
                const { data, error } = await supabase.auth.signUp({
                    email: email,
                    password: password,
                    options: {
                        data: { full_name: name }
                    }
                });
                
                if (error) throw error;
                
                // Create user record in Firebase
                await db.ref('users/' + data.user.id).set({
                    email: email,
                    name: name,
                    balances: { INR: 0, USDT: 0 },
                    created_at: Date.now(),
                    is_admin: false
                });
                
                closeSignup();
                showToast('Account created! Please login.', 'success');
            } catch (error) {
                showToast(error.message, 'error');
            }
        }

        function logout() {
            supabase.auth.signOut();
            currentUser = null;
            location.reload();
        }

        function showSignup() {
            document.getElementById('signupModal').classList.add('active');
        }

        function closeSignup() {
            document.getElementById('signupModal').classList.remove('active');
        }

        // ==========================================
        // INITIALIZATION
        // ==========================================

        async function initializeUser() {
            document.getElementById('loginSection').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            
            // Check if admin
            const userSnapshot = await db.ref('users/' + currentUser.id).once('value');
            const userData = userSnapshot.val() || {};
            
            isAdmin = userData.is_admin || false;
            if (isAdmin) {
                document.getElementById('adminNavItem').style.display = 'block';
            }
            
            // Load balances
            userBalances = userData.balances || { INR: 0, USDT: 0 };
            updateBalanceDisplay();
            
            // Listen for balance changes
            db.ref('users/' + currentUser.id + '/balances').on('value', (snapshot) => {
                userBalances = snapshot.val() || { INR: 0, USDT: 0 };
                updateBalanceDisplay();
            });
            
            // Initialize sections
            initChart();
            loadNFTs();
            loadTransactions();
            if (isAdmin) {
                loadAdminData();
            }
            
            // Check auth state change
            supabase.auth.onAuthStateChange((event, session) => {
                if (event === 'SIGNED_OUT') {
                    location.reload();
                }
            });
        }

        function updateBalanceDisplay() {
            document.getElementById('inrBalance').textContent = userBalances.INR || 0;
            document.getElementById('usdtBalance').textContent = userBalances.USDT || 0;
        }

        // ==========================================
        // NAVIGATION
        // ==========================================

        function showSection(sectionName) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(sec => {
                sec.classList.remove('active');
            });
            
            // Show selected
            document.getElementById(sectionName).classList.add('active');
            
            // Update nav active state
            document.querySelectorAll('.nav-menu a').forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('onclick') && link.getAttribute('onclick').includes(sectionName)) {
                    link.classList.add('active');
                }
            });
            
            // Load section specific data
            if (sectionName === 'nft') loadNFTs();
            if (sectionName === 'wallet') loadTransactions();
            if (sectionName === 'admin') loadAdminData();
        }

        function showAdminTab(tabName) {
            document.querySelectorAll('.admin-tab').forEach(tab => {
                tab.style.display = 'none';
                tab.classList.remove('active');
            });
            document.getElementById(tabName).style.display = 'block';
            document.getElementById(tabName).classList.add('active');
            
            // Update sidebar
            document.querySelectorAll('.admin-nav a').forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('onclick') && link.getAttribute('onclick').includes(tabName)) {
                    link.classList.add('active');
                }
            });
        }

        // ==========================================
        // EXCHANGE FUNCTIONS
        // ==========================================

        function initChart() {
            const ctx = document.getElementById('tradingChart').getContext('2d');
            
            // Generate some mock data
            const labels = [];
            const data = [];
            let price = 28450;
            
            for (let i = 0; i < 24; i++) {
                labels.push(`${i}:00`);
                price = price + (Math.random() - 0.5) * 100;
                data.push(price);
            }
            
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'BTC/USDT',
                        data: data,
                        borderColor: '#ffd700',
                        backgroundColor: 'rgba(255, 215, 0, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: '#ffd700' }
                        }
                    },
                    scales: {
                        y: {
                            grid: { color: 'rgba(255, 215, 0, 0.1)' },
                            ticks: { color: '#cccccc' }
                        },
                        x: {
                            grid: { color: 'rgba(255, 215, 0, 0.1)' },
                            ticks: { color: '#cccccc' }
                        }
                    }
                }
            });
        }

        function placeOrder(type) {
            const amount = type === 'buy' ? 
                document.getElementById('buyAmount').value : 
                document.getElementById('sellAmount').value;
                
            if (!amount || amount <= 0) {
                showToast('Please enter valid amount', 'error');
                return;
            }
            
            // Mock order placement
            showToast(`${type.toUpperCase()} order placed for ${amount}`, 'success');
            
            // Add to trade history (mock)
            const tbody = document.getElementById('tradeHistory');
            const row = tbody.insertRow(0);
            const time = new Date().toLocaleTimeString();
            row.innerHTML = `
                <td>${time}</td>
                <td>BTC/USDT</td>
                <td style="color: ${type === 'buy' ? 'var(--green)' : 'var(--red)'}">${type.toUpperCase()}</td>
                <td>28,450.00</td>
                <td>${(amount / 28450).toFixed(4)}</td>
                <td>${amount}</td>
            `;
        }

        // ==========================================
        // INVESTMENT FUNCTIONS
        // ==========================================

        async function invest(planId) {
            // Show investment modal with amount input
            const amount = prompt('Enter investment amount (INR):');
            if (!amount || amount <= 0) return;
            
            if (parseFloat(amount) > userBalances.INR) {
                showToast('Insufficient INR balance', 'error');
                return;
            }
            
            // Deduct balance
            const newBalance = userBalances.INR - parseFloat(amount);
            await db.ref('users/' + currentUser.id + '/balances/INR').set(newBalance);
            
            // Create investment record
            const investmentData = {
                user_id: currentUser.id,
                plan: planId,
                amount: parseFloat(amount),
                start_date: Date.now(),
                status: 'active',
                returns_paid: 0
            };
            
            await db.ref('investments').push(investmentData);
            showToast('Investment successful!', 'success');
            loadInvestments();
        }

        async function loadInvestments() {
            // Load user's investments
            const snapshot = await db.ref('investments')
                .orderByChild('user_id')
                .equalTo(currentUser.id)
                .once('value');
                
            const investments = snapshot.val() || {};
            const tbody = document.getElementById('myInvestments');
            tbody.innerHTML = '';
            
            Object.entries(investments).forEach(([key, inv]) => {
                const row = tbody.insertRow();
                const dailyReturn = (inv.amount * 0.01).toFixed(2); // Mock 1% daily
                const totalReturn = (inv.returns_paid || 0).toFixed(2);
                
                row.innerHTML = `
                    <td>${inv.plan.toUpperCase()}</td>
                    <td>₹${inv.amount}</td>
                    <td>₹${dailyReturn}</td>
                    <td>₹${totalReturn}</td>
                    <td>${new Date(inv.start_date).toLocaleDateString()}</td>
                    <td><span class="badge badge-approved">${inv.status}</span></td>
                `;
            });
        }

        // ==========================================
        // NFT FUNCTIONS
        // ==========================================

        async function loadNFTs() {
            const snapshot = await db.ref('nfts').once('value');
            const nfts = snapshot.val() || {};
            const container = document.getElementById('nftMarket');
            container.innerHTML = '';
            
            Object.entries(nfts).forEach(([key, nft]) => {
                if (!nft.sold) {
                    const card = document.createElement('div');
                    card.className = 'nft-card';
                    card.innerHTML = `
                        <img src="${nft.image_url}" alt="${nft.name}" class="nft-image">
                        <div class="nft-info">
                            <h3 class="nft-title">${nft.name}</h3>
                            <p style="color: var(--text-gray); font-size: 0.9rem; margin-bottom: 1rem;">
                                ${nft.description?.substring(0, 60)}...
                            </p>
                            <div class="nft-price">
                                ₹${nft.price_inr || 0} <span>|</span> ${nft.price_usdt || 0} USDT
                            </div>
                            <button class="btn btn-gold" style="width: 100%;" onclick="buyNFT('${key}', ${nft.price_inr || 0}, ${nft.price_usdt || 0})">
                                <i class="fas fa-shopping-cart"></i> Buy Now
                            </button>
                        </div>
                    `;
                    container.appendChild(card);
                }
            });
        }

        async function buyNFT(nftId, priceInr, priceUsdt) {
            const currency = confirm('Pay with INR? (Cancel for USDT)') ? 'INR' : 'USDT';
            const price = currency === 'INR' ? priceInr : priceUsdt;
            
            if (userBalances[currency] < price) {
                showToast(`Insufficient ${currency} balance`, 'error');
                return;
            }
            
            // Deduct balance
            const newBalance = userBalances[currency] - price;
            await db.ref('users/' + currentUser.id + '/balances/' + currency).set(newBalance);
            
            // Mark NFT as sold
            await db.ref('nfts/' + nftId).update({
                sold: true,
                owner: currentUser.id,
                bought_at: Date.now()
            });
            
            showToast('NFT purchased successfully!', 'success');
            loadNFTs();
        }

        function openCreateNFT() {
            if (!isAdmin) {
                showToast('Only admin can create NFTs', 'error');
                return;
            }
            showSection('admin');
            showAdminTab('manageNFTs');
        }

        function showMyNFTs() {
            // Filter and show only user's NFTs
            alert('My Collection feature - shows owned NFTs');
        }

        // ==========================================
        // WALLET & TRANSACTION FUNCTIONS
        // ==========================================

        function updateDepositInfo() {
            const currency = document.getElementById('depositCurrency').value;
            document.getElementById('upiDetails').style.display = currency === 'INR' ? 'block' : 'none';
            document.getElementById('usdtDetails').style.display = currency === 'USDT' ? 'block' : 'none';
        }

        async function submitDeposit() {
            const currency = document.getElementById('depositCurrency').value;
            const amount = document.getElementById('depositAmount').value;
            const fileInput = document.getElementById('depositImage');
            
            if (!amount || amount <= 0) {
                showToast('Enter valid amount', 'error');
                return;
            }
            
            if (!fileInput.files[0]) {
                showToast('Please upload payment proof', 'error');
                return;
            }
            
            try {
                // Upload image to Cloudinary
                const formData = new FormData();
                formData.append('file', fileInput.files[0]);
                formData.append('upload_preset', CLOUDINARY_UPLOAD_PRESET);
                
                const response = await fetch(`https://api.cloudinary.com/v1_1/${CLOUDINARY_CLOUD_NAME}/image/upload`, {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                const imageUrl = data.secure_url;
                
                // Save deposit request
                const depositData = {
                    user_id: currentUser.id,
                    user_email: currentUser.email,
                    currency: currency,
                    amount: parseFloat(amount),
                    proof_url: imageUrl,
                    status: 'pending',
                    created_at: Date.now()
                };
                
                await db.ref('deposits').push(depositData);
                
                showToast('Deposit request submitted! Awaiting admin approval.', 'success');
                document.getElementById('depositAmount').value = '';
                document.getElementById('depositPreview').innerHTML = '<span style="color: var(--text-gray);"><i class="fas fa-cloud-upload-alt"></i> Click to upload proof</span>';
                
            } catch (error) {
                showToast('Error submitting deposit: ' + error.message, 'error');
            }
        }

        async function submitWithdrawal() {
            const currency = document.getElementById('withdrawCurrency').value;
            const amount = document.getElementById('withdrawAmount').value;
            const address = document.getElementById('withdrawAddress').value;
            
            if (!amount || amount <= 0 || !address) {
                showToast('Fill all fields', 'error');
                return;
            }
            
            if (userBalances[currency] < parseFloat(amount)) {
                showToast('Insufficient balance', 'error');
                return;
            }
            
            // Freeze the amount (deduct immediately, admin will process)
            const newBalance = userBalances[currency] - parseFloat(amount);
            await db.ref('users/' + currentUser.id + '/balances/' + currency).set(newBalance);
            
            const withdrawalData = {
                user_id: currentUser.id,
                user_email: currentUser.email,
                currency: currency,
                amount: parseFloat(amount),
                destination: address,
                status: 'pending',
                created_at: Date.now()
            };
            
            await db.ref('withdrawals').push(withdrawalData);
            showToast('Withdrawal request submitted!', 'success');
            
            document.getElementById('withdrawAmount').value = '';
            document.getElementById('withdrawAddress').value = '';
        }

        async function loadTransactions() {
            // Load user's transactions
            const depositsSnap = await db.ref('deposits')
                .orderByChild('user_id')
                .equalTo(currentUser.id)
                .once('value');
                
            const withdrawalsSnap = await db.ref('withdrawals')
                .orderByChild('user_id')
                .equalTo(currentUser.id)
                .once('value');
                
            const tbody = document.getElementById('transactionHistory');
            tbody.innerHTML = '';
            
            // Combine and sort
            const transactions = [];
            
            depositsSnap.forEach(child => {
                const val = child.val();
                transactions.push({
                    type: 'Deposit',
                    method: val.currency,
                    amount: val.amount,
                    status: val.status,
                    date: val.created_at,
                    id: child.key
                });
            });
            
            withdrawalsSnap.forEach(child => {
                const val = child.val();
                transactions.push({
                    type: 'Withdrawal',
                    method: val.currency,
                    amount: val.amount,
                    status: val.status,
                    date: val.created_at,
                    id: child.key
                });
            });
            
            transactions.sort((a, b) => b.date - a.date);
            
            transactions.forEach(tx => {
                const row = tbody.insertRow();
                const statusClass = tx.status === 'approved' ? 'badge-approved' : 
                                  tx.status === 'rejected' ? 'badge-rejected' : 'badge-pending';
                
                row.innerHTML = `
                    <td>${new Date(tx.date).toLocaleString()}</td>
                    <td>${tx.type}</td>
                    <td>${tx.method}</td>
                    <td>${tx.amount}</td>
                    <td><span class="badge ${statusClass}">${tx.status}</span></td>
                    <td>-</td>
                `;
            });
        }

        // ==========================================
        // ADMIN FUNCTIONS
        // ==========================================

        async function loadAdminData() {
            // Load payment settings
            const settingsSnap = await db.ref('settings').once('value');
            const settings = settingsSnap.val() || {};
            
            document.getElementById('settingsUpi').value = settings.upi_id || '';
            document.getElementById('settingsUsdt').value = settings.usdt_address || '';
            
            // Update user deposit info display
            document.getElementById('adminUpiId').textContent = settings.upi_id || 'Not set';
            document.getElementById('adminUsdtAddress').textContent = settings.usdt_address || 'Not set';
            
            // Load pending deposits
            const depositsSnap = await db.ref('deposits')
                .orderByChild('status')
                .equalTo('pending')
                .once('value');
                
            const depositsTbody = document.getElementById('adminDepositsTable');
            depositsTbody.innerHTML = '';
            
            depositsSnap.forEach(child => {
                const val = child.val();
                const row = depositsTbody.insertRow();
                row.innerHTML = `
                    <td>${val.user_email}</td>
                    <td>${val.currency}</td>
                    <td>${val.amount}</td>
                    <td><a href="${val.proof_url}" target="_blank" style="color: var(--gold);">View Proof</a></td>
                    <td>${new Date(val.created_at).toLocaleDateString()}</td>
                    <td>
                        <button class="btn btn-gold" style="padding: 0.3rem 0.8rem; font-size: 0.8rem;" onclick="processDeposit('${child.key}', '${val.user_id}', ${val.amount}, '${val.currency}', 'approved')">
                            <i class="fas fa-check"></i>
                        </button>
                        <button class="btn btn-dark" style="padding: 0.3rem 0.8rem; font-size: 0.8rem; background: var(--red);" onclick="processDeposit('${child.key}', '${val.user_id}', ${val.amount}, '${val.currency}', 'rejected')">
                            <i class="fas fa-times"></i>
                        </button>
                    </td>
                `;
            });
            
            // Load pending withdrawals
            const withdrawalsSnap = await db.ref('withdrawals')
                .orderByChild('status')
                .equalTo('pending')
                .once('value');
                
            const withdrawalsTbody = document.getElementById('adminWithdrawalsTable');
            withdrawalsTbody.innerHTML = '';
            
            withdrawalsSnap.forEach(child => {
                const val = child.val();
                const row = withdrawalsTbody.insertRow();
                row.innerHTML = `
                    <td>${val.user_email}</td>
                    <td>${val.currency}</td>
                    <td>${val.amount}</td>
                    <td>${val.destination}</td>
                    <td>
                        <button class="btn btn-gold" style="padding: 0.3rem 0.8rem; font-size: 0.8rem;" onclick="processWithdrawal('${child.key}', 'approved')">
                            <i class="fas fa-check"></i> Paid
                        </button>
                        <button class="btn btn-dark" style="padding: 0.3rem 0.8rem; font-size: 0.8rem; background: var(--red);" onclick="processWithdrawal('${child.key}', 'rejected')">
                            <i class="fas fa-undo"></i> Refund
                        </button>
                    </td>
                `;
            });
            
            // Load investment plans for admin
            const plansSnap = await db.ref('investment_plans').once('value');
            const plans = plansSnap.val() || {};
            const plansContainer = document.getElementById('adminPlansList');
            plansContainer.innerHTML = '';
            
            Object.entries(plans).forEach(([key, plan]) => {
                const div = document.createElement('div');
                div.className = 'card';
                div.innerHTML = `
                    <h4 style="color: var(--gold);">${plan.name}</h4>
                    <p>Returns: ${plan.returns}% daily</p>
                    <p>Min: ₹${plan.min} - Max: ₹${plan.max}</p>
                    <p>Duration: ${plan.duration} days</p>
                    <button class="btn btn-dark" style="margin-top: 1rem;" onclick="deletePlan('${key}')">Delete</button>
                `;
                plansContainer.appendChild(div);
            });
            
            // Load NFTs for admin
            loadAdminNFTs();
            
            // Load users
            const usersSnap = await db.ref('users').once('value');
            const usersTbody = document.getElementById('usersTable');
            usersTbody.innerHTML = '';
            
            usersSnap.forEach(child => {
                const val = child.val();
                const row = usersTbody.insertRow();
                row.innerHTML = `
                    <td>${val.email}</td>
                    <td>${val.name}</td>
                    <td>₹${val.balances?.INR || 0}</td>
                    <td>${val.balances?.USDT || 0}</td>
                    <td>
                        <button class="btn btn-gold" style="padding: 0.3rem 0.8rem; font-size: 0.8rem;" onclick="editUserBalance('${child.key}')">
                            Edit Balance
                        </button>
                    </td>
                `;
            });
        }

        async function savePaymentSettings() {
            const upi = document.getElementById('settingsUpi').value;
            const usdt = document.getElementById('settingsUsdt').value;
            
            await db.ref('settings').update({
                upi_id: upi,
                usdt_address: usdt,
                updated_at: Date.now()
            });
            
            showToast('Payment settings saved!', 'success');
            loadAdminData(); // Refresh
        }

        async function processDeposit(depositId, userId, amount, currency, status) {
            await db.ref('deposits/' + depositId).update({ status: status });
            
            if (status === 'approved') {
                // Add to user balance
                const userSnap = await db.ref('users/' + userId + '/balances/' + currency).once('value');
                const current = userSnap.val() || 0;
                await db.ref('users/' + userId + '/balances/' + currency).set(current + amount);
            }
            
            showToast(`Deposit ${status}`, 'success');
            loadAdminData();
            loadTransactions();
        }

        async function processWithdrawal(withdrawalId, status) {
            const snap = await db.ref('withdrawals/' + withdrawalId).once('value');
            const data = snap.val();
            
            await db.ref('withdrawals/' + withdrawalId).update({ status: status });
            
            if (status === 'rejected') {
                // Refund the amount
                const userSnap = await db.ref('users/' + data.user_id + '/balances/' + data.currency).once('value');
                const current = userSnap.val() || 0;
                await db.ref('users/' + data.user_id + '/balances/' + data.currency).set(current + data.amount);
            }
            
            showToast(`Withdrawal ${status}`, 'success');
            loadAdminData();
            loadTransactions();
        }

        async function createInvestmentPlan() {
            const planData = {
                name: document.getElementById('planName').value,
                returns: parseFloat(document.getElementById('planReturn').value),
                min: parseFloat(document.getElementById('planMin').value),
                max: parseFloat(document.getElementById('planMax').value),
                duration: parseInt(document.getElementById('planDuration').value),
                created_at: Date.now()
            };
            
            await db.ref('investment_plans').push(planData);
            showToast('Investment plan created!', 'success');
            
            // Clear inputs
            document.getElementById('planName').value = '';
            document.getElementById('planReturn').value = '';
            document.getElementById('planMin').value = '';
            document.getElementById('planMax').value = '';
            document.getElementById('planDuration').value = '';
            
            loadAdminData();
        }

        async function deletePlan(planId) {
            if (confirm('Delete this plan?')) {
                await db.ref('investment_plans/' + planId).remove();
                loadAdminData();
            }
        }

        // ==========================================
        // NFT CREATION (ADMIN)
        // ==========================================

        async function createNFT() {
            const name = document.getElementById('nftName').value;
            const desc = document.getElementById('nftDesc').value;
            const priceInr = document.getElementById('nftPriceInr').value;
            const priceUsdt = document.getElementById('nftPriceUsdt').value;
            const fileInput = document.getElementById('nftImage');
            
            if (!name || !priceInr || !fileInput.files[0]) {
                showToast('Fill all required fields', 'error');
                return;
            }
            
            try {
                // Upload to Cloudinary
                const formData = new FormData();
                formData.append('file', fileInput.files[0]);
                formData.append('upload_preset', CLOUDINARY_UPLOAD_PRESET);
                
                const response = await fetch(`https://api.cloudinary.com/v1_1/${CLOUDINARY_CLOUD_NAME}/image/upload`, {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                
                const nftData = {
                    name: name,
                    description: desc,
                    price_inr: parseFloat(priceInr),
                    price_usdt: parseFloat(priceUsdt) || 0,
                    image_url: data.secure_url,
                    created_by: currentUser.id,
                    created_at: Date.now(),
                    sold: false
                };
                
                await db.ref('nfts').push(nftData);
                showToast('NFT created successfully!', 'success');
                
                // Clear form
                document.getElementById('nftName').value = '';
                document.getElementById('nftDesc').value = '';
                document.getElementById('nftPriceInr').value = '';
                document.getElementById('nftPriceUsdt').value = '';
                document.getElementById('nftPreview').innerHTML = '<span style="color: var(--text-gray);"><i class="fas fa-image"></i> Click to upload NFT image</span>';
                
                loadAdminNFTs();
                loadNFTs();
                
            } catch (error) {
                showToast('Error creating NFT: ' + error.message, 'error');
            }
        }

        async function loadAdminNFTs() {
            const snapshot = await db.ref('nfts').once('value');
            const nfts = snapshot.val() || {};
            const container = document.getElementById('adminNFTList');
            container.innerHTML = '';
            
            Object.entries(nfts).forEach(([key, nft]) => {
                const div = document.createElement('div');
                div.className = 'nft-card';
                div.style.opacity = nft.sold ? '0.5' : '1';
                div.innerHTML = `
                    <img src="${nft.image_url}" class="nft-image" style="height: 150px;">
                    <div class="nft-info" style="padding: 1rem;">
                        <h4 style="color: var(--gold); font-size: 1rem;">${nft.name}</h4>
                        <p style="font-size: 0.8rem; color: ${nft.sold ? 'var(--red)' : 'var(--green)'}">
                            ${nft.sold ? 'SOLD' : 'Available'}
                        </p>
                        <button class="btn btn-dark" style="width: 100%; margin-top: 0.5rem; padding: 0.3rem;" onclick="deleteNFT('${key}')">
                            Delete
                        </button>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        async function deleteNFT(nftId) {
            if (confirm('Delete this NFT permanently?')) {
                await db.ref('nfts/' + nftId).remove();
                loadAdminNFTs();
                loadNFTs();
            }
        }

        async function editUserBalance(userId) {
            const currency = prompt('Which currency? (INR/USDT)');
            if (!currency) return;
            
            const amount = prompt('Enter new balance amount:');
            if (amount === null) return;
            
            await db.ref('users/' + userId + '/balances/' + currency).set(parseFloat(amount));
            showToast('Balance updated', 'success');
            loadAdminData();
        }

        // ==========================================
        // UTILITY FUNCTIONS
        // ==========================================

        function previewImage(input, previewId) {
            const preview = document.getElementById(previewId);
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.innerHTML = `<img src="${e.target.result}" style="max-width: 100%; max-height: 100%;">`;
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.style.borderColor = type === 'error' ? 'var(--red)' : 'var(--gold)';
            toast.style.color = type === 'error' ? 'var(--red)' : 'var(--gold)';
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // ==========================================
        // INIT
        // ==========================================
        
        // Check if already logged in
        supabase.auth.getSession().then(({ data: { session } }) => {
            if (session) {
                currentUser = session.user;
                initializeUser();
            }
        });

        // Setup first admin (run once in console: setAdmin('user-id'))
        window.setAdmin = async function(userId) {
            await db.ref('users/' + userId).update({ is_admin: true });
            console.log('Admin set for user: ' + userId);
        };
    </script>
</body>
  </html>
