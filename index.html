<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TREDING.STORE - Professional Cryptocurrency Exchange</title>
    <meta name="description" content="TREDING.STORE - Trade Crypto & NFTs Like a Pro">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ“ˆ</text></svg>">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.0/dist/umd/supabase.min.js"></script>
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-storage-compat.js"></script>
    
    <!-- TradingView Lightweight Charts -->
    <script src="https://unpkg.com/lightweight-charts@4.1.0/dist/lightweight-charts.standalone.production.js"></script>
    
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        bg: '#0B0E11',
                        card: '#151A21',
                        'card-hover': '#1C2128',
                        border: '#2B3139',
                        'border-light': '#3D4550',
                        'text-primary': '#EAECEF',
                        'text-secondary': '#848E9C',
                        'text-muted': '#5E6673',
                        'buy-green': '#0ECB81',
                        'buy-green-dark': '#0B9E65',
                        'sell-red': '#F6465D',
                        'sell-red-dark': '#D13449',
                        'accent-yellow': '#F0B90B',
                        'accent-blue': '#1E80FF',
                        'hover-bg': '#2B3139'
                    },
                    fontFamily: {
                        'sans': ['Inter', 'sans-serif'],
                        'mono': ['JetBrains Mono', 'monospace']
                    }
                }
            }
        }
    </script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; }
        body { font-family: 'Inter', sans-serif; background-color: #0B0E11; color: #EAECEF; min-height: 100vh; overflow-x: hidden; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        
        /* Allow selection only for specific elements */
        .allow-select, .upi-id, .wallet-address, .copy-text { -webkit-user-select: text; -moz-user-select: text; -ms-user-select: text; user-select: text; }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 4px; height: 4px; }
        ::-webkit-scrollbar-track { background: #0B0E11; }
        ::-webkit-scrollbar-thumb { background: #2B3139; border-radius: 2px; }
        ::-webkit-scrollbar-thumb:hover { background: #3D4550; }
        
        /* Animations */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slideInRight { from { transform: translateX(100%); } to { transform: translateX(0); } }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        @keyframes flashGreen { 0% { background: rgba(14, 203, 129, 0.3); } 100% { background: transparent; } }
        @keyframes flashRed { 0% { background: rgba(246, 70, 93, 0.3); } 100% { background: transparent; } }
        
        .animate-fadeIn { animation: fadeIn 0.3s ease-out; }
        .animate-slideInRight { animation: slideInRight 0.3s ease-out; }
        .flash-green { animation: flashGreen 0.5s ease-out; }
        .flash-red { animation: flashRed 0.5s ease-out; }
        
        /* Glass Effect */
        .glass { background: rgba(21, 26, 33, 0.95); backdrop-filter: blur(10px); }
        
        /* Order Book Bars */
        .order-bar { position: relative; overflow: hidden; }
        .order-bar::after { content: ''; position: absolute; top: 0; height: 100%; opacity: 0.12; transition: width 0.3s ease; z-index: 0; }
        .order-bar.buy::after { right: 0; background: #0ECB81; }
        .order-bar.sell::after { left: 0; background: #F6465D; }
        .order-bar-content { position: relative; z-index: 1; }
        
        /* Button Effects */
        .btn-primary { background: linear-gradient(135deg, #F0B90B 0%, #D4A009 100%); color: #0B0E11; transition: all 0.3s ease; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 4px 20px rgba(240, 185, 11, 0.4); }
        .btn-buy { background: linear-gradient(135deg, #0ECB81 0%, #0B9E65 100%); transition: all 0.3s ease; }
        .btn-buy:hover { transform: translateY(-2px); box-shadow: 0 4px 20px rgba(14, 203, 129, 0.4); }
        .btn-sell { background: linear-gradient(135deg, #F6465D 0%, #D13449 100%); transition: all 0.3s ease; }
        .btn-sell:hover { transform: translateY(-2px); box-shadow: 0 4px 20px rgba(246, 70, 93, 0.4); }
        
        /* Input Styles */
        .input-field { background: #0B0E11; border: 1px solid #2B3139; transition: all 0.3s ease; color: #EAECEF; }
        .input-field:focus { border-color: #F0B90B; outline: none; box-shadow: 0 0 0 2px rgba(240, 185, 11, 0.2); }
        .input-field::placeholder { color: #5E6673; }
        
        /* Tab Styles */
        .tab { position: relative; cursor: pointer; transition: all 0.3s ease; }
        .tab.active { color: #EAECEF; }
        .tab.active::after { content: ''; position: absolute; bottom: -1px; left: 0; right: 0; height: 2px; background: #F0B90B; }
        
        /* Toast Notification */
        .toast { position: fixed; top: 80px; right: 20px; padding: 12px 20px; border-radius: 8px; z-index: 9999; animation: slideInRight 0.3s ease-out; max-width: 350px; }
        .toast.success { background: #0ECB81; color: white; }
        .toast.error { background: #F6465D; color: white; }
        .toast.info { background: #1E80FF; color: white; }
        .toast.warning { background: #F0B90B; color: #0B0E11; }
        
        /* Loading Spinner */
        .spinner { border: 3px solid #2B3139; border-top: 3px solid #F0B90B; border-radius: 50%; width: 24px; height: 24px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        /* Chart Container */
        #chart-container { width: 100%; height: 100%; }
        
        /* Mobile Bottom Nav */
        .mobile-nav { display: none; }
        @media (max-width: 1024px) { .desktop-only { display: none !important; } .mobile-nav { display: flex; } .trading-layout { flex-direction: column; } }
        @media (max-width: 768px) { .hide-mobile { display: none !important; } }
        
        /* NFT Card */
        .nft-card { transition: all 0.3s ease; background: linear-gradient(145deg, #151A21 0%, #1C2128 100%); }
        .nft-card:hover { transform: translateY(-8px); box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5); border-color: #F0B90B; }
        
        /* Modal */
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.85); display: flex; align-items: center; justify-content: center; z-index: 1000; backdrop-filter: blur(8px); padding: 20px; }
        .modal-content { background: #151A21; border: 1px solid #2B3139; border-radius: 16px; max-width: 90%; max-height: 90vh; overflow-y: auto; width: 100%; }
        
        /* Admin Panel Styles */
        .admin-sidebar { width: 280px; background: #151A21; border-right: 1px solid #2B3139; position: fixed; left: 0; top: 0; bottom: 0; overflow-y: auto; z-index: 100; }
        .admin-content { flex: 1; margin-left: 280px; min-height: 100vh; }
        @media (max-width: 1024px) { .admin-sidebar { transform: translateX(-100%); transition: transform 0.3s; } .admin-sidebar.open { transform: translateX(0); } .admin-content { margin-left: 0; } }
        
        /* Status Badges */
        .badge { padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 500; }
        .badge-pending { background: rgba(240, 185, 11, 0.15); color: #F0B90B; }
        .badge-approved { background: rgba(14, 203, 129, 0.15); color: #0ECB81; }
        .badge-rejected { background: rgba(246, 70, 93, 0.15); color: #F6465D; }
        .badge-processing { background: rgba(30, 128, 255, 0.15); color: #1E80FF; }
        
        /* Percentage Buttons */
        .pct-btn { padding: 6px 12px; background: #0B0E11; border: 1px solid #2B3139; border-radius: 6px; font-size: 12px; cursor: pointer; transition: all 0.2s ease; color: #848E9C; }
        .pct-btn:hover { background: #2B3139; color: #EAECEF; }
        .pct-btn.active { background: #F0B90B; border-color: #F0B90B; color: #0B0E11; }
        
        /* Trading Panel */
        .trading-panel { background: #151A21; border-left: 1px solid #2B3139; }
        
        /* Order Book */
        .orderbook-row { font-size: 12px; padding: 2px 8px; cursor: pointer; transition: background 0.1s; }
        .orderbook-row:hover { background: #2B3139; }
        
        /* Depth Bar Animation */
        @keyframes depthFill { from { width: 0; } to { width: var(--depth); } }
        .depth-bar { animation: depthFill 0.5s ease-out forwards; }
        
        /* Copy Button */
        .copy-btn { padding: 4px 8px; background: #2B3139; border-radius: 4px; font-size: 11px; cursor: pointer; transition: all 0.2s; }
        .copy-btn:hover { background: #F0B90B; color: #0B0E11; }
        
        /* Gradient Text */
        .gradient-text { background: linear-gradient(135deg, #F0B90B 0%, #FFD700 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        
        /* Glow Effects */
        .glow-yellow { box-shadow: 0 0 20px rgba(240, 185, 11, 0.3); }
        .glow-green { box-shadow: 0 0 20px rgba(14, 203, 129, 0.3); }
        .glow-red { box-shadow: 0 0 20px rgba(246, 70, 93, 0.3); }
        
        /* Image Upload Preview */
        .image-preview { width: 100%; height: 200px; background: #0B0E11; border: 2px dashed #2B3139; border-radius: 12px; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.3s; }
        .image-preview:hover { border-color: #F0B90B; }
        .image-preview.has-image { border-style: solid; border-color: #0ECB81; }
        
        /* Real-time indicator */
        .live-indicator { display: inline-flex; align-items: center; gap: 6px; }
        .live-indicator::before { content: ''; width: 8px; height: 8px; background: #0ECB81; border-radius: 50%; animation: pulse 1.5s infinite; }
        
        /* Price ticker */
        .price-ticker { display: flex; gap: 24px; overflow-x: auto; padding: 8px 0; }
        .price-ticker::-webkit-scrollbar { display: none; }
        
        /* Hover tooltip */
        .tooltip { position: relative; }
        .tooltip::after { content: attr(data-tooltip); position: absolute; bottom: 100%; left: 50%; transform: translateX(-50%); padding: 6px 12px; background: #2B3139; border-radius: 6px; font-size: 12px; white-space: nowrap; opacity: 0; pointer-events: none; transition: opacity 0.2s; z-index: 100; }
        .tooltip:hover::after { opacity: 1; }
    </style>
</head>
<body>
    <!-- App Container -->
    <div id="app"></div>
    
    <!-- Toast Container -->
    <div id="toast-container"></div>
    
    <!-- Loading Overlay -->
    <div id="loading-overlay" class="fixed inset-0 bg-bg flex items-center justify-center z-[9999]" style="display: none;">
        <div class="text-center">
            <div class="spinner mx-auto mb-4"></div>
            <p class="text-text-secondary">Loading...</p>
        </div>
    </div>

    <script>

        // ============================================
        // CONFIGURATION - TREDING.STORE
        // ============================================
        const CONFIG = {
            // Supabase Configuration
            supabase: {
                url: 'https://pqifnpafmiqntzlgtfkx.supabase.co',
                key: 'sb_publishable_mdYQ1LM9Xq_b79x8VbeVIw_EeRvJpCX'
            },
            
            // Firebase Configuration
            firebase: {
                apiKey: "AIzaSyDCHUmML-3xe57TJAiZKSTHouFxIiFHGoE",
                authDomain: "etf-rm.firebaseapp.com",
                projectId: "etf-rm",
                storageBucket: "etf-rm.firebasestorage.app",
                messagingSenderId: "1013121735332",
                appId: "1:1013121735332:web:2665a687123c2a95416431",
                measurementId: "G-D8HR00JZBM"
            },
            
            // Cloudinary Configuration
            cloudinary: {
                cloudName: 'debp1kjtm',
                uploadPreset: 'sql_admin',
                apiEndpoint: 'https://api.cloudinary.com/v1_1/debp1kjtm/image/upload'
            },
            
            // Admin Configuration
            admin: {
                password: 'sqladmin2024',
                email: 'admin@treding.store'
            },
            
            // Trading Pairs
            pairs: [
                { symbol: 'BTC/USDT', base: 'BTC', quote: 'USDT', price: 0, change: 0, volume: 0, high: 0, low: 0 },
                { symbol: 'ETH/USDT', base: 'ETH', quote: 'USDT', price: 0, change: 0, volume: 0, high: 0, low: 0 },
                { symbol: 'BNB/USDT', base: 'BNB', quote: 'USDT', price: 0, change: 0, volume: 0, high: 0, low: 0 },
                { symbol: 'SOL/USDT', base: 'SOL', quote: 'USDT', price: 0, change: 0, volume: 0, high: 0, low: 0 },
                { symbol: 'XRP/USDT', base: 'XRP', quote: 'USDT', price: 0, change: 0, volume: 0, high: 0, low: 0 },
                { symbol: 'DOGE/USDT', base: 'DOGE', quote: 'USDT', price: 0, change: 0, volume: 0, high: 0, low: 0 },
                { symbol: 'ADA/USDT', base: 'ADA', quote: 'USDT', price: 0, change: 0, volume: 0, high: 0, low: 0 },
                { symbol: 'MATIC/USDT', base: 'MATIC', quote: 'USDT', price: 0, change: 0, volume: 0, high: 0, low: 0 }
            ],
            
            // Default Site Settings (Editable from Admin)
            siteSettings: {
                name: 'TREDING.STORE',
                logo: 'ðŸ“ˆ',
                primaryColor: '#F0B90B',
                tradingFee: 0.1,
                minDeposit: 10,
                maxDeposit: 100000,
                minWithdrawal: 10,
                maxWithdrawal: 50000,
                maintenanceMode: false,
                announcements: []
            }
        };

        // ============================================
        // GLOBAL STATE
        // ============================================
        const state = {
            user: null,
            session: null,
            profile: null,
            wallet: {
                spot: { USDT: 10000, BTC: 0, ETH: 0, BNB: 0 },
                futures: { USDT: 0 },
                margin: { USDT: 0 }
            },
            currentPair: 'BTC/USDT',
            currentPrice: 0,
            orderBook: { bids: [], asks: [], lastUpdate: 0 },
            orders: [],
            trades: [],
            deposits: [],
            withdrawals: [],
            transfers: [],
            paymentMethods: {
                upi: { id: 'upi1', name: 'UPI Payment', upiId: 'treding@upi', qrCode: '', status: 'active', min: 100, max: 100000 },
                bank: { id: 'bank1', name: 'Bank Transfer', accountName: 'TREDING STORE', accountNumber: '1234567890', ifsc: 'HDFC0001234', bankName: 'HDFC Bank', status: 'active', min: 500, max: 500000 },
                crypto: { id: 'crypto1', name: 'Crypto Deposit', addresses: { 'USDT-TRC20': 'Txxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx', 'USDT-ERC20': '0xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx', 'BTC': 'bc1xxxxxxxxxxxxxxxxxxxxxxxxxxxx', 'ETH': '0xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx' }, status: 'active', min: 10, max: 1000000 }
            },
            isAdmin: false,
            adminSettings: null,
            chart: null,
            candlestickSeries: null,
            currentPage: 'home',
            currentTimeframe: '1H',
            nftListings: [],
            myNFTs: [],
            notifications: [],
            unreadCount: 0,
            priceAlerts: []
        };

        // ============================================
        // CLIENT INITIALIZATION
        // ============================================
        let supabase = null;
        let firebase = null;
        let firebaseDB = null;
        let firebaseAuth = null;
        let firebaseStorage = null;

        function initClients() {
            // Initialize Supabase
            supabase = window.supabase.createClient(CONFIG.supabase.url, CONFIG.supabase.key);
            
            // Initialize Firebase
            firebase = window.firebase.initializeApp(CONFIG.firebase);
            firebaseAuth = window.firebase.auth();
            firebaseDB = window.firebase.database();
            firebaseStorage = window.firebase.storage();
        }

        // ============================================
        // UTILITY FUNCTIONS
        // ============================================
        function showToast(message, type = 'info', duration = 3000) {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <div class="flex items-start gap-3">
                    <i class="fas ${type === 'success' ? 'fa-check-circle' : type === 'error' ? 'fa-exclamation-circle' : type === 'warning' ? 'fa-exclamation-triangle' : 'fa-info-circle'} mt-0.5"></i>
                    <div>
                        <div class="font-medium">${type === 'success' ? 'Success' : type === 'error' ? 'Error' : type === 'warning' ? 'Warning' : 'Info'}</div>
                        <div class="text-sm opacity-90">${message}</div>
                    </div>
                </div>
            `;
            container.appendChild(toast);
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateX(100%)';
                setTimeout(() => toast.remove(), 300);
            }, duration);
        }

        function formatNumber(num, decimals = 2) {
            if (num === undefined || num === null || isNaN(num)) return '0.00';
            return parseFloat(num).toFixed(decimals);
        }

        function formatPrice(price) {
            if (!price || isNaN(price)) return '0.00';
            if (price >= 1000) return price.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
            if (price >= 1) return price.toFixed(4);
            return price.toFixed(6);
        }

        function formatCurrency(amount, symbol = '$') {
            if (!amount || isNaN(amount)) return symbol + '0.00';
            return symbol + parseFloat(amount).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        }

        function formatCompactNumber(num) {
            if (!num || isNaN(num)) return '0';
            if (num >= 1e9) return (num / 1e9).toFixed(2) + 'B';
            if (num >= 1e6) return (num / 1e6).toFixed(2) + 'M';
            if (num >= 1e3) return (num / 1e3).toFixed(2) + 'K';
            return num.toFixed(2);
        }

        function generateId() {
            return Math.random().toString(36).substr(2, 9) + Date.now().toString(36).substr(-4);
        }

        function getCurrentTimestamp() {
            return new Date().toISOString();
        }

        function timeAgo(date) {
            const seconds = Math.floor((new Date() - new Date(date)) / 1000);
            if (seconds < 60) return 'Just now';
            const minutes = Math.floor(seconds / 60);
            if (minutes < 60) return `${minutes}m ago`;
            const hours = Math.floor(minutes / 60);
            if (hours < 24) return `${hours}h ago`;
            const days = Math.floor(hours / 24);
            return `${days}d ago`;
        }

        function copyToClipboard(text, label = 'Copied!') {
            navigator.clipboard.writeText(text).then(() => {
                showToast(`${label} copied to clipboard`, 'success');
            }).catch(() => {
                showToast('Failed to copy', 'error');
            });
        }

        function showLoading(show = true) {
            document.getElementById('loading-overlay').style.display = show ? 'flex' : 'none';
        }

        // ============================================
        // CLOUDINARY UPLOAD
        // ============================================
        async function uploadToCloudinary(file, folder = 'general') {
            const formData = new FormData();
            formData.append('file', file);
            formData.append('upload_preset', CONFIG.cloudinary.uploadPreset);
            formData.append('folder', folder);
            
            try {
                showLoading(true);
                const response = await fetch(CONFIG.cloudinary.apiEndpoint, {
                    method: 'POST',
                    body: formData
                });
                const data = await response.json();
                showLoading(false);
                if (data.secure_url) return data.secure_url;
                throw new Error('Upload failed');
            } catch (error) {
                showLoading(false);
                showToast('Upload failed: ' + error.message, 'error');
                return null;
            }
        }

        // ============================================
        // AUTHENTICATION (Supabase + Firebase)
        // ============================================
        async function signUp(email, password, name) {
            try {
                showLoading(true);
                const { data, error } = await supabase.auth.signUp({
                    email,
                    password,
                    options: { data: { name, created_at: getCurrentTimestamp() } }
                });
                if (error) throw error;
                
                // Create user profile in Firebase
                await firebaseDB.ref(`users/${data.user.id}`).set({
                    id: data.user.id,
                    email,
                    name,
                    avatar: `https://ui-avatars.com/api/?name=${encodeURIComponent(name)}&background=F0B90B&color=0B0E11`,
                    created_at: getCurrentTimestamp(),
                    kyc_status: 'pending',
                    is_active: true,
                    is_verified: false
                });
                
                // Create wallet
                await firebaseDB.ref(`wallets/${data.user.id}`).set({
                    spot: { USDT: 10000, BTC: 0, ETH: 0, BNB: 0, SOL: 0, XRP: 0 },
                    futures: { USDT: 0 },
                    margin: { USDT: 0 },
                    created_at: getCurrentTimestamp()
                });
                
                showLoading(false);
                showToast('Account created successfully! Please verify your email.', 'success');
                return data;
            } catch (error) {
                showLoading(false);
                showToast(error.message, 'error');
                return null;
            }
        }

        async function signIn(email, password) {
            try {
                showLoading(true);
                const { data, error } = await supabase.auth.signInWithPassword({ email, password });
                if (error) throw error;
                
                state.user = data.user;
                state.session = data.session;
                
                // Load profile from Firebase
                const profileSnap = await firebaseDB.ref(`users/${data.user.id}`).once('value');
                state.profile = profileSnap.val() || {};
                
                await loadUserData();
                showLoading(false);
                showToast(`Welcome back, ${state.profile.name || 'Trader'}!`, 'success');
                navigateTo('trading');
                return data;
            } catch (error) {
                showLoading(false);
                showToast(error.message, 'error');
                return null;
            }
        }

        async function signInWithGoogle() {
            try {
                showLoading(true);
                const { data, error } = await supabase.auth.signInWithOAuth({
                    provider: 'google',
                    options: { redirectTo: window.location.origin }
                });
                if (error) throw error;
                showLoading(false);
                return data;
            } catch (error) {
                showLoading(false);
                showToast(error.message, 'error');
                return null;
            }
        }

        async function handleGoogleCallback(user) {
            if (!user) return;
            
            state.user = user;
            
            // Check if user exists in Firebase
            const userSnap = await firebaseDB.ref(`users/${user.id}`).once('value');
            
            if (!userSnap.exists()) {
                // Create new user profile
                const name = user.user_metadata?.full_name || user.user_metadata?.name || 'Trader';
                const avatar = user.user_metadata?.avatar_url || `https://ui-avatars.com/api/?name=${encodeURIComponent(name)}&background=F0B90B&color=0B0E11`;
                
                await firebaseDB.ref(`users/${user.id}`).set({
                    id: user.id,
                    email: user.email,
                    name,
                    avatar,
                    created_at: getCurrentTimestamp(),
                    kyc_status: 'pending',
                    is_active: true,
                    is_verified: true
                });
                
                await firebaseDB.ref(`wallets/${user.id}`).set({
                    spot: { USDT: 10000, BTC: 0, ETH: 0, BNB: 0, SOL: 0, XRP: 0 },
                    futures: { USDT: 0 },
                    margin: { USDT: 0 },
                    created_at: getCurrentTimestamp()
                });
            }
            
            const profileSnap = await firebaseDB.ref(`users/${user.id}`).once('value');
            state.profile = profileSnap.val() || {};
            
            await loadUserData();
            showToast(`Welcome, ${state.profile.name || 'Trader'}!`, 'success');
            navigateTo('trading');
        }

        async function signOut() {
            await supabase.auth.signOut();
            state.user = null;
            state.session = null;
            state.profile = null;
            navigateTo('home');
            showToast('Signed out successfully', 'info');
        }

        async function loadUserData() {
            if (!state.user) return;
            
            // Load wallet
            const walletSnap = await firebaseDB.ref(`wallets/${state.user.id}`).once('value');
            if (walletSnap.exists()) state.wallet = walletSnap.val();
            
            // Load orders
            const ordersSnap = await firebaseDB.ref(`orders/${state.user.id}`).once('value');
            if (ordersSnap.exists()) state.orders = Object.values(ordersSnap.val());
            
            // Load deposits
            const depositsSnap = await firebaseDB.ref(`deposits/${state.user.id}`).once('value');
            if (depositsSnap.exists()) state.deposits = Object.values(depositsSnap.val());
            
            // Load withdrawals
            const withdrawalsSnap = await firebaseDB.ref(`withdrawals/${state.user.id}`).once('value');
            if (withdrawalsSnap.exists()) state.withdrawals = Object.values(withdrawalsSnap.val());
            
            // Load NFTs
            const nftsSnap = await firebaseDB.ref(`user_nfts/${state.user.id}`).once('value');
            if (nftsSnap.exists()) state.myNFTs = Object.values(nftsSnap.val());
            
            // Setup real-time listeners
            setupRealtimeListeners();
        }

        function setupRealtimeListeners() {
            if (!state.user) return;
            
            // Listen for wallet updates
            firebaseDB.ref(`wallets/${state.user.id}`).on('value', (snap) => {
                if (snap.exists()) {
                    state.wallet = snap.val();
                    updateWalletDisplay();
                }
            });
            
            // Listen for order updates
            firebaseDB.ref(`orders/${state.user.id}`).on('value', (snap) => {
                if (snap.exists()) {
                    state.orders = Object.values(snap.val());
                    renderOrders();
                }
            });
        }

        // ============================================
        // TRADING FUNCTIONS
        // ============================================
        async function placeOrder(type, side, price, amount) {
            if (!state.user) { showToast('Please login first', 'error'); return; }
            
            const total = price * amount;
            const [base, quote] = state.currentPair.split('/');
            
            // Check balance
            if (side === 'buy' && state.wallet.spot[quote] < total) {
                showToast(`Insufficient ${quote} balance`, 'error'); return;
            }
            if (side === 'sell' && state.wallet.spot[base] < amount) {
                showToast(`Insufficient ${base} balance`, 'error'); return;
            }
            
            try {
                const order = {
                    id: generateId(),
                    user_id: state.user.id,
                    pair: state.currentPair,
                    type, side, price, amount,
                    filled: 0, status: 'open',
                    created_at: getCurrentTimestamp()
                };
                
                await firebaseDB.ref(`orders/${state.user.id}/${order.id}`).set(order);
                
                // Deduct balance
                if (side === 'buy') {
                    await firebaseDB.ref(`wallets/${state.user.id}/spot/${quote}`).set(state.wallet.spot[quote] - total);
                } else {
                    await firebaseDB.ref(`wallets/${state.user.id}/spot/${base}`).set(state.wallet.spot[base] - amount);
                }
                
                showToast(`${side.toUpperCase()} order placed`, 'success');
                
                // Simulate order fill after random delay
                setTimeout(() => simulateOrderFill(order), 2000 + Math.random() * 5000);
                
            } catch (error) { showToast(error.message, 'error'); }
        }

        async function simulateOrderFill(order) {
            if (!state.user || order.status !== 'open') return;
            
            const fillAmount = order.amount * (0.5 + Math.random() * 0.5);
            const [base, quote] = order.pair.split('/');
            
            // Update order
            await firebaseDB.ref(`orders/${state.user.id}/${order.id}`).update({
                filled: fillAmount,
                status: 'filled'
            });
            
            // Add trade
            const trade = {
                id: generateId(),
                order_id: order.id,
                user_id: state.user.id,
                pair: order.pair,
                side: order.side,
                price: order.price,
                amount: fillAmount,
                fee: order.price * fillAmount * 0.001,
                created_at: getCurrentTimestamp()
            };
            await firebaseDB.ref(`trades/${state.user.id}/${trade.id}`).set(trade);
            
            // Update balance for seller (receive quote currency)
            if (order.side === 'sell') {
                const received = order.price * fillAmount * 0.999; // After fee
                const currentQuote = state.wallet.spot[quote] || 0;
                await firebaseDB.ref(`wallets/${state.user.id}/spot/${quote}`).set(currentQuote + received);
            } else {
                // Buyer receives base currency
                const currentBase = state.wallet.spot[base] || 0;
                await firebaseDB.ref(`wallets/${state.user.id}/spot/${base}`).set(currentBase + fillAmount);
            }
            
            showToast('Order filled!', 'success');
        }

        async function cancelOrder(orderId) {
            const order = state.orders.find(o => o.id === orderId);
            if (!order || order.status !== 'open') return;
            
            const [base, quote] = order.pair.split('/');
            const remaining = order.amount - order.filled;
            
            // Refund
            if (order.side === 'buy') {
                const refund = order.price * remaining;
                const currentQuote = state.wallet.spot[quote] || 0;
                await firebaseDB.ref(`wallets/${state.user.id}/spot/${quote}`).set(currentQuote + refund);
            } else {
                const currentBase = state.wallet.spot[base] || 0;
                await firebaseDB.ref(`wallets/${state.user.id}/spot/${base}`).set(currentBase + remaining);
            }
            
            await firebaseDB.ref(`orders/${state.user.id}/${orderId}`).update({ status: 'cancelled' });
            showToast('Order cancelled', 'info');
        }

        // ============================================
        // DEPOSIT/WITHDRAWAL FUNCTIONS
        // ============================================
        async function createDeposit(amount, method, proofUrl, utr, notes = '') {
            if (!state.user) { showToast('Please login first', 'error'); return; }
            
            const deposit = {
                id: generateId(),
                user_id: state.user.id,
                user_email: state.user.email,
                amount: parseFloat(amount),
                method,
                proof_url: proofUrl,
                utr: utr || '',
                notes,
                status: 'pending',
                created_at: getCurrentTimestamp(),
                processed_at: null,
                processed_by: null
            };
            
            await firebaseDB.ref(`deposits/${state.user.id}/${deposit.id}`).set(deposit);
            await firebaseDB.ref(`admin/deposits/${deposit.id}`).set(deposit);
            
            state.deposits.unshift(deposit);
            showToast('Deposit request submitted for approval', 'success');
            return deposit;
        }

        async function createWithdrawal(amount, method, details) {
            if (!state.user) { showToast('Please login first', 'error'); return; }
            if (state.wallet.spot.USDT < parseFloat(amount) + 1) {
                showToast('Insufficient USDT balance (including fee)', 'error'); return;
            }
            
            const withdrawal = {
                id: generateId(),
                user_id: state.user.id,
                user_email: state.user.email,
                amount: parseFloat(amount),
                fee: 1,
                net_amount: parseFloat(amount) - 1,
                method,
                details,
                status: 'pending',
                created_at: getCurrentTimestamp(),
                processed_at: null,
                processed_by: null
            };
            
            // Deduct balance immediately
            await firebaseDB.ref(`wallets/${state.user.id}/spot/USDT`).set(state.wallet.spot.USDT - parseFloat(amount) - 1);
            
            await firebaseDB.ref(`withdrawals/${state.user.id}/${withdrawal.id}`).set(withdrawal);
            await firebaseDB.ref(`admin/withdrawals/${withdrawal.id}`).set(withdrawal);
            
            state.withdrawals.unshift(withdrawal);
            showToast('Withdrawal request submitted', 'success');
            return withdrawal;
        }

        async function internalTransfer(from, to, amount, coin = 'USDT') {
            if (!state.user) { showToast('Please login first', 'error'); return; }
            
            const fromBalance = state.wallet[from][coin] || 0;
            if (fromBalance < amount) {
                showToast(`Insufficient ${coin} in ${from} wallet`, 'error'); return;
            }
            
            await firebaseDB.ref(`wallets/${state.user.id}/${from}/${coin}`).set(fromBalance - amount);
            const toBalance = state.wallet[to][coin] || 0;
            await firebaseDB.ref(`wallets/${state.user.id}/${to}/${coin}`).set(toBalance + amount);
            
            const transfer = {
                id: generateId(),
                user_id: state.user.id,
                from, to, amount, coin,
                created_at: getCurrentTimestamp()
            };
            await firebaseDB.ref(`transfers/${state.user.id}/${transfer.id}`).set(transfer);
            
            showToast(`Transferred ${amount} ${coin} to ${to}`, 'success');
        }

        // ============================================
        // NFT FUNCTIONS
        // ============================================
        async function loadNFTListings() {
            const nftsSnap = await firebaseDB.ref('nft_listings').once('value');
            if (nftsSnap.exists()) {
                state.nftListings = Object.values(nftsSnap.val()).filter(nft => nft.status === 'active');
            }
        }

        async function createNFTListing(name, description, price, imageUrl, collection = 'General') {
            if (!state.user) { showToast('Please login first', 'error'); return; }
            if (!state.isAdmin) { showToast('Only admin can create NFTs', 'error'); return; }
            
            const nft = {
                id: generateId(),
                name, description, price,
                currency: 'USDT',
                image: imageUrl,
                collection,
                creator: state.user.id,
                creator_name: state.profile.name || 'TREDING.STORE',
                owner: null,
                likes: 0,
                views: 0,
                status: 'active',
                created_at: getCurrentTimestamp(),
                sold_at: null
            };
            
            await firebaseDB.ref(`nft_listings/${nft.id}`).set(nft);
            state.nftListings.unshift(nft);
            showToast('NFT listed successfully', 'success');
            return nft;
        }

        async function buyNFT(nftId) {
            if (!state.user) { showToast('Please login first', 'error'); return; }
            
            const nft = state.nftListings.find(n => n.id === nftId);
            if (!nft) { showToast('NFT not found', 'error'); return; }
            if (nft.owner === state.user.id) { showToast('You already own this NFT', 'error'); return; }
            if (state.wallet.spot.USDT < nft.price) { showToast('Insufficient USDT balance', 'error'); return; }
            
            // Deduct buyer balance
            await firebaseDB.ref(`wallets/${state.user.id}/spot/USDT`).set(state.wallet.spot.USDT - nft.price);
            
            // Add to buyer's NFTs
            await firebaseDB.ref(`user_nfts/${state.user.id}/${nftId}`).set({
                ...nft,
                owner: state.user.id,
                bought_at: getCurrentTimestamp(),
                bought_price: nft.price
            });
            
            // Update NFT listing
            await firebaseDB.ref(`nft_listings/${nftId}`).update({
                owner: state.user.id,
                status: 'sold',
                sold_at: getCurrentTimestamp()
            });
            
            // Add to my NFTs
            state.myNFTs.push({ ...nft, owner: state.user.id });
            
            showToast(`You bought ${nft.name}!`, 'success');
            navigateTo('my-nfts');
        }

        async function sellNFT(nftId, price) {
            if (!state.user) { showToast('Please login first', 'error'); return; }
            
            const nft = state.myNFTs.find(n => n.id === nftId);
            if (!nft) { showToast('NFT not found in your collection', 'error'); return; }
            
            await firebaseDB.ref(`nft_listings/${nftId}`).update({
                price,
                owner: null,
                status: 'active',
                listed_at: getCurrentTimestamp()
            });
            
            await firebaseDB.ref(`user_nfts/${state.user.id}/${nftId}`).remove();
            state.myNFTs = state.myNFTs.filter(n => n.id !== nftId);
            
            showToast('NFT listed for sale', 'success');
        }

        // ============================================
        // ADMIN FUNCTIONS
        // ============================================
        async function adminLogin(password) {
            if (password === CONFIG.admin.password) {
                state.isAdmin = true;
                await loadAdminData();
                showToast('Admin access granted', 'success');
                navigateTo('admin');
                return true;
            }
            showToast('Invalid password', 'error');
            return false;
        }

        async function loadAdminData() {
            // Load all users
            const usersSnap = await firebaseDB.ref('users').once('value');
            state.adminUsers = usersSnap.val() || {};
            
            // Load all deposits
            const depositsSnap = await firebaseDB.ref('admin/deposits').once('value');
            state.adminDeposits = depositsSnap.val() || {};
            
            // Load all withdrawals
            const withdrawalsSnap = await firebaseDB.ref('admin/withdrawals').once('value');
            state.adminWithdrawals = withdrawalsSnap.val() || {};
            
            // Load admin settings
            const settingsSnap = await firebaseDB.ref('admin/settings').once('value');
            state.adminSettings = settingsSnap.val() || CONFIG.siteSettings;
        }

        async function approveDeposit(depositId, userId) {
            const deposit = state.adminDeposits[depositId];
            if (!deposit) return;
            
            // Update deposit status
            await firebaseDB.ref(`admin/deposits/${depositId}`).update({
                status: 'approved',
                processed_at: getCurrentTimestamp(),
                processed_by: state.user.id
            });
            await firebaseDB.ref(`deposits/${userId}/${depositId}`).update({
                status: 'approved',
                processed_at: getCurrentTimestamp()
            });
            
            // Add to user balance
            const walletSnap = await firebaseDB.ref(`wallets/${userId}/spot/USDT`).once('value');
            const currentBalance = walletSnap.val() || 0;
            await firebaseDB.ref(`wallets/${userId}/spot/USDT`).set(currentBalance + deposit.amount);
            
            showToast('Deposit approved', 'success');
            await loadAdminData();
        }

        async function rejectDeposit(depositId, userId, reason) {
            await firebaseDB.ref(`admin/deposits/${depositId}`).update({
                status: 'rejected',
                rejection_reason: reason,
                processed_at: getCurrentTimestamp(),
                processed_by: state.user.id
            });
            await firebaseDB.ref(`deposits/${userId}/${depositId}`).update({
                status: 'rejected',
                rejection_reason: reason
            });
            
            showToast('Deposit rejected', 'info');
            await loadAdminData();
        }

        async function approveWithdrawal(withdrawalId, userId) {
            await firebaseDB.ref(`admin/withdrawals/${withdrawalId}`).update({
                status: 'approved',
                processed_at: getCurrentTimestamp(),
                processed_by: state.user.id
            });
            await firebaseDB.ref(`withdrawals/${userId}/${withdrawalId}`).update({
                status: 'approved',
                processed_at: getCurrentTimestamp()
            });
            
            showToast('Withdrawal approved', 'success');
            await loadAdminData();
        }

        async function rejectWithdrawal(withdrawalId, userId, reason) {
            const withdrawal = state.adminWithdrawals[withdrawalId];
            if (!withdrawal) return;
            
            // Refund user
            const walletSnap = await firebaseDB.ref(`wallets/${userId}/spot/USDT`).once('value');
            const currentBalance = walletSnap.val() || 0;
            await firebaseDB.ref(`wallets/${userId}/spot/USDT`).set(currentBalance + withdrawal.amount + withdrawal.fee);
            
            await firebaseDB.ref(`admin/withdrawals/${withdrawalId}`).update({
                status: 'rejected',
                rejection_reason: reason,
                processed_at: getCurrentTimestamp(),
                processed_by: state.user.id
            });
            await firebaseDB.ref(`withdrawals/${userId}/${withdrawalId}`).update({
                status: 'rejected',
                rejection_reason: reason
            });
            
            showToast('Withdrawal rejected and refunded', 'info');
            await loadAdminData();
        }

        async function updateUserBalance(userId, coin, amount) {
            await firebaseDB.ref(`wallets/${userId}/spot/${coin}`).set(parseFloat(amount));
            showToast('Balance updated', 'success');
        }

        async function updatePaymentMethod(methodType, data) {
            await firebaseDB.ref(`admin/payment_methods/${methodType}`).set(data);
            state.paymentMethods[methodType] = data;
            showToast('Payment method updated', 'success');
        }

        async function updateSiteSettings(settings) {
            await firebaseDB.ref('admin/settings').set(settings);
            state.adminSettings = settings;
            showToast('Settings saved', 'success');
        }

        async function toggleUserStatus(userId, isActive) {
            await firebaseDB.ref(`users/${userId}`).update({ is_active: isActive });
            showToast(`User ${isActive ? 'activated' : 'blocked'}`, 'success');
            await loadAdminData();
        }

        // ============================================
        // CHART & PRICE FUNCTIONS
        // ============================================
        function initChart() {
            const chartContainer = document.getElementById('chart-container');
            if (!chartContainer) return;
            
            if (state.chart) { state.chart.remove(); state.chart = null; }
            
            state.chart = LightweightCharts.createChart(chartContainer, {
                layout: {
                    background: { color: '#0B0E11' },
                    textColor: '#EAECEF'
                },
                grid: {
                    vertLines: { color: '#1C2128' },
                    horzLines: { color: '#1C2128' }
                },
                crosshair: {
                    mode: LightweightCharts.CrosshairMode.Normal,
                    vertLine: { color: '#F0B90B', labelBackgroundColor: '#F0B90B' },
                    horzLine: { color: '#F0B90B', labelBackgroundColor: '#F0B90B' }
                },
                rightPriceScale: {
                    borderColor: '#2B3139',
                    scaleMargins: { top: 0.1, bottom: 0.1 }
                },
                timeScale: {
                    borderColor: '#2B3139',
                    timeVisible: true,
                    secondsVisible: false
                },
                handleScroll: { vertTouchDrag: false }
            });
            
            state.candlestickSeries = state.chart.addCandlestickSeries({
                upColor: '#0ECB81',
                downColor: '#F6465D',
                borderUpColor: '#0ECB81',
                borderDownColor: '#F6465D',
                wickUpColor: '#0ECB81',
                wickDownColor: '#F6465D'
            });
            
            // Add volume series
            state.volumeSeries = state.chart.addHistogramSeries({
                color: '#26a69a',
                priceFormat: { type: 'volume' },
                priceScaleId: '',
                scaleMargins: { top: 0.8, bottom: 0 }
            });
            
            generateMockCandles();
            
            window.addEventListener('resize', () => {
                if (state.chart) {
                    state.chart.applyOptions({
                        width: chartContainer.clientWidth,
                        height: chartContainer.clientHeight
                    });
                }
            });
        }

        function generateMockCandles() {
            const candles = [];
            const volumes = [];
            let price = state.currentPrice || 45000;
            const now = Date.now() / 1000;
            const interval = state.currentTimeframe === '1m' ? 60 : state.currentTimeframe === '5m' ? 300 : state.currentTimeframe === '15m' ? 900 : state.currentTimeframe === '30m' ? 1800 : state.currentTimeframe === '1H' ? 3600 : state.currentTimeframe === '4H' ? 14400 : 86400;
            
            for (let i = 100; i >= 0; i--) {
                const time = now - i * interval;
                const change = (Math.random() - 0.48) * price * 0.02;
                const open = price;
                const close = price + change;
                const high = Math.max(open, close) + Math.random() * Math.abs(change) * 0.5;
                const low = Math.min(open, close) - Math.random() * Math.abs(change) * 0.5;
                const volume = Math.random() * 100 + 10;
                
                candles.push({ time, open, high, low, close });
                volumes.push({ time, value: volume, color: close >= open ? 'rgba(14, 203, 129, 0.5)' : 'rgba(246, 70, 93, 0.5)' });
                price = close;
            }
            
            state.candlestickSeries.setData(candles);
            state.volumeSeries.setData(volumes);
            state.chart.timeScale().fitContent();
        }

        async function fetchPrices() {
            try {
                const ids = 'bitcoin,ethereum,binancecoin,solana,ripple,dogecoin,cardano,matic-network';
                const response = await fetch(`https://api.coingecko.com/api/v3/simple/price?ids=${ids}&vs_currencies=usd&include_24hr_change=true&include_24hr_vol=true&include_24hr_high_low=true`);
                const data = await response.json();
                
                const mapping = {
                    'bitcoin': 0, 'ethereum': 1, 'binancecoin': 2, 'solana': 3,
                    'ripple': 4, 'dogecoin': 5, 'cardano': 6, 'matic-network': 7
                };
                
                Object.entries(data).forEach(([key, value]) => {
                    const idx = mapping[key];
                    if (idx !== undefined) {
                        CONFIG.pairs[idx].price = value.usd;
                        CONFIG.pairs[idx].change = value.usd_24h_change;
                        CONFIG.pairs[idx].volume = value.usd_24h_vol;
                        CONFIG.pairs[idx].high = value.usd_24h_high;
                        CONFIG.pairs[idx].low = value.usd_24h_low;
                    }
                });
                
                updatePriceDisplay();
            } catch (error) { console.error('Price fetch error:', error); }
        }

        function updatePriceDisplay() {
            const pair = CONFIG.pairs.find(p => p.symbol === state.currentPair);
            if (!pair) return;
            
            state.currentPrice = pair.price;
            
            const priceEl = document.getElementById('current-price');
            const changeEl = document.getElementById('price-change');
            const highEl = document.getElementById('price-high');
            const lowEl = document.getElementById('price-low');
            const volEl = document.getElementById('price-volume');
            
            if (priceEl) {
                priceEl.textContent = formatPrice(pair.price);
                priceEl.className = `text-3xl font-mono font-bold ${pair.change >= 0 ? 'text-buy-green' : 'text-sell-red'}`;
            }
            if (changeEl) {
                changeEl.textContent = (pair.change >= 0 ? '+' : '') + pair.change.toFixed(2) + '%';
                changeEl.className = `text-sm ${pair.change >= 0 ? 'text-buy-green' : 'text-sell-red'}`;
            }
            if (highEl) highEl.textContent = formatPrice(pair.high);
            if (lowEl) lowEl.textContent = formatPrice(pair.low);
            if (volEl) volEl.textContent = formatCompactNumber(pair.volume);
        }

        function generateOrderBook() {
            const bids = [], asks = [];
            const basePrice = state.currentPrice || 45000;
            
            for (let i = 0; i < 20; i++) {
                const bidPrice = basePrice - (i + 1) * (basePrice * 0.0001);
                const askPrice = basePrice + (i + 1) * (basePrice * 0.0001);
                const bidAmount = (Math.random() * 5 + 0.01).toFixed(4);
                const askAmount = (Math.random() * 5 + 0.01).toFixed(4);
                const bidTotal = (bidPrice * bidAmount).toFixed(2);
                const askTotal = (askPrice * askAmount).toFixed(2);
                
                bids.push({ price: bidPrice, amount: bidAmount, total: bidTotal, depth: Math.random() * 80 + 20 });
                asks.push({ price: askPrice, amount: askAmount, total: askTotal, depth: Math.random() * 80 + 20 });
            }
            
            state.orderBook = { bids, asks, lastUpdate: Date.now() };
            renderOrderBook();
        }

        function renderOrderBook() {
            const bidsContainer = document.getElementById('bids-container');
            const asksContainer = document.getElementById('asks-container');
            
            if (bidsContainer) {
                bidsContainer.innerHTML = state.orderBook.bids.map((bid, i) => `
                    <div class="order-bar buy orderbook-row flex justify-between items-center" style="--depth: ${bid.depth}%" onclick="setOrderPrice(${bid.price})">
                        <span class="order-bar-content text-buy-green font-mono w-1/3">${formatPrice(bid.price)}</span>
                        <span class="order-bar-content font-mono text-text-secondary w-1/3 text-right">${bid.amount}</span>
                        <span class="order-bar-content font-mono text-text-secondary w-1/3 text-right">${bid.total}</span>
                    </div>
                `).join('');
            }
            
            if (asksContainer) {
                asksContainer.innerHTML = state.orderBook.asks.slice().reverse().map((ask, i) => `
                    <div class="order-bar sell orderbook-row flex justify-between items-center" style="--depth: ${ask.depth}%" onclick="setOrderPrice(${ask.price})">
                        <span class="order-bar-content text-sell-red font-mono w-1/3">${formatPrice(ask.price)}</span>
                        <span class="order-bar-content font-mono text-text-secondary w-1/3 text-right">${ask.amount}</span>
                        <span class="order-bar-content font-mono text-text-secondary w-1/3 text-right">${ask.total}</span>
                    </div>
                `).join('');
            }
        }

        function setOrderPrice(price) {
            const priceInput = document.getElementById('order-price');
            if (priceInput) priceInput.value = price.toFixed(2);
            updateOrderTotal();
        }

        function updateOrderTotal() {
            const price = parseFloat(document.getElementById('order-price')?.value) || 0;
            const amount = parseFloat(document.getElementById('order-amount')?.value) || 0;
            const totalEl = document.getElementById('order-total');
            if (totalEl) totalEl.textContent = formatCurrency(price * amount);
        }

        function updateWalletDisplay() {
            const spotBalance = document.getElementById('spot-balance');
            const futuresBalance = document.getElementById('futures-balance');
            const marginBalance = document.getElementById('margin-balance');
            
            if (spotBalance) spotBalance.textContent = formatCurrency(state.wallet.spot.USDT);
            if (futuresBalance) futuresBalance.textContent = formatCurrency(state.wallet.futures.USDT);
            if (marginBalance) marginBalance.textContent = formatCurrency(state.wallet.margin.USDT);
        }

        function renderOrders() {
            const container = document.getElementById('orders-list');
            if (!container) return;
            
            const openOrders = state.orders.filter(o => o.status === 'open');
            
            if (openOrders.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8">
                        <i class="fas fa-clipboard-list text-4xl text-text-muted mb-3"></i>
                        <p class="text-text-secondary text-sm">No open orders</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = openOrders.map(order => `
                <div class="flex justify-between items-center p-3 border-b border-border hover:bg-card-hover transition">
                    <div>
                        <div class="flex items-center gap-2 mb-1">
                            <span class="text-xs font-semibold ${order.side === 'buy' ? 'text-buy-green' : 'text-sell-red'}">${order.side.toUpperCase()}</span>
                            <span class="text-sm text-text-primary">${order.pair}</span>
                            <span class="text-xs text-text-muted">${order.type}</span>
                        </div>
                        <div class="text-xs text-text-secondary">
                            ${formatPrice(order.price)} Ã— ${order.amount} = ${formatCurrency(order.price * order.amount)}
                        </div>
                    </div>
                    <button onclick="cancelOrder('${order.id}')" class="text-sell-red hover:text-sell-red-dark text-sm px-3 py-1 rounded hover:bg-sell-red/10 transition">
                        Cancel
                    </button>
                </div>
            `).join('');
        }

        // ============================================
        // PAGE RENDERERS
        // ============================================
        function renderHome() {
            return `
                <div class="min-h-screen">
                    <!-- Header -->
                    <header class="sticky top-0 z-50 glass border-b border-border">
                        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                            <div class="flex justify-between items-center h-16">
                                <div class="flex items-center gap-8">
                                    <a href="#" onclick="navigateTo('home')" class="flex items-center gap-2 group">
                                        <div class="w-10 h-10 bg-gradient-to-br from-accent-yellow to-yellow-500 rounded-xl flex items-center justify-center group-hover:scale-105 transition">
                                            <span class="text-bg font-bold text-xl">T</span>
                                        </div>
                                        <span class="text-xl font-bold gradient-text">TREDING.STORE</span>
                                    </a>
                                    <nav class="hidden lg:flex items-center gap-6">
                                        <a href="#" onclick="navigateTo('trading')" class="text-text-secondary hover:text-text-primary transition">Trade</a>
                                        <a href="#" onclick="navigateTo('markets')" class="text-text-secondary hover:text-text-primary transition">Markets</a>
                                        <a href="#" onclick="navigateTo('nft')" class="text-text-secondary hover:text-text-primary transition">NFT</a>
                                        <a href="#" onclick="navigateTo('wallet')" class="text-text-secondary hover:text-text-primary transition">Wallet</a>
                                        <a href="#" onclick="navigateTo('earn')" class="text-text-secondary hover:text-text-primary transition">Earn</a>
                                    </nav>
                                </div>
                                <div class="flex items-center gap-4">
                                    ${state.user ? `
                                        <button onclick="navigateTo('notifications')" class="relative text-text-secondary hover:text-text-primary transition">
                                            <i class="fas fa-bell text-lg"></i>
                                            ${state.unreadCount > 0 ? `<span class="absolute -top-1 -right-1 w-4 h-4 bg-sell-red rounded-full text-xs flex items-center justify-center">${state.unreadCount}</span>` : ''}
                                        </button>
                                        <div class="flex items-center gap-3 cursor-pointer" onclick="navigateTo('profile')">
                                            <img src="${state.profile?.avatar || 'https://ui-avatars.com/api/?name=User&background=F0B90B&color=0B0E11'}" class="w-8 h-8 rounded-full border border-border">
                                            <span class="text-text-secondary hidden sm:block">${state.profile?.name || 'Trader'}</span>
                                        </div>
                                    ` : `
                                        <button onclick="navigateTo('login')" class="text-text-secondary hover:text-text-primary transition">Login</button>
                                        <button onclick="navigateTo('register')" class="btn-primary px-4 py-2 rounded-lg text-sm font-semibold">Register</button>
                                    `}
                                </div>
                            </div>
                        </div>
                    </header>

                    <!-- Hero Section -->
                    <section class="relative py-20 overflow-hidden">
                        <div class="absolute inset-0 bg-gradient-to-br from-accent-yellow/5 via-transparent to-buy-green/5"></div>
                        <div class="absolute top-20 right-20 w-96 h-96 bg-accent-yellow/10 rounded-full blur-3xl"></div>
                        <div class="absolute bottom-20 left-20 w-72 h-72 bg-buy-green/10 rounded-full blur-3xl"></div>
                        
                        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative">
                            <div class="text-center max-w-3xl mx-auto">
                                <div class="inline-flex items-center gap-2 px-4 py-2 bg-card border border-border rounded-full mb-6">
                                    <span class="live-indicator text-xs text-buy-green"></span>
                                    <span class="text-xs text-text-secondary">24/7 Trading Available</span>
                                </div>
                                <h1 class="text-5xl md:text-7xl font-bold mb-6 leading-tight">
                                    Trade Crypto <span class="gradient-text">Like a Pro</span>
                                </h1>
                                <p class="text-xl text-text-secondary mb-8">
                                    Professional cryptocurrency exchange with advanced trading tools, NFT marketplace, and secure wallet management.
                                </p>
                                <div class="flex flex-col sm:flex-row gap-4 justify-center">
                                    <button onclick="navigateTo('trading')" class="btn-primary px-8 py-4 rounded-xl text-lg font-semibold">
                                        Start Trading
                                    </button>
                                    <button onclick="navigateTo('nft')" class="px-8 py-4 rounded-xl text-lg font-medium border border-border hover:bg-card transition flex items-center justify-center gap-2">
                                        <i class="fas fa-image"></i> Explore NFTs
                                    </button>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Price Ticker -->
                    <section class="border-y border-border bg-card/50 overflow-hidden">
                        <div class="price-ticker px-4 py-3" id="price-ticker">
                            ${CONFIG.pairs.map(p => `
                                <div class="flex-shrink-0 flex items-center gap-3 px-4 border-r border-border">
                                    <span class="font-semibold text-sm">${p.symbol}</span>
                                    <span class="font-mono text-sm ${p.change >= 0 ? 'text-buy-green' : 'text-sell-red'}">${formatPrice(p.price)}</span>
                                    <span class="text-xs ${p.change >= 0 ? 'text-buy-green' : 'text-sell-red'}">${p.change >= 0 ? '+' : ''}${(p.change || 0).toFixed(2)}%</span>
                                </div>
                            `).join('')}
                        </div>
                    </section>

                    <!-- Stats Section -->
                    <section class="py-16">
                        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-8">
                                <div class="text-center p-6 bg-card border border-border rounded-xl">
                                    <div class="text-3xl font-bold gradient-text mb-1">$2.5B+</div>
                                    <div class="text-text-secondary text-sm">24h Volume</div>
                                </div>
                                <div class="text-center p-6 bg-card border border-border rounded-xl">
                                    <div class="text-3xl font-bold gradient-text mb-1">500+</div>
                                    <div class="text-text-secondary text-sm">Trading Pairs</div>
                                </div>
                                <div class="text-center p-6 bg-card border border-border rounded-xl">
                                    <div class="text-3xl font-bold gradient-text mb-1">10M+</div>
                                    <div class="text-text-secondary text-sm">Active Users</div>
                                </div>
                                <div class="text-center p-6 bg-card border border-border rounded-xl">
                                    <div class="text-3xl font-bold gradient-text mb-1">0.1%</div>
                                    <div class="text-text-secondary text-sm">Trading Fee</div>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Features Section -->
                    <section class="py-20 border-y border-border">
                        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                            <h2 class="text-3xl font-bold text-center mb-12">Why Choose <span class="gradient-text">TREDING.STORE</span></h2>
                            <div class="grid md:grid-cols-3 gap-8">
                                <div class="p-6 rounded-xl border border-border bg-card hover:border-accent-yellow transition group">
                                    <div class="w-14 h-14 bg-accent-yellow/10 rounded-xl flex items-center justify-center mb-4 group-hover:bg-accent-yellow/20 transition">
                                        <i class="fas fa-chart-line text-accent-yellow text-2xl"></i>
                                    </div>
                                    <h3 class="text-xl font-semibold mb-2">Advanced Trading</h3>
                                    <p class="text-text-secondary">Professional charts with TradingView integration, multiple order types, and real-time data.</p>
                                </div>
                                <div class="p-6 rounded-xl border border-border bg-card hover:border-buy-green transition group">
                                    <div class="w-14 h-14 bg-buy-green/10 rounded-xl flex items-center justify-center mb-4 group-hover:bg-buy-green/20 transition">
                                        <i class="fas fa-shield-alt text-buy-green text-2xl"></i>
                                    </div>
                                    <h3 class="text-xl font-semibold mb-2">Secure Wallet</h3>
                                    <p class="text-text-secondary">Multi-layer security with cold storage, 2FA, and insurance fund protection.</p>
                                </div>
                                <div class="p-6 rounded-xl border border-border bg-card hover:border-purple-500 transition group">
                                    <div class="w-14 h-14 bg-purple-500/10 rounded-xl flex items-center justify-center mb-4 group-hover:bg-purple-500/20 transition">
                                        <i class="fas fa-image text-purple-500 text-2xl"></i>
                                    </div>
                                    <h3 class="text-xl font-semibold mb-2">NFT Marketplace</h3>
                                    <p class="text-text-secondary">Buy, sell, and trade exclusive NFTs with low fees and instant settlements.</p>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- NFT Preview Section -->
                    <section class="py-20">
                        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                            <div class="flex justify-between items-center mb-8">
                                <h2 class="text-3xl font-bold">Trending <span class="gradient-text">NFTs</span></h2>
                                <button onclick="navigateTo('nft')" class="text-accent-yellow hover:underline">View All <i class="fas fa-arrow-right ml-1"></i></button>
                            </div>
                            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6" id="nft-preview">
                                <!-- NFTs will be loaded here -->
                            </div>
                        </div>
                    </section>

                    <!-- Footer -->
                    <footer class="border-t border-border py-12">
                        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                            <div class="grid md:grid-cols-4 gap-8 mb-8">
                                <div>
                                    <div class="flex items-center gap-2 mb-4">
                                        <div class="w-8 h-8 bg-gradient-to-br from-accent-yellow to-yellow-500 rounded-lg flex items-center justify-center">
                                            <span class="text-bg font-bold text-sm">T</span>
                                        </div>
                                        <span class="font-bold gradient-text">TREDING.STORE</span>
                                    </div>
                                    <p class="text-text-secondary text-sm">Professional cryptocurrency exchange for traders worldwide.</p>
                                </div>
                                <div>
                                    <h4 class="font-semibold mb-4">Products</h4>
                                    <ul class="space-y-2 text-sm text-text-secondary">
                                        <li><a href="#" onclick="navigateTo('trading')" class="hover:text-text-primary">Spot Trading</a></li>
                                        <li><a href="#" onclick="navigateTo('futures')" class="hover:text-text-primary">Futures</a></li>
                                        <li><a href="#" onclick="navigateTo('nft')" class="hover:text-text-primary">NFT Marketplace</a></li>
                                        <li><a href="#" onclick="navigateTo('earn')" class="hover:text-text-primary">Earn</a></li>
                                    </ul>
                                </div>
                                <div>
                                    <h4 class="font-semibold mb-4">Support</h4>
                                    <ul class="space-y-2 text-sm text-text-secondary">
                                        <li><a href="#" class="hover:text-text-primary">Help Center</a></li>
                                        <li><a href="#" class="hover:text-text-primary">Trading Fees</a></li>
                                        <li><a href="#" class="hover:text-text-primary">API Docs</a></li>
                                        <li><a href="#admin" onclick="navigateTo('admin-login')" class="hover:text-text-primary">Admin</a></li>
                                    </ul>
                                </div>
                                <div>
                                    <h4 class="font-semibold mb-4">Community</h4>
                                    <div class="flex gap-4">
                                        <a href="#" class="w-10 h-10 bg-card border border-border rounded-lg flex items-center justify-center hover:border-accent-yellow transition"><i class="fab fa-telegram"></i></a>
                                        <a href="#" class="w-10 h-10 bg-card border border-border rounded-lg flex items-center justify-center hover:border-accent-yellow transition"><i class="fab fa-twitter"></i></a>
                                        <a href="#" class="w-10 h-10 bg-card border border-border rounded-lg flex items-center justify-center hover:border-accent-yellow transition"><i class="fab fa-discord"></i></a>
                                    </div>
                                </div>
                            </div>
                            <div class="border-t border-border pt-8 flex flex-col md:flex-row justify-between items-center">
                                <div class="text-text-secondary text-sm">Â© 2024 TREDING.STORE - All rights reserved</div>
                                <div class="flex gap-6 mt-4 md:mt-0 text-sm text-text-secondary">
                                    <a href="#" class="hover:text-text-primary">Terms</a>
                                    <a href="#" class="hover:text-text-primary">Privacy</a>
                                    <a href="#" class="hover:text-text-primary">Cookies</a>
                                </div>
                            </div>
                        </div>
                    </footer>
                </div>
                ${renderMobileNav('home')}
            `;
        }

        function renderLogin() {
            return `
                <div class="min-h-screen flex items-center justify-center p-4">
                    <div class="w-full max-w-md">
                        <div class="text-center mb-8">
                            <div class="w-16 h-16 bg-gradient-to-br from-accent-yellow to-yellow-500 rounded-2xl flex items-center justify-center mx-auto mb-4">
                                <span class="text-bg font-bold text-2xl">T</span>
                            </div>
                            <h1 class="text-2xl font-bold">Welcome Back</h1>
                            <p class="text-text-secondary mt-2">Sign in to your TREDING.STORE account</p>
                        </div>
                        
                        <div class="bg-card border border-border rounded-2xl p-6">
                            <form onsubmit="handleLogin(event)">
                                <div class="mb-4">
                                    <label class="block text-sm text-text-secondary mb-2">Email</label>
                                    <input type="email" id="login-email" class="input-field w-full px-4 py-3 rounded-xl" placeholder="Enter your email" required>
                                </div>
                                <div class="mb-6">
                                    <label class="block text-sm text-text-secondary mb-2">Password</label>
                                    <input type="password" id="login-password" class="input-field w-full px-4 py-3 rounded-xl" placeholder="Enter your password" required>
                                </div>
                                <button type="submit" class="btn-primary w-full py-3 rounded-xl font-semibold mb-4">
                                    Sign In
                                </button>
                            </form>
                            
                            <div class="relative my-6">
                                <div class="absolute inset-0 flex items-center">
                                    <div class="w-full border-t border-border"></div>
                                </div>
                                <div class="relative flex justify-center text-sm">
                                    <span class="px-2 bg-card text-text-secondary">Or continue with</span>
                                </div>
                            </div>
                            
                            <button onclick="signInWithGoogle()" class="w-full py-3 rounded-xl border border-border hover:bg-card-hover transition flex items-center justify-center gap-2">
                                <i class="fab fa-google text-red-500"></i>
                                Continue with Google
                            </button>
                        </div>
                        
                        <p class="text-center mt-6 text-text-secondary">
                            Don't have an account? 
                            <a href="#" onclick="navigateTo('register')" class="text-accent-yellow hover:underline font-medium">Register</a>
                        </p>
                        <p class="text-center mt-4">
                            <a href="#" onclick="navigateTo('home')" class="text-text-secondary hover:text-text-primary text-sm">
                                <i class="fas fa-arrow-left mr-1"></i> Back to home
                            </a>
                        </p>
                    </div>
                </div>
            `;
        }

        function renderRegister() {
            return `
                <div class="min-h-screen flex items-center justify-center p-4">
                    <div class="w-full max-w-md">
                        <div class="text-center mb-8">
                            <div class="w-16 h-16 bg-gradient-to-br from-accent-yellow to-yellow-500 rounded-2xl flex items-center justify-center mx-auto mb-4">
                                <span class="text-bg font-bold text-2xl">T</span>
                            </div>
                            <h1 class="text-2xl font-bold">Create Account</h1>
                            <p class="text-text-secondary mt-2">Start your crypto journey today</p>
                        </div>
                        
                        <div class="bg-card border border-border rounded-2xl p-6">
                            <form onsubmit="handleRegister(event)">
                                <div class="mb-4">
                                    <label class="block text-sm text-text-secondary mb-2">Full Name</label>
                                    <input type="text" id="reg-name" class="input-field w-full px-4 py-3 rounded-xl" placeholder="Enter your name" required>
                                </div>
                                <div class="mb-4">
                                    <label class="block text-sm text-text-secondary mb-2">Email</label>
                                    <input type="email" id="reg-email" class="input-field w-full px-4 py-3 rounded-xl" placeholder="Enter your email" required>
                                </div>
                                <div class="mb-6">
                                    <label class="block text-sm text-text-secondary mb-2">Password</label>
                                    <input type="password" id="reg-password" class="input-field w-full px-4 py-3 rounded-xl" placeholder="Create password (min 8 chars)" required minlength="8">
                                </div>
                                <button type="submit" class="btn-primary w-full py-3 rounded-xl font-semibold mb-4">
                                    Create Account
                                </button>
                            </form>
                            
                            <div class="relative my-6">
                                <div class="absolute inset-0 flex items-center">
                                    <div class="w-full border-t border-border"></div>
                                </div>
                                <div class="relative flex justify-center text-sm">
                                    <span class="px-2 bg-card text-text-secondary">Or continue with</span>
                                </div>
                            </div>
                            
                            <button onclick="signInWithGoogle()" class="w-full py-3 rounded-xl border border-border hover:bg-card-hover transition flex items-center justify-center gap-2">
                                <i class="fab fa-google text-red-500"></i>
                                Continue with Google
                            </button>
                        </div>
                        
                        <p class="text-center mt-6 text-text-secondary">
                            Already have an account? 
                            <a href="#" onclick="navigateTo('login')" class="text-accent-yellow hover:underline font-medium">Sign in</a>
                        </p>
                        <p class="text-center mt-4">
                            <a href="#" onclick="navigateTo('home')" class="text-text-secondary hover:text-text-primary text-sm">
                                <i class="fas fa-arrow-left mr-1"></i> Back to home
                            </a>
                        </p>
                    </div>
                </div>
            `;
        }

        function renderTrading() {
            const [base, quote] = state.currentPair.split('/');
            return `
                <div class="min-h-screen flex flex-col pb-16 lg:pb-0">
                    <!-- Header -->
                    <header class="sticky top-0 z-50 glass border-b border-border">
                        <div class="px-4">
                            <div class="flex justify-between items-center h-14">
                                <div class="flex items-center gap-4">
                                    <a href="#" onclick="navigateTo('home')" class="flex items-center gap-2">
                                        <div class="w-8 h-8 bg-gradient-to-br from-accent-yellow to-yellow-500 rounded-lg flex items-center justify-center">
                                            <span class="text-bg font-bold text-sm">T</span>
                                        </div>
                                    </a>
                                    <div class="flex items-center gap-3">
                                        <select id="pair-select" onchange="changePair(this.value)" class="bg-card border border-border rounded-lg px-3 py-1.5 text-sm font-semibold">
                                            ${CONFIG.pairs.map(p => `<option value="${p.symbol}" ${p.symbol === state.currentPair ? 'selected' : ''}>${p.symbol}</option>`).join('')}
                                        </select>
                                        <div class="hidden md:block">
                                            <span id="current-price" class="text-2xl font-mono font-bold">--</span>
                                            <span id="price-change" class="text-sm ml-2">--</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="flex items-center gap-4">
                                    ${state.user ? `
                                        <button onclick="navigateTo('wallet')" class="text-text-secondary hover:text-text-primary transition">
                                            <i class="fas fa-wallet text-lg"></i>
                                        </button>
                                        <div class="w-8 h-8 rounded-full overflow-hidden border border-border cursor-pointer" onclick="navigateTo('profile')">
                                            <img src="${state.profile?.avatar || 'https://ui-avatars.com/api/?name=User&background=F0B90B&color=0B0E11'}" class="w-full h-full object-cover">
                                        </div>
                                    ` : `
                                        <button onclick="navigateTo('login')" class="text-sm text-text-secondary hover:text-text-primary">Login</button>
                                    `}
                                </div>
                            </div>
                        </div>
                    </header>

                    <!-- Price Stats Bar -->
                    <div class="flex items-center gap-6 px-4 py-2 border-b border-border bg-card/50 text-sm overflow-x-auto">
                        <div class="flex-shrink-0"><span class="text-text-muted">24h High</span> <span id="price-high" class="font-mono ml-1">--</span></div>
                        <div class="flex-shrink-0"><span class="text-text-muted">24h Low</span> <span id="price-low" class="font-mono ml-1">--</span></div>
                        <div class="flex-shrink-0"><span class="text-text-muted">24h Vol</span> <span id="price-volume" class="font-mono ml-1">--</span></div>
                        <div class="flex-shrink-0 live-indicator text-xs text-buy-green"></div>
                    </div>

                    <!-- Trading Layout -->
                    <div class="flex-1 flex trading-layout overflow-hidden">
                        <!-- Chart & Orders Section -->
                        <div class="flex-1 flex flex-col min-w-0">
                            <!-- Timeframe Selector -->
                            <div class="flex items-center gap-1 p-2 border-b border-border overflow-x-auto">
                                ${['1m', '5m', '15m', '30m', '1H', '4H', '1D', '1W'].map(tf => `
                                    <button class="px-3 py-1 text-xs rounded-lg ${tf === state.currentTimeframe ? 'bg-accent-yellow text-bg font-semibold' : 'text-text-secondary hover:text-text-primary hover:bg-card'}" onclick="changeTimeframe('${tf}')">${tf}</button>
                                `).join('')}
                            </div>
                            
                            <!-- Chart -->
                            <div class="flex-1 relative min-h-[300px]">
                                <div id="chart-container"></div>
                            </div>
                            
                            <!-- Orders Panel -->
                            <div class="h-48 border-t border-border bg-card hidden lg:block">
                                <div class="flex border-b border-border">
                                    <button class="tab active px-4 py-2 text-sm font-medium" onclick="switchOrderTab(this, 'open')">Open Orders (${state.orders.filter(o => o.status === 'open').length})</button>
                                    <button class="tab px-4 py-2 text-sm text-text-secondary" onclick="switchOrderTab(this, 'history')">Order History</button>
                                    <button class="tab px-4 py-2 text-sm text-text-secondary" onclick="switchOrderTab(this, 'trades')">Trade History</button>
                                </div>
                                <div id="orders-list" class="overflow-y-auto h-[calc(100%-41px)] p-2">
                                    <div class="text-center text-text-secondary py-8">No open orders</div>
                                </div>
                            </div>
                        </div>

                        <!-- Order Book -->
                        <div class="w-64 border-l border-border bg-card hidden lg:flex flex-col">
                            <div class="p-3 border-b border-border font-semibold text-sm flex justify-between items-center">
                                <span>Order Book</span>
                                <i class="fas fa-chart-bar text-text-muted text-xs"></i>
                            </div>
                            <div class="flex-1 overflow-hidden flex flex-col">
                                <div id="asks-container" class="flex-1 overflow-y-auto"></div>
                                <div class="py-2 text-center border-y border-border bg-card/50">
                                    <span id="mid-price" class="text-xl font-mono font-bold">${formatPrice(state.currentPrice)}</span>
                                </div>
                                <div id="bids-container" class="flex-1 overflow-y-auto"></div>
                            </div>
                        </div>

                        <!-- Trade Panel -->
                        <div class="w-80 border-l border-border bg-card flex flex-col trading-panel">
                            <div class="flex border-b border-border">
                                <button id="buy-tab" class="flex-1 py-3 text-sm font-semibold text-buy-green border-b-2 border-buy-green bg-buy-green/5" onclick="switchTradeSide('buy')">Buy ${base}</button>
                                <button id="sell-tab" class="flex-1 py-3 text-sm font-semibold text-text-secondary" onclick="switchTradeSide('sell')">Sell ${base}</button>
                            </div>
                            
                            <div class="p-4 flex-1 overflow-y-auto">
                                <!-- Order Type -->
                                <div class="flex gap-2 mb-4">
                                    <button class="flex-1 py-2 text-xs rounded-lg bg-hover-bg text-text-primary font-medium">Limit</button>
                                    <button class="flex-1 py-2 text-xs rounded-lg text-text-secondary hover:bg-hover-bg">Market</button>
                                    <button class="flex-1 py-2 text-xs rounded-lg text-text-secondary hover:bg-hover-bg">Stop</button>
                                </div>
                                
                                <!-- Price Input -->
                                <div class="mb-4">
                                    <label class="block text-xs text-text-secondary mb-1">Price (${quote})</label>
                                    <div class="relative">
                                        <input type="number" id="order-price" class="input-field w-full px-3 py-2.5 rounded-lg text-sm" value="${state.currentPrice.toFixed(2)}" oninput="updateOrderTotal()">
                                        <span class="absolute right-3 top-2.5 text-xs text-text-muted">${quote}</span>
                                    </div>
                                </div>
                                
                                <!-- Amount Input -->
                                <div class="mb-4">
                                    <label class="block text-xs text-text-secondary mb-1">Amount (${base})</label>
                                    <div class="relative">
                                        <input type="number" id="order-amount" class="input-field w-full px-3 py-2.5 rounded-lg text-sm" placeholder="0.00" oninput="updateOrderTotal()">
                                        <span class="absolute right-3 top-2.5 text-xs text-text-muted">${base}</span>
                                    </div>
                                </div>
                                
                                <!-- Percentage Buttons -->
                                <div class="flex gap-2 mb-4">
                                    ${['25%', '50%', '75%', '100%'].map(pct => `<button class="pct-btn flex-1" onclick="setOrderPercentage('${pct}')">${pct}</button>`).join('')}
                                </div>
                                
                                <!-- Total -->
                                <div class="flex justify-between text-sm mb-4 p-3 bg-card-hover rounded-lg">
                                    <span class="text-text-secondary">Total</span>
                                    <span id="order-total" class="font-mono font-semibold">${formatCurrency(0)}</span>
                                </div>
                                
                                <!-- Available Balance -->
                                <div class="flex justify-between text-xs mb-4">
                                    <span class="text-text-muted">Available</span>
                                    <span class="font-mono">${formatCurrency(state.wallet.spot[quote] || 0)} ${quote}</span>
                                </div>
                                
                                <!-- Buy/Sell Button -->
                                <button id="trade-btn" onclick="executeTrade('buy')" class="btn-buy w-full py-3 rounded-xl font-semibold">
                                    Buy ${base}
                                </button>
                            </div>
                        </div>
                    </div>
                    ${renderMobileNav('trading')}
                </div>
            `;
        }

        function renderMarkets() {
            return `
                <div class="min-h-screen pb-16 lg:pb-0">
                    <!-- Header -->
                    <header class="sticky top-0 z-50 glass border-b border-border">
                        <div class="px-4">
                            <div class="flex justify-between items-center h-14">
                                <div class="flex items-center gap-4">
                                    <a href="#" onclick="navigateTo('home')" class="flex items-center gap-2">
                                        <div class="w-8 h-8 bg-gradient-to-br from-accent-yellow to-yellow-500 rounded-lg flex items-center justify-center">
                                            <span class="text-bg font-bold text-sm">T</span>
                                        </div>
                                    </a>
                                    <h1 class="font-semibold">Markets</h1>
                                </div>
                                <div class="flex items-center gap-4">
                                    ${state.user ? `
                                        <div class="w-8 h-8 rounded-full overflow-hidden border border-border cursor-pointer" onclick="navigateTo('profile')">
                                            <img src="${state.profile?.avatar || 'https://ui-avatars.com/api/?name=User&background=F0B90B&color=0B0E11'}" class="w-full h-full object-cover">
                                        </div>
                                    ` : `
                                        <button onclick="navigateTo('login')" class="text-sm text-text-secondary hover:text-text-primary">Login</button>
                                    `}
                                </div>
                            </div>
                        </div>
                    </header>

                    <!-- Markets Content -->
                    <div class="p-4">
                        <!-- Search & Filter -->
                        <div class="flex gap-4 mb-4">
                            <div class="flex-1 relative">
                                <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-text-muted"></i>
                                <input type="text" placeholder="Search coin..." class="input-field w-full pl-10 pr-4 py-2.5 rounded-xl text-sm">
                            </div>
                        </div>

                        <!-- Market Tabs -->
                        <div class="flex gap-2 mb-4 overflow-x-auto">
                            <button class="px-4 py-2 bg-accent-yellow text-bg rounded-lg text-sm font-semibold">USDT</button>
                            <button class="px-4 py-2 bg-card border border-border rounded-lg text-sm text-text-secondary hover:text-text-primary">BTC</button>
                            <button class="px-4 py-2 bg-card border border-border rounded-lg text-sm text-text-secondary hover:text-text-primary">ETH</button>
                            <button class="px-4 py-2 bg-card border border-border rounded-lg text-sm text-text-secondary hover:text-text-primary">â­ Favorites</button>
                        </div>

                        <!-- Markets Table -->
                        <div class="bg-card border border-border rounded-xl overflow-hidden">
                            <table class="w-full">
                                <thead>
                                    <tr class="text-xs text-text-muted border-b border-border">
                                        <th class="text-left p-4">Pair</th>
                                        <th class="text-right p-4">Price</th>
                                        <th class="text-right p-4">24h Change</th>
                                        <th class="text-right p-4 hidden sm:table-cell">24h High</th>
                                        <th class="text-right p-4 hidden sm:table-cell">24h Low</th>
                                        <th class="text-right p-4 hidden md:table-cell">Volume</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${CONFIG.pairs.map(pair => `
                                        <tr class="border-b border-border hover:bg-card-hover cursor-pointer transition" onclick="selectPair('${pair.symbol}')">
                                            <td class="p-4">
                                                <div class="flex items-center gap-3">
                                                    <div class="w-10 h-10 bg-gradient-to-br from-accent-yellow/20 to-yellow-500/20 rounded-full flex items-center justify-center">
                                                        <span class="text-sm font-bold">${pair.base[0]}</span>
                                                    </div>
                                                    <div>
                                                        <div class="font-semibold">${pair.symbol}</div>
                                                        <div class="text-xs text-text-muted">${pair.base}</div>
                                                    </div>
                                                </div>
                                            </td>
                                            <td class="p-4 text-right font-mono font-semibold">${formatPrice(pair.price || 0)}</td>
                                            <td class="p-4 text-right">
                                                <span class="${(pair.change || 0) >= 0 ? 'text-buy-green' : 'text-sell-red'} font-medium">
                                                    ${(pair.change || 0) >= 0 ? '+' : ''}${(pair.change || 0).toFixed(2)}%
                                                </span>
                                            </td>
                                            <td class="p-4 text-right font-mono hidden sm:table-cell">${formatPrice(pair.high || 0)}</td>
                                            <td class="p-4 text-right font-mono hidden sm:table-cell">${formatPrice(pair.low || 0)}</td>
                                            <td class="p-4 text-right hidden md:table-cell">$${formatCompactNumber(pair.volume || 0)}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                    ${renderMobileNav('markets')}
                </div>
            `;
        }

        function renderWallet() {
            const totalBalance = Object.values(state.wallet.spot).reduce((a, b) => a + (typeof b === 'number' ? b : 0), 0);
            return `
                <div class="min-h-screen pb-16 lg:pb-0">
                    <!-- Header -->
                    <header class="sticky top-0 z-50 glass border-b border-border">
                        <div class="px-4">
                            <div class="flex justify-between items-center h-14">
                                <div class="flex items-center gap-4">
                                    <a href="#" onclick="navigateTo('home')" class="flex items-center gap-2">
                                        <div class="w-8 h-8 bg-gradient-to-br from-accent-yellow to-yellow-500 rounded-lg flex items-center justify-center">
                                            <span class="text-bg font-bold text-sm">T</span>
                                        </div>
                                    </a>
                                    <h1 class="font-semibold">Wallet</h1>
                                </div>
                                <div class="flex items-center gap-4">
                                    <div class="w-8 h-8 rounded-full overflow-hidden border border-border cursor-pointer" onclick="navigateTo('profile')">
                                        <img src="${state.profile?.avatar || 'https://ui-avatars.com/api/?name=User&background=F0B90B&color=0B0E11'}" class="w-full h-full object-cover">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </header>

                    <div class="p-4 max-w-4xl mx-auto">
                        <!-- Total Balance Card -->
                        <div class="bg-gradient-to-br from-accent-yellow/20 to-yellow-500/10 border border-accent-yellow/30 rounded-2xl p-6 mb-6">
                            <div class="text-text-secondary text-sm mb-1">Total Balance</div>
                            <div class="text-4xl font-bold font-mono mb-4">${formatCurrency(totalBalance)}</div>
                            <div class="flex gap-3">
                                <button onclick="navigateTo('deposit')" class="flex-1 bg-buy-green hover:bg-buy-green-dark text-white py-3 rounded-xl font-semibold transition flex items-center justify-center gap-2">
                                    <i class="fas fa-arrow-down"></i> Deposit
                                </button>
                                <button onclick="navigateTo('withdraw')" class="flex-1 bg-sell-red hover:bg-sell-red-dark text-white py-3 rounded-xl font-semibold transition flex items-center justify-center gap-2">
                                    <i class="fas fa-arrow-up"></i> Withdraw
                                </button>
                                <button onclick="navigateTo('transfer')" class="flex-1 bg-card hover:bg-card-hover border border-border py-3 rounded-xl font-semibold transition flex items-center justify-center gap-2">
                                    <i class="fas fa-exchange-alt"></i> Transfer
                                </button>
                            </div>
                        </div>

                        <!-- Wallet Tabs -->
                        <div class="bg-card border border-border rounded-2xl overflow-hidden mb-6">
                            <div class="flex border-b border-border">
                                <button class="tab active flex-1 py-3 text-sm font-semibold" onclick="switchWalletTab(this, 'spot')">Spot</button>
                                <button class="tab flex-1 py-3 text-sm text-text-secondary" onclick="switchWalletTab(this, 'futures')">Futures</button>
                                <button class="tab flex-1 py-3 text-sm text-text-secondary" onclick="switchWalletTab(this, 'margin')">Margin</button>
                            </div>
                            
                            <div class="p-4">
                                <div class="flex justify-between items-center mb-4">
                                    <div>
                                        <div class="text-text-secondary text-sm">Available</div>
                                        <div id="spot-balance" class="text-2xl font-bold font-mono">${formatCurrency(state.wallet.spot.USDT)}</div>
                                    </div>
                                    <div class="text-right">
                                        <div class="text-text-secondary text-sm">In Orders</div>
                                        <div class="text-lg font-mono">${formatCurrency(0)}</div>
                                    </div>
                                </div>
                                
                                <!-- Assets List -->
                                <div class="space-y-2">
                                    ${Object.entries(state.wallet.spot).filter(([k, v]) => typeof v === 'number' && v > 0).map(([coin, balance]) => `
                                        <div class="flex justify-between items-center p-3 bg-card-hover rounded-xl">
                                            <div class="flex items-center gap-3">
                                                <div class="w-10 h-10 bg-gradient-to-br from-accent-yellow/20 to-yellow-500/20 rounded-full flex items-center justify-center">
                                                    <span class="font-bold text-sm">${coin[0]}</span>
                                                </div>
                                                <div>
                                                    <div class="font-semibold">${coin}</div>
                                                    <div class="text-xs text-text-muted">${coin === 'USDT' ? 'Tether' : coin}</div>
                                                </div>
                                            </div>
                                            <div class="text-right">
                                                <div class="font-mono font-semibold">${formatNumber(balance, coin === 'USDT' ? 2 : 6)}</div>
                                                <div class="text-xs text-text-muted">${formatCurrency(coin === 'USDT' ? balance : balance * (CONFIG.pairs.find(p => p.base === coin)?.price || 0))}</div>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        </div>

                        <!-- Recent Transactions -->
                        <div class="bg-card border border-border rounded-2xl p-4">
                            <h3 class="font-semibold mb-4">Recent Transactions</h3>
                            ${state.deposits.length === 0 && state.withdrawals.length === 0 ? `
                                <div class="text-center text-text-secondary py-8">
                                    <i class="fas fa-history text-4xl mb-3 opacity-50"></i>
                                    <p>No transactions yet</p>
                                </div>
                            ` : `
                                <div class="space-y-3">
                                    ${[...state.deposits.map(d => ({...d, type: 'deposit'})), ...state.withdrawals.map(w => ({...w, type: 'withdrawal'}))]
                                        .sort((a, b) => new Date(b.created_at) - new Date(a.created_at))
                                        .slice(0, 5)
                                        .map(tx => `
                                            <div class="flex justify-between items-center p-3 bg-card-hover rounded-xl">
                                                <div class="flex items-center gap-3">
                                                    <div class="w-10 h-10 ${tx.type === 'deposit' ? 'bg-buy-green/20' : 'bg-sell-red/20'} rounded-full flex items-center justify-center">
                                                        <i class="fas ${tx.type === 'deposit' ? 'fa-arrow-down text-buy-green' : 'fa-arrow-up text-sell-red'}"></i>
                                                    </div>
                                                    <div>
                                                        <div class="font-semibold">${tx.type === 'deposit' ? 'Deposit' : 'Withdrawal'}</div>
                                                        <div class="text-xs text-text-muted">${timeAgo(tx.created_at)}</div>
                                                    </div>
                                                </div>
                                                <div class="text-right">
                                                    <div class="font-mono font-semibold ${tx.type === 'deposit' ? 'text-buy-green' : 'text-sell-red'}">${tx.type === 'deposit' ? '+' : '-'}${formatCurrency(tx.amount)}</div>
                                                    <span class="badge badge-${tx.status}">${tx.status}</span>
                                                </div>
                                            </div>
                                        `).join('')}
                                </div>
                            `}
                        </div>
                    </div>
                    ${renderMobileNav('wallet')}
                </div>
            `;
        }

        function renderDeposit() {
            return `
                <div class="min-h-screen pb-16 lg:pb-0">
                    <!-- Header -->
                    <header class="sticky top-0 z-50 glass border-b border-border">
                        <div class="px-4">
                            <div class="flex justify-between items-center h-14">
                                <div class="flex items-center gap-4">
                                    <button onclick="navigateTo('wallet')" class="text-text-secondary hover:text-text-primary">
                                        <i class="fas fa-arrow-left"></i>
                                    </button>
                                    <h1 class="font-semibold">Deposit</h1>
                                </div>
                            </div>
                        </div>
                    </header>

                    <div class="p-4 max-w-2xl mx-auto">
                        <div class="bg-card border border-border rounded-2xl p-6">
                            <h2 class="text-xl font-semibold mb-2">Select Payment Method</h2>
                            <p class="text-text-secondary text-sm mb-6">Choose how you want to deposit funds</p>
                            
                            <!-- Payment Methods -->
                            <div class="space-y-3 mb-6">
                                <div class="p-4 border border-border rounded-xl hover:border-accent-yellow cursor-pointer transition ${state.paymentMethods.upi.status === 'active' ? '' : 'opacity-50'}" onclick="${state.paymentMethods.upi.status === 'active' ? "selectDepositMethod('upi')" : ''}">
                                    <div class="flex items-center gap-4">
                                        <div class="w-12 h-12 bg-accent-yellow/20 rounded-xl flex items-center justify-center">
                                            <i class="fas fa-qrcode text-accent-yellow text-xl"></i>
                                        </div>
                                        <div class="flex-1">
                                            <div class="font-semibold">UPI Payment</div>
                                            <div class="text-sm text-text-secondary">Instant deposit via UPI</div>
                                        </div>
                                        <i class="fas fa-chevron-right text-text-muted"></i>
                                    </div>
                                </div>
                                
                                <div class="p-4 border border-border rounded-xl hover:border-accent-yellow cursor-pointer transition ${state.paymentMethods.bank.status === 'active' ? '' : 'opacity-50'}" onclick="${state.paymentMethods.bank.status === 'active' ? "selectDepositMethod('bank')" : ''}">
                                    <div class="flex items-center gap-4">
                                        <div class="w-12 h-12 bg-buy-green/20 rounded-xl flex items-center justify-center">
                                            <i class="fas fa-university text-buy-green text-xl"></i>
                                        </div>
                                        <div class="flex-1">
                                            <div class="font-semibold">Bank Transfer</div>
                                            <div class="text-sm text-text-secondary">NEFT/IMRT/RTGS</div>
                                        </div>
                                        <i class="fas fa-chevron-right text-text-muted"></i>
                                    </div>
                                </div>
                                
                                <div class="p-4 border border-border rounded-xl hover:border-accent-yellow cursor-pointer transition ${state.paymentMethods.crypto.status === 'active' ? '' : 'opacity-50'}" onclick="${state.paymentMethods.crypto.status === 'active' ? "selectDepositMethod('crypto')" : ''}">
                                    <div class="flex items-center gap-4">
                                        <div class="w-12 h-12 bg-purple-500/20 rounded-xl flex items-center justify-center">
                                            <i class="fab fa-bitcoin text-purple-500 text-xl"></i>
                                        </div>
                                        <div class="flex-1">
                                            <div class="font-semibold">Cryptocurrency</div>
                                            <div class="text-sm text-text-secondary">BTC, ETH, USDT & more</div>
                                        </div>
                                        <i class="fas fa-chevron-right text-text-muted"></i>
                                    </div>
                                </div>
                            </div>

                            <!-- Deposit Form -->
                            <div id="deposit-form" class="hidden">
                                <div class="mb-4">
                                    <label class="block text-sm text-text-secondary mb-2">Amount (USDT)</label>
                                    <input type="number" id="deposit-amount" class="input-field w-full px-4 py-3 rounded-xl" placeholder="Min ${state.paymentMethods.upi.min || 100}">
                                    <div class="flex justify-between text-xs text-text-muted mt-1">
                                        <span>Min: $${state.paymentMethods.upi.min || 100}</span>
                                        <span>Max: $${state.paymentMethods.upi.max || 100000}</span>
                                    </div>
                                </div>
                                
                                <!-- UPI Details -->
                                <div id="upi-details" class="hidden mb-4">
                                    <div class="bg-card-hover p-4 rounded-xl text-center">
                                        <div class="text-text-secondary text-sm mb-3">Scan QR Code to Pay</div>
                                        <div class="w-48 h-48 bg-white mx-auto rounded-xl flex items-center justify-center mb-4">
                                            <i class="fas fa-qrcode text-black text-7xl"></i>
                                        </div>
                                        <div class="mb-2">
                                            <div class="text-xs text-text-muted mb-1">UPI ID</div>
                                            <div class="flex items-center justify-center gap-2">
                                                <span class="font-mono text-lg allow-select copy-text">${state.paymentMethods.upi.upiId}</span>
                                                <button onclick="copyToClipboard('${state.paymentMethods.upi.upiId}', 'UPI ID')" class="copy-btn"><i class="fas fa-copy"></i></button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Bank Details -->
                                <div id="bank-details" class="hidden mb-4">
                                    <div class="bg-card-hover p-4 rounded-xl">
                                        <div class="text-text-secondary text-sm mb-3">Bank Account Details</div>
                                        <div class="space-y-3">
                                            <div class="flex justify-between items-center p-2 bg-card rounded-lg">
                                                <span class="text-text-muted text-sm">Account Name</span>
                                                <span class="font-semibold allow-select copy-text">${state.paymentMethods.bank.accountName}</span>
                                            </div>
                                            <div class="flex justify-between items-center p-2 bg-card rounded-lg">
                                                <span class="text-text-muted text-sm">Account Number</span>
                                                <div class="flex items-center gap-2">
                                                    <span class="font-mono allow-select copy-text">${state.paymentMethods.bank.accountNumber}</span>
                                                    <button onclick="copyToClipboard('${state.paymentMethods.bank.accountNumber}', 'Account Number')" class="copy-btn"><i class="fas fa-copy"></i></button>
                                                </div>
                                            </div>
                                            <div class="flex justify-between items-center p-2 bg-card rounded-lg">
                                                <span class="text-text-muted text-sm">IFSC Code</span>
                                                <div class="flex items-center gap-2">
                                                    <span class="font-mono allow-select copy-text">${state.paymentMethods.bank.ifsc}</span>
                                                    <button onclick="copyToClipboard('${state.paymentMethods.bank.ifsc}', 'IFSC')" class="copy-btn"><i class="fas fa-copy"></i></button>
                                                </div>
                                            </div>
                                            <div class="flex justify-between items-center p-2 bg-card rounded-lg">
                                                <span class="text-text-muted text-sm">Bank Name</span>
                                                <span class="font-semibold">${state.paymentMethods.bank.bankName}</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Crypto Details -->
                                <div id="crypto-details" class="hidden mb-4">
                                    <div class="bg-card-hover p-4 rounded-xl">
                                        <div class="flex gap-2 mb-4">
                                            ${Object.keys(state.paymentMethods.crypto.addresses).map((network, i) => `
                                                <button class="flex-1 py-2 ${i === 0 ? 'bg-accent-yellow text-bg' : 'bg-card text-text-secondary'} rounded-lg text-sm font-medium" onclick="switchCryptoNetwork('${network}')">${network}</button>
                                            `).join('')}
                                        </div>
                                        <div class="text-center">
                                            <div class="w-48 h-48 bg-white mx-auto rounded-xl flex items-center justify-center mb-4">
                                                <i class="fas fa-qrcode text-black text-7xl"></i>
                                            </div>
                                            <div>
                                                <div class="text-xs text-text-muted mb-1">Deposit Address</div>
                                                <div class="flex items-center justify-center gap-2">
                                                    <span id="crypto-address" class="font-mono text-sm allow-select copy-text break-all max-w-[200px]">${Object.values(state.paymentMethods.crypto.addresses)[0]}</span>
                                                    <button onclick="copyToClipboard(document.getElementById('crypto-address').textContent, 'Address')" class="copy-btn"><i class="fas fa-copy"></i></button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="mb-4">
                                    <label class="block text-sm text-text-secondary mb-2">Upload Payment Proof</label>
                                    <div class="image-preview" onclick="document.getElementById('deposit-proof').click()">
                                        <div class="text-center">
                                            <i class="fas fa-cloud-upload-alt text-3xl text-text-muted mb-2"></i>
                                            <p class="text-text-secondary text-sm">Click to upload screenshot</p>
                                        </div>
                                    </div>
                                    <input type="file" id="deposit-proof" accept="image/*" class="hidden" onchange="handleDepositProof(this)">
                                </div>
                                
                                <div class="mb-6">
                                    <label class="block text-sm text-text-secondary mb-2">UTR / Transaction ID</label>
                                    <input type="text" id="deposit-utr" class="input-field w-full px-4 py-3 rounded-xl" placeholder="Enter UTR or Transaction ID">
                                </div>
                                
                                <button onclick="submitDeposit()" class="btn-primary w-full py-3 rounded-xl font-semibold">
                                    Submit Deposit Request
                                </button>
                            </div>
                        </div>
                    </div>
                    ${renderMobileNav('wallet')}
                </div>
            `;
        }

        function renderWithdraw() {
            return `
                <div class="min-h-screen pb-16 lg:pb-0">
                    <!-- Header -->
                    <header class="sticky top-0 z-50 glass border-b border-border">
                        <div class="px-4">
                            <div class="flex justify-between items-center h-14">
                                <div class="flex items-center gap-4">
                                    <button onclick="navigateTo('wallet')" class="text-text-secondary hover:text-text-primary">
                                        <i class="fas fa-arrow-left"></i>
                                    </button>
                                    <h1 class="font-semibold">Withdraw</h1>
                                </div>
                            </div>
                        </div>
                    </header>

                    <div class="p-4 max-w-2xl mx-auto">
                        <div class="bg-card border border-border rounded-2xl p-6">
                            <div class="flex justify-between items-center mb-6">
                                <div>
                                    <h2 class="text-xl font-semibold">Withdraw Funds</h2>
                                    <p class="text-text-secondary text-sm">Withdraw to your bank or crypto wallet</p>
                                </div>
                                <div class="text-right">
                                    <div class="text-sm text-text-secondary">Available</div>
                                    <div class="font-mono font-semibold text-lg">${formatCurrency(state.wallet.spot.USDT)}</div>
                                </div>
                            </div>
                            
                            <!-- Withdrawal Method -->
                            <div class="mb-4">
                                <label class="block text-sm text-text-secondary mb-2">Withdrawal Method</label>
                                <select id="withdraw-method" class="input-field w-full px-4 py-3 rounded-xl" onchange="updateWithdrawForm()">
                                    <option value="">Select method</option>
                                    <option value="upi">UPI</option>
                                    <option value="bank">Bank Transfer</option>
                                    <option value="crypto">Cryptocurrency</option>
                                </select>
                            </div>
                            
                            <!-- Amount -->
                            <div class="mb-4">
                                <label class="block text-sm text-text-secondary mb-2">Amount (USDT)</label>
                                <input type="number" id="withdraw-amount" class="input-field w-full px-4 py-3 rounded-xl" placeholder="Enter amount" oninput="updateWithdrawReceive()">
                                <div class="flex gap-2 mt-2">
                                    ${['25%', '50%', '75%', '100%'].map(pct => `<button class="pct-btn" onclick="setWithdrawPercentage('${pct}')">${pct}</button>`).join('')}
                                </div>
                            </div>
                            
                            <!-- UPI Details -->
                            <div id="withdraw-upi-details" class="hidden mb-4">
                                <label class="block text-sm text-text-secondary mb-2">UPI ID</label>
                                <input type="text" id="withdraw-upi-id" class="input-field w-full px-4 py-3 rounded-xl" placeholder="yourname@upi">
                            </div>
                            
                            <!-- Bank Details -->
                            <div id="withdraw-bank-details" class="hidden mb-4 space-y-4">
                                <div>
                                    <label class="block text-sm text-text-secondary mb-2">Account Holder Name</label>
                                    <input type="text" id="withdraw-bank-name" class="input-field w-full px-4 py-3 rounded-xl" placeholder="Full name as per bank">
                                </div>
                                <div>
                                    <label class="block text-sm text-text-secondary mb-2">Account Number</label>
                                    <input type="text" id="withdraw-bank-account" class="input-field w-full px-4 py-3 rounded-xl" placeholder="Account number">
                                </div>
                                <div>
                                    <label class="block text-sm text-text-secondary mb-2">IFSC Code</label>
                                    <input type="text" id="withdraw-bank-ifsc" class="input-field w-full px-4 py-3 rounded-xl" placeholder="IFSC code">
                                </div>
                            </div>
                            
                            <!-- Crypto Details -->
                            <div id="withdraw-crypto-details" class="hidden mb-4">
                                <div class="flex gap-2 mb-4">
                                    <button class="flex-1 py-2 bg-accent-yellow text-bg rounded-lg text-sm font-medium">USDT-TRC20</button>
                                    <button class="flex-1 py-2 bg-card text-text-secondary rounded-lg text-sm">USDT-ERC20</button>
                                    <button class="flex-1 py-2 bg-card text-text-secondary rounded-lg text-sm">BTC</button>
                                </div>
                                <label class="block text-sm text-text-secondary mb-2">Wallet Address</label>
                                <input type="text" id="withdraw-crypto-address" class="input-field w-full px-4 py-3 rounded-xl" placeholder="Enter wallet address">
                                <p class="text-xs text-text-muted mt-1"><i class="fas fa-exclamation-triangle mr-1"></i>Double check your address</p>
                            </div>
                            
                            <!-- Fee Info -->
                            <div class="bg-card-hover p-4 rounded-xl mb-6">
                                <div class="flex justify-between text-sm mb-2">
                                    <span class="text-text-secondary">Network Fee</span>
                                    <span class="font-mono">1 USDT</span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span class="text-text-secondary">You will receive</span>
                                    <span id="withdraw-receive" class="font-mono font-semibold">0.00 USDT</span>
                                </div>
                            </div>
                            
                            <button onclick="submitWithdrawal()" class="btn-sell w-full py-3 rounded-xl font-semibold">
                                Submit Withdrawal Request
                            </button>
                            
                            <p class="text-center text-sm text-text-muted mt-4">
                                <i class="fas fa-info-circle mr-1"></i>
                                Withdrawals are processed within 24 hours
                            </p>
                        </div>
                    </div>
                    ${renderMobileNav('wallet')}
                </div>
            `;
        }

        function renderNFT() {
            return `
                <div class="min-h-screen pb-16 lg:pb-0">
                    <!-- Header -->
                    <header class="sticky top-0 z-50 glass border-b border-border">
                        <div class="px-4">
                            <div class="flex justify-between items-center h-14">
                                <div class="flex items-center gap-4">
                                    <a href="#" onclick="navigateTo('home')" class="flex items-center gap-2">
                                        <div class="w-8 h-8 bg-gradient-to-br from-accent-yellow to-yellow-500 rounded-lg flex items-center justify-center">
                                            <span class="text-bg font-bold text-sm">T</span>
                                        </div>
                                    </a>
                                    <h1 class="font-semibold">NFT Marketplace</h1>
                                </div>
                                <div class="flex items-center gap-4">
                                    <button class="text-text-secondary hover:text-text-primary">
                                        <i class="fas fa-search text-lg"></i>
                                    </button>
                                    ${state.user ? `
                                        <div class="w-8 h-8 rounded-full overflow-hidden border border-border cursor-pointer" onclick="navigateTo('profile')">
                                            <img src="${state.profile?.avatar || 'https://ui-avatars.com/api/?name=User&background=F0B90B&color=0B0E11'}" class="w-full h-full object-cover">
                                        </div>
                                    ` : `
                                        <button onclick="navigateTo('login')" class="text-sm text-text-secondary hover:text-text-primary">Login</button>
                                    `}
                                </div>
                            </div>
                        </div>
                    </header>

                    <!-- NFT Hero -->
                    <div class="bg-gradient-to-r from-purple-600/20 via-pink-600/20 to-accent-yellow/20 py-12">
                        <div class="max-w-7xl mx-auto px-4 text-center">
                            <h1 class="text-4xl md:text-5xl font-bold mb-4">Discover, Collect & Sell <span class="gradient-text">NFTs</span></h1>
                            <p class="text-text-secondary mb-6 max-w-2xl mx-auto">Explore the best digital art and collectibles on TREDING.STORE NFT Marketplace</p>
                            <div class="flex gap-4 justify-center">
                                <button onclick="document.getElementById('nft-grid').scrollIntoView({behavior: 'smooth'})" class="btn-primary px-6 py-3 rounded-xl font-semibold">Explore</button>
                                ${state.isAdmin ? `<button onclick="showCreateNFTModal()" class="px-6 py-3 rounded-xl border border-border hover:bg-card transition flex items-center gap-2"><i class="fas fa-plus"></i> Create NFT</button>` : ''}
                            </div>
                        </div>
                    </div>

                    <!-- NFT Filters -->
                    <div class="max-w-7xl mx-auto px-4 py-6">
                        <div class="flex flex-wrap gap-3 mb-6">
                            <button class="px-4 py-2 bg-accent-yellow text-bg rounded-lg text-sm font-semibold">All</button>
                            <button class="px-4 py-2 bg-card border border-border rounded-lg text-sm text-text-secondary hover:text-text-primary">Art</button>
                            <button class="px-4 py-2 bg-card border border-border rounded-lg text-sm text-text-secondary hover:text-text-primary">Collectibles</button>
                            <button class="px-4 py-2 bg-card border border-border rounded-lg text-sm text-text-secondary hover:text-text-primary">Music</button>
                            <button class="px-4 py-2 bg-card border border-border rounded-lg text-sm text-text-secondary hover:text-text-primary">Gaming</button>
                        </div>

                        <!-- NFT Grid -->
                        <div id="nft-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                            ${state.nftListings.length === 0 ? `
                                <div class="col-span-full text-center py-12">
                                    <i class="fas fa-image text-6xl text-text-muted mb-4"></i>
                                    <p class="text-text-secondary">No NFTs available yet</p>
                                    ${state.isAdmin ? `<button onclick="showCreateNFTModal()" class="btn-primary px-6 py-2 rounded-lg mt-4">Create First NFT</button>` : ''}
                                </div>
                            ` : state.nftListings.map(nft => `
                                <div class="nft-card border border-border rounded-2xl overflow-hidden">
                                    <div class="aspect-square bg-gradient-to-br from-purple-500/10 via-pink-500/10 to-accent-yellow/10 flex items-center justify-center relative">
                                        ${nft.image ? `<img src="${nft.image}" class="w-full h-full object-cover">` : `<i class="fas fa-image text-6xl text-text-muted"></i>`}
                                        <div class="absolute top-3 right-3 bg-card/80 backdrop-blur px-2 py-1 rounded-lg text-xs">
                                            <i class="fas fa-heart text-sell-red mr-1"></i>${nft.likes || 0}
                                        </div>
                                    </div>
                                    <div class="p-4">
                                        <div class="flex justify-between items-start mb-2">
                                            <div>
                                                <h3 class="font-semibold truncate">${nft.name}</h3>
                                                <p class="text-xs text-text-muted">by ${nft.creator_name || 'Unknown'}</p>
                                            </div>
                                        </div>
                                        <div class="flex justify-between items-center mt-4">
                                            <div>
                                                <div class="text-xs text-text-muted">Price</div>
                                                <div class="font-mono font-bold text-accent-yellow">${nft.price} ${nft.currency}</div>
                                            </div>
                                            <button onclick="${nft.owner === state.user?.id ? 'showSellNFTModal("' + nft.id + '")' : 'buyNFT("' + nft.id + '")'}" class="${nft.owner === state.user?.id ? 'bg-card border border-border hover:border-accent-yellow' : 'btn-primary'} px-4 py-2 rounded-lg text-sm font-medium transition">
                                                ${nft.owner === state.user?.id ? 'Sell' : 'Buy Now'}
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <!-- How It Works -->
                    <div class="max-w-7xl mx-auto px-4 py-12 border-t border-border">
                        <h2 class="text-2xl font-bold text-center mb-8">How It <span class="gradient-text">Works</span></h2>
                        <div class="grid md:grid-cols-3 gap-6">
                            <div class="bg-card border border-border rounded-2xl p-6 text-center">
                                <div class="w-16 h-16 bg-purple-500/20 rounded-2xl flex items-center justify-center mx-auto mb-4">
                                    <i class="fas fa-wallet text-purple-500 text-2xl"></i>
                                </div>
                                <h3 class="font-semibold mb-2">Connect Wallet</h3>
                                <p class="text-text-secondary text-sm">Connect your MetaMask or WalletConnect to start trading NFTs</p>
                            </div>
                            <div class="bg-card border border-border rounded-2xl p-6 text-center">
                                <div class="w-16 h-16 bg-pink-500/20 rounded-2xl flex items-center justify-center mx-auto mb-4">
                                    <i class="fas fa-paint-brush text-pink-500 text-2xl"></i>
                                </div>
                                <h3 class="font-semibold mb-2">Create or Buy</h3>
                                <p class="text-text-secondary text-sm">Upload your artwork or browse and buy from our collection</p>
                            </div>
                            <div class="bg-card border border-border rounded-2xl p-6 text-center">
                                <div class="w-16 h-16 bg-accent-yellow/20 rounded-2xl flex items-center justify-center mx-auto mb-4">
                                    <i class="fas fa-exchange-alt text-accent-yellow text-2xl"></i>
                                </div>
                                <h3 class="font-semibold mb-2">Trade</h3>
                                <p class="text-text-secondary text-sm">Buy, sell and trade NFTs with low fees and instant settlements</p>
                            </div>
                        </div>
                    </div>
                    ${renderMobileNav('nft')}
                </div>
            `;
        }

        function renderMyNFTs() {
            return `
                <div class="min-h-screen pb-16 lg:pb-0">
                    <!-- Header -->
                    <header class="sticky top-0 z-50 glass border-b border-border">
                        <div class="px-4">
                            <div class="flex justify-between items-center h-14">
                                <div class="flex items-center gap-4">
                                    <button onclick="navigateTo('nft')" class="text-text-secondary hover:text-text-primary">
                                        <i class="fas fa-arrow-left"></i>
                                    </button>
                                    <h1 class="font-semibold">My NFTs</h1>
                                </div>
                            </div>
                        </div>
                    </header>

                    <div class="p-4 max-w-7xl mx-auto">
                        ${state.myNFTs.length === 0 ? `
                            <div class="text-center py-12">
                                <i class="fas fa-image text-6xl text-text-muted mb-4"></i>
                                <h2 class="text-xl font-semibold mb-2">No NFTs Yet</h2>
                                <p class="text-text-secondary mb-4">Start collecting NFTs from our marketplace</p>
                                <button onclick="navigateTo('nft')" class="btn-primary px-6 py-2 rounded-lg">Explore NFTs</button>
                            </div>
                        ` : `
                            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                                ${state.myNFTs.map(nft => `
                                    <div class="nft-card border border-border rounded-2xl overflow-hidden">
                                        <div class="aspect-square bg-gradient-to-br from-purple-500/10 via-pink-500/10 to-accent-yellow/10 flex items-center justify-center">
                                            ${nft.image ? `<img src="${nft.image}" class="w-full h-full object-cover">` : `<i class="fas fa-image text-6xl text-text-muted"></i>`}
                                        </div>
                                        <div class="p-4">
                                            <h3 class="font-semibold mb-1">${nft.name}</h3>
                                            <p class="text-xs text-text-muted mb-3">Bought for ${nft.bought_price} ${nft.currency}</p>
                                            <button onclick="showSellNFTModal('${nft.id}')" class="w-full bg-card border border-border hover:border-accent-yellow py-2 rounded-lg text-sm font-medium transition">
                                                Sell NFT
                                            </button>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        `}
                    </div>
                    ${renderMobileNav('nft')}
                </div>
            `;
        }

        function renderAdmin() {
            if (!state.isAdmin) { navigateTo('admin-login'); return ''; }
            
            const pendingDeposits = Object.values(state.adminDeposits || {}).filter(d => d.status === 'pending');
            const pendingWithdrawals = Object.values(state.adminWithdrawals || {}).filter(w => w.status === 'pending');
            const totalUsers = Object.keys(state.adminUsers || {}).length;
            
            return `
                <div class="min-h-screen flex">
                    <!-- Sidebar -->
                    <aside class="admin-sidebar" id="admin-sidebar">
                        <div class="p-4 border-b border-border">
                            <div class="flex items-center gap-2">
                                <div class="w-10 h-10 bg-gradient-to-br from-sell-red to-red-600 rounded-xl flex items-center justify-center">
                                    <i class="fas fa-cog text-white"></i>
                                </div>
                                <div>
                                    <div class="font-bold">Admin Panel</div>
                                    <div class="text-xs text-text-muted">TREDING.STORE</div>
                                </div>
                            </div>
                        </div>
                        <nav class="p-2">
                            ${[
                                { id: 'dashboard', icon: 'fa-tachometer-alt', label: 'Dashboard' },
                                { id: 'users', icon: 'fa-users', label: 'Users' },
                                { id: 'deposits', icon: 'fa-arrow-down', label: `Deposits ${pendingDeposits.length > 0 ? `<span class="ml-auto bg-sell-red text-white text-xs px-2 py-0.5 rounded-full">${pendingDeposits.length}</span>` : ''}` },
                                { id: 'withdrawals', icon: 'fa-arrow-up', label: `Withdrawals ${pendingWithdrawals.length > 0 ? `<span class="ml-auto bg-sell-red text-white text-xs px-2 py-0.5 rounded-full">${pendingWithdrawals.length}</span>` : ''}` },
                                { id: 'nft', icon: 'fa-image', label: 'NFT Management' },
                                { id: 'payments', icon: 'fa-credit-card', label: 'Payment Methods' },
                                { id: 'settings', icon: 'fa-cog', label: 'Site Settings' }
                            ].map(item => `
                                <button onclick="switchAdminTab('${item.id}')" class="admin-nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-xl text-text-secondary hover:bg-card-hover hover:text-text-primary transition ${item.id === 'dashboard' ? 'bg-card-hover text-text-primary' : ''}">
                                    <i class="fas ${item.icon} w-5"></i>
                                    <span class="flex-1 text-left">${item.label}</span>
                                </button>
                            `).join('')}
                        </nav>
                        <div class="absolute bottom-0 left-0 right-0 p-4 border-t border-border">
                            <button onclick="navigateTo('home')" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl text-text-secondary hover:bg-card-hover transition">
                                <i class="fas fa-sign-out-alt w-5"></i>
                                Exit Admin
                            </button>
                        </div>
                    </aside>

                    <!-- Main Content -->
                    <main class="admin-content">
                        <!-- Header -->
                        <header class="sticky top-0 z-40 glass border-b border-border">
                            <div class="px-6 py-4 flex justify-between items-center">
                                <div class="flex items-center gap-4">
                                    <button onclick="document.getElementById('admin-sidebar').classList.toggle('open')" class="lg:hidden text-text-secondary">
                                        <i class="fas fa-bars"></i>
                                    </button>
                                    <h1 class="text-xl font-semibold">Dashboard</h1>
                                </div>
                                <div class="flex items-center gap-4">
                                    <button class="text-text-secondary hover:text-text-primary relative">
                                        <i class="fas fa-bell text-lg"></i>
                                        ${pendingDeposits.length + pendingWithdrawals.length > 0 ? `<span class="absolute -top-1 -right-1 w-4 h-4 bg-sell-red rounded-full text-xs flex items-center justify-center">${pendingDeposits.length + pendingWithdrawals.length}</span>` : ''}
                                    </button>
                                    <div class="w-8 h-8 bg-accent-yellow rounded-full flex items-center justify-center">
                                        <span class="text-bg font-bold text-sm">A</span>
                                    </div>
                                </div>
                            </div>
                        </header>

                        <div class="p-6">
                            <!-- Stats Cards -->
                            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                                <div class="bg-card border border-border rounded-2xl p-6">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <div class="text-text-secondary text-sm">Total Users</div>
                                            <div class="text-3xl font-bold mt-1">${totalUsers}</div>
                                        </div>
                                        <div class="w-12 h-12 bg-accent-yellow/20 rounded-xl flex items-center justify-center">
                                            <i class="fas fa-users text-accent-yellow"></i>
                                        </div>
                                    </div>
                                </div>
                                <div class="bg-card border border-border rounded-2xl p-6">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <div class="text-text-secondary text-sm">Pending Deposits</div>
                                            <div class="text-3xl font-bold mt-1 text-accent-yellow">${pendingDeposits.length}</div>
                                        </div>
                                        <div class="w-12 h-12 bg-buy-green/20 rounded-xl flex items-center justify-center">
                                            <i class="fas fa-arrow-down text-buy-green"></i>
                                        </div>
                                    </div>
                                </div>
                                <div class="bg-card border border-border rounded-2xl p-6">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <div class="text-text-secondary text-sm">Pending Withdrawals</div>
                                            <div class="text-3xl font-bold mt-1 text-sell-red">${pendingWithdrawals.length}</div>
                                        </div>
                                        <div class="w-12 h-12 bg-sell-red/20 rounded-xl flex items-center justify-center">
                                            <i class="fas fa-arrow-up text-sell-red"></i>
                                        </div>
                                    </div>
                                </div>
                                <div class="bg-card border border-border rounded-2xl p-6">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <div class="text-text-secondary text-sm">Total NFTs</div>
                                            <div class="text-3xl font-bold mt-1">${state.nftListings.length}</div>
                                        </div>
                                        <div class="w-12 h-12 bg-purple-500/20 rounded-xl flex items-center justify-center">
                                            <i class="fas fa-image text-purple-500"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Pending Requests -->
                            <div class="grid lg:grid-cols-2 gap-6 mb-8">
                                <!-- Pending Deposits -->
                                <div class="bg-card border border-border rounded-2xl p-6">
                                    <div class="flex justify-between items-center mb-4">
                                        <h3 class="font-semibold">Pending Deposits</h3>
                                        <span class="badge badge-pending">${pendingDeposits.length} Pending</span>
                                    </div>
                                    <div class="space-y-3 max-h-80 overflow-y-auto">
                                        ${pendingDeposits.length === 0 ? '<div class="text-center text-text-secondary py-8">No pending deposits</div>' : pendingDeposits.slice(0, 5).map(d => `
                                            <div class="p-3 bg-card-hover rounded-xl">
                                                <div class="flex justify-between items-start mb-2">
                                                    <div>
                                                        <div class="font-semibold">${formatCurrency(d.amount)}</div>
                                                        <div class="text-xs text-text-muted">${d.method.toUpperCase()} - ${d.user_email}</div>
                                                    </div>
                                                    <span class="badge badge-pending">${d.status}</span>
                                                </div>
                                                <div class="flex gap-2 mt-2">
                                                    <button onclick="approveDeposit('${d.id}', '${d.user_id}')" class="flex-1 py-1.5 bg-buy-green text-white text-xs rounded-lg hover:bg-buy-green-dark transition">Approve</button>
                                                    <button onclick="rejectDepositPrompt('${d.id}', '${d.user_id}')" class="flex-1 py-1.5 bg-sell-red text-white text-xs rounded-lg hover:bg-sell-red-dark transition">Reject</button>
                                                </div>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                                
                                <!-- Pending Withdrawals -->
                                <div class="bg-card border border-border rounded-2xl p-6">
                                    <div class="flex justify-between items-center mb-4">
                                        <h3 class="font-semibold">Pending Withdrawals</h3>
                                        <span class="badge badge-pending">${pendingWithdrawals.length} Pending</span>
                                    </div>
                                    <div class="space-y-3 max-h-80 overflow-y-auto">
                                        ${pendingWithdrawals.length === 0 ? '<div class="text-center text-text-secondary py-8">No pending withdrawals</div>' : pendingWithdrawals.slice(0, 5).map(w => `
                                            <div class="p-3 bg-card-hover rounded-xl">
                                                <div class="flex justify-between items-start mb-2">
                                                    <div>
                                                        <div class="font-semibold">${formatCurrency(w.amount)}</div>
                                                        <div class="text-xs text-text-muted">${w.method.toUpperCase()} - ${w.user_email}</div>
                                                    </div>
                                                    <span class="badge badge-pending">${w.status}</span>
                                                </div>
                                                <div class="flex gap-2 mt-2">
                                                    <button onclick="approveWithdrawal('${w.id}', '${w.user_id}')" class="flex-1 py-1.5 bg-buy-green text-white text-xs rounded-lg hover:bg-buy-green-dark transition">Approve</button>
                                                    <button onclick="rejectWithdrawalPrompt('${w.id}', '${w.user_id}')" class="flex-1 py-1.5 bg-sell-red text-white text-xs rounded-lg hover:bg-sell-red-dark transition">Reject</button>
                                                </div>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            </div>

                            <!-- Quick Actions -->
                            <div class="bg-card border border-border rounded-2xl p-6">
                                <h3 class="font-semibold mb-4">Quick Actions</h3>
                                <div class="grid grid-cols-2 sm:grid-cols-4 gap-4">
                                    <button onclick="showCreateNFTModal()" class="p-4 bg-card-hover rounded-xl hover:bg-purple-500/20 transition text-center">
                                        <i class="fas fa-plus text-purple-500 text-2xl mb-2"></i>
                                        <div class="text-sm font-medium">Create NFT</div>
                                    </button>
                                    <button onclick="showPaymentSettings()" class="p-4 bg-card-hover rounded-xl hover:bg-accent-yellow/20 transition text-center">
                                        <i class="fas fa-credit-card text-accent-yellow text-2xl mb-2"></i>
                                        <div class="text-sm font-medium">Payment Settings</div>
                                    </button>
                                    <button onclick="showSiteSettings()" class="p-4 bg-card-hover rounded-xl hover:bg-buy-green/20 transition text-center">
                                        <i class="fas fa-cog text-buy-green text-2xl mb-2"></i>
                                        <div class="text-sm font-medium">Site Settings</div>
                                    </button>
                                    <button onclick="navigateTo('home')" class="p-4 bg-card-hover rounded-xl hover:bg-sell-red/20 transition text-center">
                                        <i class="fas fa-external-link-alt text-sell-red text-2xl mb-2"></i>
                                        <div class="text-sm font-medium">View Site</div>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </main>
                </div>
            `;
        }

        function renderAdminLogin() {
            return `
                <div class="min-h-screen flex items-center justify-center p-4">
                    <div class="w-full max-w-md">
                        <div class="text-center mb-8">
                            <div class="w-16 h-16 bg-gradient-to-br from-sell-red to-red-600 rounded-2xl flex items-center justify-center mx-auto mb-4">
                                <i class="fas fa-lock text-white text-2xl"></i>
                            </div>
                            <h1 class="text-2xl font-bold">Admin Access</h1>
                            <p class="text-text-secondary mt-2">Enter admin password to continue</p>
                        </div>
                        
                        <div class="bg-card border border-border rounded-2xl p-6">
                            <form onsubmit="handleAdminLogin(event)">
                                <div class="mb-6">
                                    <label class="block text-sm text-text-secondary mb-2">Admin Password</label>
                                    <input type="password" id="admin-password" class="input-field w-full px-4 py-3 rounded-xl" placeholder="Enter admin password" required>
                                </div>
                                <button type="submit" class="btn-primary w-full py-3 rounded-xl font-semibold">
                                    Access Admin Panel
                                </button>
                            </form>
                        </div>
                        
                        <p class="text-center mt-6">
                            <a href="#" onclick="navigateTo('home')" class="text-text-secondary hover:text-text-primary text-sm">
                                <i class="fas fa-arrow-left mr-1"></i> Back to home
                            </a>
                        </p>
                    </div>
                </div>
            `;
        }

        function renderMobileNav(activeTab) {
            const tabs = [
                { id: 'home', icon: 'fa-home', label: 'Home' },
                { id: 'markets', icon: 'fa-chart-bar', label: 'Markets' },
                { id: 'trading', icon: 'fa-exchange-alt', label: 'Trade' },
                { id: 'nft', icon: 'fa-image', label: 'NFT' },
                { id: 'wallet', icon: 'fa-wallet', label: 'Wallet' }
            ];
            
            return `
                <nav class="mobile-nav fixed bottom-0 left-0 right-0 bg-card border-t border-border z-50">
                    <div class="flex justify-around py-2">
                        ${tabs.map(tab => `
                            <button onclick="navigateTo('${tab.id}')" class="flex flex-col items-center p-2 ${tab.id === activeTab ? 'text-accent-yellow' : 'text-text-secondary'}">
                                <i class="fas ${tab.icon} text-lg"></i>
                                <span class="text-xs mt-1">${tab.label}</span>
                            </button>
                        `).join('')}
                    </div>
                </nav>
            `;
        }

        // ============================================
        // NAVIGATION & EVENT HANDLERS
        // ============================================
        function navigateTo(page) {
            state.currentPage = page;
            const app = document.getElementById('app');
            
            switch(page) {
                case 'home':
                    app.innerHTML = renderHome();
                    loadNFTPreview();
                    break;
                case 'login':
                    app.innerHTML = renderLogin();
                    break;
                case 'register':
                    app.innerHTML = renderRegister();
                    break;
                case 'trading':
                    app.innerHTML = renderTrading();
                    setTimeout(() => {
                        initChart();
                        generateOrderBook();
                        renderOrders();
                        fetchPrices();
                    }, 100);
                    break;
                case 'markets':
                    app.innerHTML = renderMarkets();
                    fetchPrices();
                    break;
                case 'wallet':
                    app.innerHTML = renderWallet();
                    break;
                case 'deposit':
                    app.innerHTML = renderDeposit();
                    break;
                case 'withdraw':
                    app.innerHTML = renderWithdraw();
                    break;
                case 'transfer':
                    showToast('Transfer feature - Use internal transfer in wallet', 'info');
                    navigateTo('wallet');
                    break;
                case 'nft':
                    loadNFTListings().then(() => {
                        app.innerHTML = renderNFT();
                    });
                    break;
                case 'my-nfts':
                    app.innerHTML = renderMyNFTs();
                    break;
                case 'profile':
                    showToast('Profile page - Coming soon', 'info');
                    navigateTo('wallet');
                    break;
                case 'notifications':
                    showToast('Notifications - Coming soon', 'info');
                    break;
                case 'earn':
                    showToast('Earn feature - Coming soon', 'info');
                    break;
                case 'futures':
                    showToast('Futures trading - Coming soon', 'info');
                    navigateTo('trading');
                    break;
                case 'admin-login':
                    app.innerHTML = renderAdminLogin();
                    break;
                case 'admin':
                    loadAdminData().then(() => {
                        app.innerHTML = renderAdmin();
                    });
                    break;
                default:
                    app.innerHTML = renderHome();
            }
            
            window.scrollTo(0, 0);
        }

        // Event Handlers
        async function handleLogin(e) {
            e.preventDefault();
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            await signIn(email, password);
        }

        async function handleRegister(e) {
            e.preventDefault();
            const name = document.getElementById('reg-name').value;
            const email = document.getElementById('reg-email').value;
            const password = document.getElementById('reg-password').value;
            await signUp(email, password, name);
        }

        async function handleAdminLogin(e) {
            e.preventDefault();
            const password = document.getElementById('admin-password').value;
            await adminLogin(password);
        }

        function changePair(symbol) {
            state.currentPair = symbol;
            navigateTo('trading');
        }

        function selectPair(symbol) {
            state.currentPair = symbol;
            navigateTo('trading');
        }

        function changeTimeframe(tf) {
            state.currentTimeframe = tf;
            showToast(`Switched to ${tf} timeframe`, 'info');
            generateMockCandles();
        }

        function switchTradeSide(side) {
            const buyTab = document.getElementById('buy-tab');
            const sellTab = document.getElementById('sell-tab');
            const tradeBtn = document.getElementById('trade-btn');
            const [base] = state.currentPair.split('/');
            
            if (side === 'buy') {
                buyTab.className = 'flex-1 py-3 text-sm font-semibold text-buy-green border-b-2 border-buy-green bg-buy-green/5';
                sellTab.className = 'flex-1 py-3 text-sm font-semibold text-text-secondary';
                tradeBtn.className = 'btn-buy w-full py-3 rounded-xl font-semibold';
                tradeBtn.textContent = `Buy ${base}`;
                tradeBtn.onclick = () => executeTrade('buy');
            } else {
                buyTab.className = 'flex-1 py-3 text-sm font-semibold text-text-secondary';
                sellTab.className = 'flex-1 py-3 text-sm font-semibold text-sell-red border-b-2 border-sell-red bg-sell-red/5';
                tradeBtn.className = 'btn-sell w-full py-3 rounded-xl font-semibold';
                tradeBtn.textContent = `Sell ${base}`;
                tradeBtn.onclick = () => executeTrade('sell');
            }
        }

        function switchOrderTab(btn, tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            btn.classList.add('active');
            renderOrders();
        }

        function switchWalletTab(btn, type) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            btn.classList.add('active');
            
            const content = document.getElementById('wallet-content');
            const balance = type === 'spot' ? state.wallet.spot.USDT : type === 'futures' ? state.wallet.futures.USDT : state.wallet.margin.USDT;
            
            content.innerHTML = `
                <div class="flex justify-between items-center mb-4">
                    <div>
                        <div class="text-text-secondary text-sm">Available Balance</div>
                        <div class="text-2xl font-bold font-mono">${formatCurrency(balance)}</div>
                    </div>
                    <div class="text-right">
                        <div class="text-text-secondary text-sm">In Orders</div>
                        <div class="text-lg font-mono">${formatCurrency(0)}</div>
                    </div>
                </div>
            `;
        }

        function switchAdminTab(tab) {
            document.querySelectorAll('.admin-nav-btn').forEach(btn => {
                btn.classList.remove('bg-card-hover', 'text-text-primary');
                btn.classList.add('text-text-secondary');
            });
            event.target.closest('.admin-nav-btn').classList.add('bg-card-hover', 'text-text-primary');
            event.target.closest('.admin-nav-btn').classList.remove('text-text-secondary');
        }

        function setOrderPercentage(pct) {
            const percentage = parseInt(pct);
            const [base, quote] = state.currentPair.split('/');
            const balance = state.wallet.spot[quote] || 0;
            const price = parseFloat(document.getElementById('order-price').value) || state.currentPrice;
            const amount = (balance * percentage / 100) / price;
            document.getElementById('order-amount').value = amount.toFixed(6);
            updateOrderTotal();
        }

        function setWithdrawPercentage(pct) {
            const percentage = parseInt(pct);
            const amount = state.wallet.spot.USDT * percentage / 100;
            document.getElementById('withdraw-amount').value = amount.toFixed(2);
            updateWithdrawReceive();
        }

        function updateWithdrawReceive() {
            const amount = parseFloat(document.getElementById('withdraw-amount')?.value) || 0;
            const receiveEl = document.getElementById('withdraw-receive');
            if (receiveEl) receiveEl.textContent = formatCurrency(Math.max(0, amount - 1));
        }

        function executeTrade(side) {
            const price = parseFloat(document.getElementById('order-price').value);
            const amount = parseFloat(document.getElementById('order-amount').value);
            
            if (!price || !amount) {
                showToast('Please enter price and amount', 'error');
                return;
            }
            
            placeOrder('limit', side, price, amount);
        }

        // Deposit/Withdrawal Handlers
        function selectDepositMethod(method) {
            selectedDepositMethod = method;
            document.getElementById('deposit-form').classList.remove('hidden');
            document.getElementById('upi-details').classList.add('hidden');
            document.getElementById('bank-details').classList.add('hidden');
            document.getElementById('crypto-details').classList.add('hidden');
            document.getElementById(`${method}-details`).classList.remove('hidden');
        }

        async function handleDepositProof(input) {
            if (input.files && input.files[0]) {
                const preview = document.querySelector('.image-preview');
                preview.innerHTML = '<div class="spinner"></div>';
                
                const url = await uploadToCloudinary(input.files[0], 'deposits');
                if (url) {
                    depositProofUrl = url;
                    preview.innerHTML = `<img src="${url}" class="w-full h-full object-cover rounded-xl">`;
                    preview.classList.add('has-image');
                    showToast('Proof uploaded', 'success');
                }
            }
        }

        async function submitDeposit() {
            const amount = document.getElementById('deposit-amount').value;
            const utr = document.getElementById('deposit-utr').value;
            
            if (!amount || !selectedDepositMethod) {
                showToast('Please fill all required fields', 'error');
                return;
            }
            
            await createDeposit(amount, selectedDepositMethod, depositProofUrl, utr);
            navigateTo('wallet');
        }

        function updateWithdrawForm() {
            const method = document.getElementById('withdraw-method').value;
            document.getElementById('withdraw-upi-details').classList.add('hidden');
            document.getElementById('withdraw-bank-details').classList.add('hidden');
            document.getElementById('withdraw-crypto-details').classList.add('hidden');
            if (method) document.getElementById(`withdraw-${method}-details`).classList.remove('hidden');
        }

        async function submitWithdrawal() {
            const amount = document.getElementById('withdraw-amount').value;
            const method = document.getElementById('withdraw-method').value;
            
            if (!amount || !method) {
                showToast('Please fill all required fields', 'error');
                return;
            }
            
            let details = {};
            if (method === 'upi') {
                details.upiId = document.getElementById('withdraw-upi-id').value;
            } else if (method === 'bank') {
                details.accountName = document.getElementById('withdraw-bank-name').value;
                details.accountNumber = document.getElementById('withdraw-bank-account').value;
                details.ifsc = document.getElementById('withdraw-bank-ifsc').value;
            } else if (method === 'crypto') {
                details.address = document.getElementById('withdraw-crypto-address').value;
                details.network = 'USDT-TRC20';
            }
            
            await createWithdrawal(amount, method, details);
            navigateTo('wallet');
        }

        function switchCryptoNetwork(network) {
            const address = state.paymentMethods.crypto.addresses[network];
            document.getElementById('crypto-address').textContent = address;
        }

        // NFT Modal Functions
        function showCreateNFTModal() {
            if (!state.isAdmin) {
                showToast('Only admin can create NFTs', 'error');
                return;
            }
            
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal-content max-w-md w-full p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-bold">Create NFT</h2>
                        <button onclick="this.closest('.modal-overlay').remove()" class="text-text-muted hover:text-text-primary">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    <form onsubmit="handleCreateNFT(event)">
                        <div class="mb-4">
                            <label class="block text-sm text-text-secondary mb-2">NFT Name</label>
                            <input type="text" id="nft-name" class="input-field w-full px-4 py-3 rounded-xl" placeholder="Enter NFT name" required>
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm text-text-secondary mb-2">Description</label>
                            <textarea id="nft-description" class="input-field w-full px-4 py-3 rounded-xl" rows="3" placeholder="Enter description"></textarea>
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm text-text-secondary mb-2">Price (USDT)</label>
                            <input type="number" id="nft-price" class="input-field w-full px-4 py-3 rounded-xl" placeholder="Enter price" required>
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm text-text-secondary mb-2">Collection</label>
                            <select id="nft-collection" class="input-field w-full px-4 py-3 rounded-xl">
                                <option value="General">General</option>
                                <option value="Art">Art</option>
                                <option value="Collectibles">Collectibles</option>
                                <option value="Gaming">Gaming</option>
                            </select>
                        </div>
                        <div class="mb-6">
                            <label class="block text-sm text-text-secondary mb-2">Image</label>
                            <div class="image-preview" onclick="document.getElementById('nft-image').click()">
                                <div class="text-center">
                                    <i class="fas fa-cloud-upload-alt text-3xl text-text-muted mb-2"></i>
                                    <p class="text-text-secondary text-sm">Click to upload image</p>
                                </div>
                            </div>
                            <input type="file" id="nft-image" accept="image/*" class="hidden" onchange="handleNFTImage(this)">
                        </div>
                        <button type="submit" class="btn-primary w-full py-3 rounded-xl font-semibold">Create NFT</button>
                    </form>
                </div>
            `;
            document.body.appendChild(modal);
        }

        async function handleNFTImage(input) {
            if (input.files && input.files[0]) {
                const preview = document.querySelector('.image-preview');
                preview.innerHTML = '<div class="spinner"></div>';
                
                const url = await uploadToCloudinary(input.files[0], 'nfts');
                if (url) {
                    preview.innerHTML = `<img src="${url}" class="w-full h-full object-cover rounded-xl">`;
                    preview.dataset.imageUrl = url;
                }
            }
        }

        async function handleCreateNFT(e) {
            e.preventDefault();
            const name = document.getElementById('nft-name').value;
            const description = document.getElementById('nft-description').value;
            const price = parseFloat(document.getElementById('nft-price').value);
            const collection = document.getElementById('nft-collection').value;
            const imageUrl = document.querySelector('.image-preview').dataset.imageUrl || '';
            
            await createNFTListing(name, description, price, imageUrl, collection);
            document.querySelector('.modal-overlay').remove();
            navigateTo('nft');
        }

        function showSellNFTModal(nftId) {
            const nft = state.myNFTs.find(n => n.id === nftId);
            if (!nft) return;
            
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal-content max-w-md w-full p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-bold">Sell NFT</h2>
                        <button onclick="this.closest('.modal-overlay').remove()" class="text-text-muted hover:text-text-primary">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    <div class="text-center mb-6">
                        <div class="w-24 h-24 bg-card rounded-xl mx-auto mb-3 flex items-center justify-center">
                            ${nft.image ? `<img src="${nft.image}" class="w-full h-full object-cover rounded-xl">` : `<i class="fas fa-image text-4xl text-text-muted"></i>`}
                        </div>
                        <h3 class="font-semibold">${nft.name}</h3>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm text-text-secondary mb-2">Selling Price (USDT)</label>
                        <input type="number" id="sell-price" class="input-field w-full px-4 py-3 rounded-xl" placeholder="Enter price" value="${nft.price}">
                    </div>
                    <button onclick="confirmSellNFT('${nftId}')" class="btn-primary w-full py-3 rounded-xl font-semibold">List for Sale</button>
                </div>
            `;
            document.body.appendChild(modal);
        }

        async function confirmSellNFT(nftId) {
            const price = parseFloat(document.getElementById('sell-price').value);
            if (!price) {
                showToast('Please enter a price', 'error');
                return;
            }
            await sellNFT(nftId, price);
            document.querySelector('.modal-overlay').remove();
        }

        // Admin Functions
        function rejectDepositPrompt(depositId, userId) {
            const reason = prompt('Enter rejection reason:');
            if (reason) rejectDeposit(depositId, userId, reason);
        }

        function rejectWithdrawalPrompt(withdrawalId, userId) {
            const reason = prompt('Enter rejection reason:');
            if (reason) rejectWithdrawal(withdrawalId, userId, reason);
        }

        function showPaymentSettings() {
            showToast('Payment settings - Edit in Firebase console', 'info');
        }

        function showSiteSettings() {
            showToast('Site settings - Edit in Firebase console', 'info');
        }

        // Load NFT Preview for Home
        async function loadNFTPreview() {
            await loadNFTListings();
            const preview = document.getElementById('nft-preview');
            if (preview && state.nftListings.length > 0) {
                preview.innerHTML = state.nftListings.slice(0, 4).map(nft => `
                    <div class="nft-card border border-border rounded-2xl overflow-hidden cursor-pointer" onclick="navigateTo('nft')">
                        <div class="aspect-square bg-gradient-to-br from-purple-500/10 via-pink-500/10 to-accent-yellow/10 flex items-center justify-center">
                            ${nft.image ? `<img src="${nft.image}" class="w-full h-full object-cover">` : `<i class="fas fa-image text-4xl text-text-muted"></i>`}
                        </div>
                        <div class="p-4">
                            <h3 class="font-semibold truncate">${nft.name}</h3>
                            <div class="flex justify-between items-center mt-2">
                                <span class="font-mono text-accent-yellow">${nft.price} USDT</span>
                                <button class="text-xs bg-card-hover hover:bg-accent-yellow hover:text-bg px-3 py-1 rounded-lg transition">View</button>
                            </div>
                        </div>
                    </div>
                `).join('');
            }
        }

        // ============================================
        // INITIALIZATION
        // ============================================
        async function init() {
            initClients();
            
            // Check for existing session
            const { data: { session } } = await supabase.auth.getSession();
            if (session) {
                state.user = session.user;
                state.session = session;
                
                // Load profile
                const profileSnap = await firebaseDB.ref(`users/${session.user.id}`).once('value');
                state.profile = profileSnap.val() || {};
                
                await loadUserData();
            }
            
            // Fetch initial prices
            fetchPrices();
            setInterval(fetchPrices, 30000);
            
            // Update order book periodically
            setInterval(() => {
                if (state.currentPage === 'trading') generateOrderBook();
            }, 2000);
            
            // Check URL hash for routing
            const hash = window.location.hash.slice(1);
            if (hash === 'admin') navigateTo('admin-login');
            else navigateTo('home');
            
            // Listen for auth changes
            supabase.auth.onAuthStateChange((event, session) => {
                if (event === 'SIGNED_IN' && session) {
                    handleGoogleCallback(session.user);
                } else if (event === 'SIGNED_OUT') {
                    state.user = null;
                    state.session = null;
                    state.profile = null;
                }
            });
        }

        // Start the app
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>

        // ============================================
        // COMPREHENSIVE ADMIN PANEL FUNCTIONS
        // ============================================
        
        // Admin State
        let adminCurrentTab = 'dashboard';
        let adminData = {
            users: {},
            deposits: {},
            withdrawals: {},
            nfts: {},
            orders: {},
            trades: {},
            kyc: {},
            announcements: [],
            paymentMethods: {},
            settings: {}
        };

        // Load all admin data
        async function loadAllAdminData() {
            showLoading(true);
            
            // Load users
            const usersSnap = await firebaseDB.ref('users').once('value');
            adminData.users = usersSnap.val() || {};
            
            // Load all deposits
            const depositsSnap = await firebaseDB.ref('admin/deposits').once('value');
            adminData.deposits = depositsSnap.val() || {};
            
            // Load all withdrawals
            const withdrawalsSnap = await firebaseDB.ref('admin/withdrawals').once('value');
            adminData.withdrawals = withdrawalsSnap.val() || {};
            
            // Load NFTs
            const nftsSnap = await firebaseDB.ref('nft_listings').once('value');
            adminData.nfts = nftsSnap.val() || {};
            
            // Load all orders
            const ordersSnap = await firebaseDB.ref('orders').once('value');
            adminData.orders = ordersSnap.val() || {};
            
            // Load all trades
            const tradesSnap = await firebaseDB.ref('trades').once('value');
            adminData.trades = tradesSnap.val() || {};
            
            // Load KYC
            const kycSnap = await firebaseDB.ref('kyc').once('value');
            adminData.kyc = kycSnap.val() || {};
            
            // Load announcements
            const announcementsSnap = await firebaseDB.ref('admin/announcements').once('value');
            adminData.announcements = announcementsSnap.val() ? Object.values(announcementsSnap.val()) : [];
            
            // Load payment methods
            const paymentSnap = await firebaseDB.ref('admin/payment_methods').once('value');
            adminData.paymentMethods = paymentSnap.val() || state.paymentMethods;
            
            // Load settings
            const settingsSnap = await firebaseDB.ref('admin/settings').once('value');
            adminData.settings = settingsSnap.val() || CONFIG.siteSettings;
            
            showLoading(false);
        }

        // Render Full Admin Panel
        function renderFullAdmin() {
            if (!state.isAdmin) { 
                navigateTo('admin-login'); 
                return ''; 
            }
            
            const pendingDeposits = Object.values(adminData.deposits).filter(d => d.status === 'pending');
            const pendingWithdrawals = Object.values(adminData.withdrawals).filter(w => w.status === 'pending');
            const pendingKYC = Object.values(adminData.kyc).filter(k => k.status === 'pending');
            const totalUsers = Object.keys(adminData.users).length;
            const totalNFTs = Object.keys(adminData.nfts).length;
            
            return `
                <div class="min-h-screen flex">
                    <!-- Sidebar -->
                    <aside class="admin-sidebar" id="admin-sidebar">
                        <div class="p-4 border-b border-border">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 bg-gradient-to-br from-accent-yellow to-yellow-500 rounded-xl flex items-center justify-center">
                                    <span class="text-bg font-bold">T</span>
                                </div>
                                <div>
                                    <div class="font-bold">Admin Panel</div>
                                    <div class="text-xs text-text-muted">TREDING.STORE</div>
                                </div>
                            </div>
                        </div>
                        
                        <nav class="p-2 space-y-1">
                            ${renderAdminNavItem('dashboard', 'fa-tachometer-alt', 'Dashboard')}
                            ${renderAdminNavItem('users', 'fa-users', 'Users', Object.keys(adminData.users).length)}
                            ${renderAdminNavItem('deposits', 'fa-arrow-down', 'Deposits', pendingDeposits.length)}
                            ${renderAdminNavItem('withdrawals', 'fa-arrow-up', 'Withdrawals', pendingWithdrawals.length)}
                            ${renderAdminNavItem('nft', 'fa-image', 'NFT Management')}
                            ${renderAdminNavItem('orders', 'fa-exchange-alt', 'Orders')}
                            ${renderAdminNavItem('trades', 'fa-chart-bar', 'Trades')}
                            ${renderAdminNavItem('kyc', 'fa-id-card', 'KYC Verification', pendingKYC.length)}
                            ${renderAdminNavItem('payment-methods', 'fa-credit-card', 'Payment Methods')}
                            ${renderAdminNavItem('announcements', 'fa-bullhorn', 'Announcements')}
                            ${renderAdminNavItem('trading-pairs', 'fa-coins', 'Trading Pairs')}
                            ${renderAdminNavItem('site-settings', 'fa-cog', 'Site Settings')}
                            ${renderAdminNavItem('wallet-manager', 'fa-wallet', 'Wallet Manager')}
                            ${renderAdminNavItem('reports', 'fa-file-alt', 'Reports')}
                        </nav>
                        
                        <div class="absolute bottom-0 left-0 right-0 p-4 border-t border-border">
                            <button onclick="state.isAdmin=false; navigateTo('home')" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl text-text-secondary hover:bg-card-hover transition">
                                <i class="fas fa-sign-out-alt w-5"></i>
                                <span>Exit Admin</span>
                            </button>
                        </div>
                    </aside>

                    <!-- Main Content -->
                    <main class="admin-content">
                        <!-- Header -->
                        <header class="sticky top-0 z-40 glass border-b border-border">
                            <div class="px-6 py-4 flex justify-between items-center">
                                <div class="flex items-center gap-4">
                                    <button onclick="document.getElementById('admin-sidebar').classList.toggle('open')" class="lg:hidden text-text-secondary">
                                        <i class="fas fa-bars"></i>
                                    </button>
                                    <h1 class="text-xl font-semibold capitalize">${adminCurrentTab.replace('-', ' ')}</h1>
                                </div>
                                <div class="flex items-center gap-4">
                                    <div class="w-8 h-8 bg-accent-yellow rounded-full flex items-center justify-center">
                                        <span class="text-bg font-bold text-sm">A</span>
                                    </div>
                                </div>
                            </div>
                        </header>

                        <!-- Tab Content -->
                        <div class="p-6">
                            ${adminCurrentTab === 'dashboard' ? renderAdminDashboard(pendingDeposits, pendingWithdrawals, pendingKYC, totalUsers, totalNFTs) : ''}
                            ${adminCurrentTab === 'users' ? renderAdminUsers() : ''}
                            ${adminCurrentTab === 'deposits' ? renderAdminDeposits() : ''}
                            ${adminCurrentTab === 'withdrawals' ? renderAdminWithdrawals() : ''}
                            ${adminCurrentTab === 'nft' ? renderAdminNFT() : ''}
                            ${adminCurrentTab === 'orders' ? renderAdminOrders() : ''}
                            ${adminCurrentTab === 'trades' ? renderAdminTrades() : ''}
                            ${adminCurrentTab === 'kyc' ? renderAdminKYC() : ''}
                            ${adminCurrentTab === 'payment-methods' ? renderAdminPaymentMethods() : ''}
                            ${adminCurrentTab === 'announcements' ? renderAdminAnnouncements() : ''}
                            ${adminCurrentTab === 'trading-pairs' ? renderAdminTradingPairs() : ''}
                            ${adminCurrentTab === 'site-settings' ? renderAdminSiteSettings() : ''}
                            ${adminCurrentTab === 'wallet-manager' ? renderAdminWalletManager() : ''}
                            ${adminCurrentTab === 'reports' ? renderAdminReports() : ''}
                        </div>
                    </main>
                </div>
            `;
        }

        function renderAdminNavItem(id, icon, label, badge = 0) {
            const isActive = adminCurrentTab === id;
            return `
                <button onclick="switchAdminTab('${id}')" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl transition ${isActive ? 'bg-accent-yellow/20 text-accent-yellow' : 'text-text-secondary hover:bg-card-hover hover:text-text-primary'}">
                    <i class="fas ${icon} w-5"></i>
                    <span class="flex-1 text-left">${label}</span>
                    ${badge > 0 ? `<span class="bg-sell-red text-white text-xs px-2 py-0.5 rounded-full">${badge}</span>` : ''}
                </button>
            `;
        }

        // ============ DASHBOARD TAB ============
        function renderAdminDashboard(pendingDeposits, pendingWithdrawals, pendingKYC, totalUsers, totalNFTs) {
            const totalDeposits = Object.values(adminData.deposits).reduce((a, b) => a + (b.amount || 0), 0);
            const totalWithdrawals = Object.values(adminData.withdrawals).reduce((a, b) => a + (b.amount || 0), 0);
            
            return `
                <div class="space-y-6">
                    <!-- Stats Cards -->
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                        <div class="bg-card border border-border rounded-2xl p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <div class="text-text-secondary text-sm">Total Users</div>
                                    <div class="text-3xl font-bold mt-1">${totalUsers}</div>
                                </div>
                                <div class="w-12 h-12 bg-accent-yellow/20 rounded-xl flex items-center justify-center">
                                    <i class="fas fa-users text-accent-yellow text-xl"></i>
                                </div>
                            </div>
                        </div>
                        <div class="bg-card border border-border rounded-2xl p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <div class="text-text-secondary text-sm">Total Deposits</div>
                                    <div class="text-3xl font-bold mt-1 text-buy-green">${formatCurrency(totalDeposits)}</div>
                                </div>
                                <div class="w-12 h-12 bg-buy-green/20 rounded-xl flex items-center justify-center">
                                    <i class="fas fa-arrow-down text-buy-green text-xl"></i>
                                </div>
                            </div>
                        </div>
                        <div class="bg-card border border-border rounded-2xl p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <div class="text-text-secondary text-sm">Total Withdrawals</div>
                                    <div class="text-3xl font-bold mt-1 text-sell-red">${formatCurrency(totalWithdrawals)}</div>
                                </div>
                                <div class="w-12 h-12 bg-sell-red/20 rounded-xl flex items-center justify-center">
                                    <i class="fas fa-arrow-up text-sell-red text-xl"></i>
                                </div>
                            </div>
                        </div>
                        <div class="bg-card border border-border rounded-2xl p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <div class="text-text-secondary text-sm">Total NFTs</div>
                                    <div class="text-3xl font-bold mt-1 text-purple-500">${totalNFTs}</div>
                                </div>
                                <div class="w-12 h-12 bg-purple-500/20 rounded-xl flex items-center justify-center">
                                    <i class="fas fa-image text-purple-500 text-xl"></i>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Pending Actions -->
                    <div class="grid lg:grid-cols-3 gap-6">
                        <!-- Pending Deposits -->
                        <div class="bg-card border border-border rounded-2xl p-6">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="font-semibold">Pending Deposits</h3>
                                <span class="badge badge-pending">${pendingDeposits.length}</span>
                            </div>
                            <div class="space-y-3 max-h-80 overflow-y-auto">
                                ${pendingDeposits.length === 0 ? '<div class="text-center text-text-secondary py-8">No pending deposits</div>' : 
                                    pendingDeposits.slice(0, 5).map(d => `
                                        <div class="p-3 bg-card-hover rounded-xl">
                                            <div class="flex justify-between items-start">
                                                <div>
                                                    <div class="font-semibold">${formatCurrency(d.amount)}</div>
                                                    <div class="text-xs text-text-muted">${d.method?.toUpperCase()} - ${d.user_email}</div>
                                                </div>
                                                <span class="text-xs text-text-muted">${timeAgo(d.created_at)}</span>
                                            </div>
                                            <div class="flex gap-2 mt-2">
                                                <button onclick="approveDeposit('${d.id}', '${d.user_id}')" class="flex-1 py-1.5 bg-buy-green text-white text-xs rounded-lg">Approve</button>
                                                <button onclick="rejectDepositPrompt('${d.id}', '${d.user_id}')" class="flex-1 py-1.5 bg-sell-red text-white text-xs rounded-lg">Reject</button>
                                            </div>
                                        </div>
                                    `).join('')}
                            </div>
                            ${pendingDeposits.length > 5 ? `<button onclick="switchAdminTab('deposits')" class="w-full mt-3 text-accent-yellow text-sm">View All</button>` : ''}
                        </div>

                        <!-- Pending Withdrawals -->
                        <div class="bg-card border border-border rounded-2xl p-6">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="font-semibold">Pending Withdrawals</h3>
                                <span class="badge badge-pending">${pendingWithdrawals.length}</span>
                            </div>
                            <div class="space-y-3 max-h-80 overflow-y-auto">
                                ${pendingWithdrawals.length === 0 ? '<div class="text-center text-text-secondary py-8">No pending withdrawals</div>' : 
                                    pendingWithdrawals.slice(0, 5).map(w => `
                                        <div class="p-3 bg-card-hover rounded-xl">
                                            <div class="flex justify-between items-start">
                                                <div>
                                                    <div class="font-semibold">${formatCurrency(w.amount)}</div>
                                                    <div class="text-xs text-text-muted">${w.method?.toUpperCase()} - ${w.user_email}</div>
                                                </div>
                                                <span class="text-xs text-text-muted">${timeAgo(w.created_at)}</span>
                                            </div>
                                            <div class="flex gap-2 mt-2">
                                                <button onclick="approveWithdrawal('${w.id}', '${w.user_id}')" class="flex-1 py-1.5 bg-buy-green text-white text-xs rounded-lg">Approve</button>
                                                <button onclick="rejectWithdrawalPrompt('${w.id}', '${w.user_id}')" class="flex-1 py-1.5 bg-sell-red text-white text-xs rounded-lg">Reject</button>
                                            </div>
                                        </div>
                                    `).join('')}
                            </div>
                            ${pendingWithdrawals.length > 5 ? `<button onclick="switchAdminTab('withdrawals')" class="w-full mt-3 text-accent-yellow text-sm">View All</button>` : ''}
                        </div>

                        <!-- Pending KYC -->
                        <div class="bg-card border border-border rounded-2xl p-6">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="font-semibold">Pending KYC</h3>
                                <span class="badge badge-pending">${pendingKYC.length}</span>
                            </div>
                            <div class="space-y-3 max-h-80 overflow-y-auto">
                                ${pendingKYC.length === 0 ? '<div class="text-center text-text-secondary py-8">No pending KYC</div>' : 
                                    pendingKYC.slice(0, 5).map(k => `
                                        <div class="p-3 bg-card-hover rounded-xl">
                                            <div class="flex justify-between items-start">
                                                <div>
                                                    <div class="font-semibold">${k.name || 'Unknown'}</div>
                                                    <div class="text-xs text-text-muted">${k.email}</div>
                                                </div>
                                                <span class="text-xs text-text-muted">${timeAgo(k.submitted_at)}</span>
                                            </div>
                                            <div class="flex gap-2 mt-2">
                                                <button onclick="approveKYC('${k.user_id}')" class="flex-1 py-1.5 bg-buy-green text-white text-xs rounded-lg">Approve</button>
                                                <button onclick="rejectKYCPrompt('${k.user_id}')" class="flex-1 py-1.5 bg-sell-red text-white text-xs rounded-lg">Reject</button>
                                            </div>
                                        </div>
                                    `).join('')}
                            </div>
                            ${pendingKYC.length > 5 ? `<button onclick="switchAdminTab('kyc')" class="w-full mt-3 text-accent-yellow text-sm">View All</button>` : ''}
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="bg-card border border-border rounded-2xl p-6">
                        <h3 class="font-semibold mb-4">Quick Actions</h3>
                        <div class="grid grid-cols-2 sm:grid-cols-4 lg:grid-cols-6 gap-4">
                            <button onclick="showCreateNFTModal()" class="p-4 bg-purple-500/10 rounded-xl hover:bg-purple-500/20 transition text-center">
                                <i class="fas fa-plus text-purple-500 text-2xl mb-2"></i>
                                <div class="text-sm font-medium">Create NFT</div>
                            </button>
                            <button onclick="showAddAnnouncementModal()" class="p-4 bg-accent-yellow/10 rounded-xl hover:bg-accent-yellow/20 transition text-center">
                                <i class="fas fa-bullhorn text-accent-yellow text-2xl mb-2"></i>
                                <div class="text-sm font-medium">Announcement</div>
                            </button>
                            <button onclick="switchAdminTab('payment-methods')" class="p-4 bg-buy-green/10 rounded-xl hover:bg-buy-green/20 transition text-center">
                                <i class="fas fa-credit-card text-buy-green text-2xl mb-2"></i>
                                <div class="text-sm font-medium">Payments</div>
                            </button>
                            <button onclick="switchAdminTab('site-settings')" class="p-4 bg-accent-blue/10 rounded-xl hover:bg-accent-blue/20 transition text-center">
                                <i class="fas fa-cog text-accent-blue text-2xl mb-2"></i>
                                <div class="text-sm font-medium">Settings</div>
                            </button>
                            <button onclick="switchAdminTab('users')" class="p-4 bg-pink-500/10 rounded-xl hover:bg-pink-500/20 transition text-center">
                                <i class="fas fa-user-plus text-pink-500 text-2xl mb-2"></i>
                                <div class="text-sm font-medium">Add User</div>
                            </button>
                            <button onclick="navigateTo('home')" class="p-4 bg-sell-red/10 rounded-xl hover:bg-sell-red/20 transition text-center">
                                <i class="fas fa-external-link-alt text-sell-red text-2xl mb-2"></i>
                                <div class="text-sm font-medium">View Site</div>
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        // ============ USERS TAB ============
        function renderAdminUsers() {
            const users = Object.entries(adminData.users);
            return `
                <div class="space-y-6">
                    <div class="flex flex-wrap gap-4 justify-between items-center">
                        <div class="flex gap-4">
                            <div class="relative">
                                <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-text-muted"></i>
                                <input type="text" id="user-search" placeholder="Search users..." class="input-field pl-10 pr-4 py-2 rounded-xl text-sm w-64" oninput="filterUsers()">
                            </div>
                            <select id="user-filter" class="input-field px-4 py-2 rounded-xl text-sm" onchange="filterUsers()">
                                <option value="all">All Users</option>
                                <option value="active">Active</option>
                                <option value="blocked">Blocked</option>
                                <option value="pending_kyc">Pending KYC</option>
                            </select>
                        </div>
                        <button onclick="showAddUserModal()" class="btn-primary px-4 py-2 rounded-xl text-sm font-semibold">
                            <i class="fas fa-plus mr-2"></i>Add User
                        </button>
                    </div>

                    <div class="bg-card border border-border rounded-2xl overflow-hidden">
                        <table class="w-full">
                            <thead>
                                <tr class="text-xs text-text-muted border-b border-border">
                                    <th class="text-left p-4">User</th>
                                    <th class="text-left p-4">Email</th>
                                    <th class="text-left p-4">Status</th>
                                    <th class="text-left p-4">KYC</th>
                                    <th class="text-left p-4">Joined</th>
                                    <th class="text-right p-4">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="users-table-body">
                                ${users.map(([id, user]) => `
                                    <tr class="border-b border-border hover:bg-card-hover transition" data-user-id="${id}">
                                        <td class="p-4">
                                            <div class="flex items-center gap-3">
                                                <img src="${user.avatar || 'https://ui-avatars.com/api/?name=' + encodeURIComponent(user.name) + '&background=F0B90B&color=0B0E11'}" class="w-10 h-10 rounded-full">
                                                <div>
                                                    <div class="font-semibold">${user.name || 'Unknown'}</div>
                                                    <div class="text-xs text-text-muted">ID: ${id.slice(0, 8)}...</div>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="p-4 text-sm">${user.email}</td>
                                        <td class="p-4">
                                            <span class="badge ${user.is_active ? 'badge-approved' : 'badge-rejected'}">${user.is_active ? 'Active' : 'Blocked'}</span>
                                        </td>
                                        <td class="p-4">
                                            <span class="badge badge-${user.kyc_status === 'approved' ? 'approved' : user.kyc_status === 'pending' ? 'pending' : 'rejected'}">${user.kyc_status || 'Pending'}</span>
                                        </td>
                                        <td class="p-4 text-sm text-text-muted">${timeAgo(user.created_at)}</td>
                                        <td class="p-4 text-right">
                                            <button onclick="showUserDetails('${id}')" class="text-accent-yellow hover:underline text-sm mr-3">View</button>
                                            <button onclick="toggleUserStatus('${id}', ${!user.is_active})" class="${user.is_active ? 'text-sell-red' : 'text-buy-green'} hover:underline text-sm">
                                                ${user.is_active ? 'Block' : 'Unblock'}
                                            </button>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }

        // ============ DEPOSITS TAB ============
        function renderAdminDeposits() {
            const deposits = Object.entries(adminData.deposits).sort((a, b) => new Date(b[1].created_at) - new Date(a[1].created_at));
            const pending = deposits.filter(([_, d]) => d.status === 'pending');
            const approved = deposits.filter(([_, d]) => d.status === 'approved');
            const rejected = deposits.filter(([_, d]) => d.status === 'rejected');
            
            return `
                <div class="space-y-6">
                    <!-- Stats -->
                    <div class="grid grid-cols-3 gap-4">
                        <div class="bg-card border border-border rounded-xl p-4 text-center">
                            <div class="text-2xl font-bold text-accent-yellow">${pending.length}</div>
                            <div class="text-sm text-text-secondary">Pending</div>
                        </div>
                        <div class="bg-card border border-border rounded-xl p-4 text-center">
                            <div class="text-2xl font-bold text-buy-green">${approved.length}</div>
                            <div class="text-sm text-text-secondary">Approved</div>
                        </div>
                        <div class="bg-card border border-border rounded-xl p-4 text-center">
                            <div class="text-2xl font-bold text-sell-red">${rejected.length}</div>
                            <div class="text-sm text-text-secondary">Rejected</div>
                        </div>
                    </div>

                    <!-- Filter Tabs -->
                    <div class="flex gap-2 border-b border-border">
                        <button class="tab active px-4 py-2 text-sm" onclick="filterDeposits('all', this)">All</button>
                        <button class="tab px-4 py-2 text-sm text-text-secondary" onclick="filterDeposits('pending', this)">Pending</button>
                        <button class="tab px-4 py-2 text-sm text-text-secondary" onclick="filterDeposits('approved', this)">Approved</button>
                        <button class="tab px-4 py-2 text-sm text-text-secondary" onclick="filterDeposits('rejected', this)">Rejected</button>
                    </div>

                    <!-- Deposits Table -->
                    <div class="bg-card border border-border rounded-2xl overflow-hidden">
                        <table class="w-full">
                            <thead>
                                <tr class="text-xs text-text-muted border-b border-border">
                                    <th class="text-left p-4">ID</th>
                                    <th class="text-left p-4">User</th>
                                    <th class="text-left p-4">Amount</th>
                                    <th class="text-left p-4">Method</th>
                                    <th class="text-left p-4">Status</th>
                                    <th class="text-left p-4">Date</th>
                                    <th class="text-right p-4">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${deposits.map(([id, d]) => `
                                    <tr class="border-b border-border hover:bg-card-hover transition deposit-row" data-status="${d.status}">
                                        <td class="p-4 text-sm font-mono">${id.slice(0, 12)}...</td>
                                        <td class="p-4 text-sm">${d.user_email}</td>
                                        <td class="p-4 font-semibold">${formatCurrency(d.amount)}</td>
                                        <td class="p-4 text-sm">${d.method?.toUpperCase()}</td>
                                        <td class="p-4"><span class="badge badge-${d.status}">${d.status}</span></td>
                                        <td class="p-4 text-sm text-text-muted">${timeAgo(d.created_at)}</td>
                                        <td class="p-4 text-right">
                                            ${d.status === 'pending' ? `
                                                <button onclick="approveDeposit('${id}', '${d.user_id}')" class="text-buy-green hover:underline text-sm mr-2">Approve</button>
                                                <button onclick="rejectDepositPrompt('${id}', '${d.user_id}')" class="text-sell-red hover:underline text-sm">Reject</button>
                                            ` : `
                                                <button onclick="viewDepositDetails('${id}')" class="text-accent-yellow hover:underline text-sm">View</button>
                                            `}
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }

        // ============ WITHDRAWALS TAB ============
        function renderAdminWithdrawals() {
            const withdrawals = Object.entries(adminData.withdrawals).sort((a, b) => new Date(b[1].created_at) - new Date(a[1].created_at));
            
            return `
                <div class="space-y-6">
                    <div class="grid grid-cols-3 gap-4">
                        <div class="bg-card border border-border rounded-xl p-4 text-center">
                            <div class="text-2xl font-bold text-accent-yellow">${withdrawals.filter(([_, w]) => w.status === 'pending').length}</div>
                            <div class="text-sm text-text-secondary">Pending</div>
                        </div>
                        <div class="bg-card border border-border rounded-xl p-4 text-center">
                            <div class="text-2xl font-bold text-buy-green">${withdrawals.filter(([_, w]) => w.status === 'approved').length}</div>
                            <div class="text-sm text-text-secondary">Approved</div>
                        </div>
                        <div class="bg-card border border-border rounded-xl p-4 text-center">
                            <div class="text-2xl font-bold text-sell-red">${withdrawals.filter(([_, w]) => w.status === 'rejected').length}</div>
                            <div class="text-sm text-text-secondary">Rejected</div>
                        </div>
                    </div>

                    <div class="bg-card border border-border rounded-2xl overflow-hidden">
                        <table class="w-full">
                            <thead>
                                <tr class="text-xs text-text-muted border-b border-border">
                                    <th class="text-left p-4">ID</th>
                                    <th class="text-left p-4">User</th>
                                    <th class="text-left p-4">Amount</th>
                                    <th class="text-left p-4">Method</th>
                                    <th class="text-left p-4">Status</th>
                                    <th class="text-left p-4">Date</th>
                                    <th class="text-right p-4">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${withdrawals.map(([id, w]) => `
                                    <tr class="border-b border-border hover:bg-card-hover transition">
                                        <td class="p-4 text-sm font-mono">${id.slice(0, 12)}...</td>
                                        <td class="p-4 text-sm">${w.user_email}</td>
                                        <td class="p-4 font-semibold">${formatCurrency(w.amount)}</td>
                                        <td class="p-4 text-sm">${w.method?.toUpperCase()}</td>
                                        <td class="p-4"><span class="badge badge-${w.status}">${w.status}</span></td>
                                        <td class="p-4 text-sm text-text-muted">${timeAgo(w.created_at)}</td>
                                        <td class="p-4 text-right">
                                            ${w.status === 'pending' ? `
                                                <button onclick="approveWithdrawal('${id}', '${w.user_id}')" class="text-buy-green hover:underline text-sm mr-2">Approve</button>
                                                <button onclick="rejectWithdrawalPrompt('${id}', '${w.user_id}')" class="text-sell-red hover:underline text-sm">Reject</button>
                                            ` : `<span class="text-text-muted text-sm">${w.processed_at ? timeAgo(w.processed_at) : '-'}</span>`}
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }

        // ============ NFT MANAGEMENT TAB ============
        function renderAdminNFT() {
            const nfts = Object.entries(adminData.nfts);
            const active = nfts.filter(([_, n]) => n.status === 'active');
            const sold = nfts.filter(([_, n]) => n.status === 'sold');
            
            return `
                <div class="space-y-6">
                    <div class="flex flex-wrap gap-4 justify-between items-center">
                        <div class="flex gap-4">
                            <div class="bg-card border border-border rounded-xl p-4">
                                <div class="text-2xl font-bold text-purple-500">${active.length}</div>
                                <div class="text-sm text-text-secondary">Active</div>
                            </div>
                            <div class="bg-card border border-border rounded-xl p-4">
                                <div class="text-2xl font-bold text-buy-green">${sold.length}</div>
                                <div class="text-sm text-text-secondary">Sold</div>
                            </div>
                        </div>
                        <button onclick="showCreateNFTModal()" class="btn-primary px-6 py-3 rounded-xl font-semibold">
                            <i class="fas fa-plus mr-2"></i>Create New NFT
                        </button>
                    </div>

                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                        ${nfts.map(([id, nft]) => `
                            <div class="bg-card border border-border rounded-2xl overflow-hidden">
                                <div class="aspect-square bg-gradient-to-br from-purple-500/10 via-pink-500/10 to-accent-yellow/10 flex items-center justify-center relative">
                                    ${nft.image ? `<img src="${nft.image}" class="w-full h-full object-cover">` : `<i class="fas fa-image text-4xl text-text-muted"></i>`}
                                    <div class="absolute top-2 right-2">
                                        <span class="badge badge-${nft.status === 'active' ? 'approved' : nft.status === 'sold' ? 'pending' : 'rejected'}">${nft.status}</span>
                                    </div>
                                </div>
                                <div class="p-4">
                                    <h3 class="font-semibold truncate mb-1">${nft.name}</h3>
                                    <p class="text-xs text-text-muted mb-3">${nft.collection || 'General'}</p>
                                    <div class="flex justify-between items-center">
                                        <div class="font-mono text-accent-yellow">${nft.price} ${nft.currency}</div>
                                        <div class="flex gap-2">
                                            <button onclick="editNFT('${id}')" class="text-accent-yellow hover:bg-accent-yellow/10 p-2 rounded-lg transition">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button onclick="deleteNFT('${id}')" class="text-sell-red hover:bg-sell-red/10 p-2 rounded-lg transition">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    
                    ${nfts.length === 0 ? `
                        <div class="text-center py-12">
                            <i class="fas fa-image text-6xl text-text-muted mb-4"></i>
                            <h3 class="text-xl font-semibold mb-2">No NFTs Yet</h3>
                            <p class="text-text-secondary mb-4">Create your first NFT to get started</p>
                            <button onclick="showCreateNFTModal()" class="btn-primary px-6 py-3 rounded-xl">Create NFT</button>
                        </div>
                    ` : ''}
                </div>
            `;
        }

        // ============ ORDERS TAB ============
        function renderAdminOrders() {
            const allOrders = [];
            Object.entries(adminData.orders).forEach(([userId, userOrders]) => {
                Object.entries(userOrders).forEach(([orderId, order]) => {
                    allOrders.push({ ...order, id: orderId, user_id: userId });
                });
            });
            allOrders.sort((a, b) => new Date(b.created_at) - new Date(a.created_at));
            
            return `
                <div class="space-y-6">
                    <div class="bg-card border border-border rounded-2xl overflow-hidden">
                        <table class="w-full">
                            <thead>
                                <tr class="text-xs text-text-muted border-b border-border">
                                    <th class="text-left p-4">Order ID</th>
                                    <th class="text-left p-4">User</th>
                                    <th class="text-left p-4">Pair</th>
                                    <th class="text-left p-4">Type</th>
                                    <th class="text-left p-4">Side</th>
                                    <th class="text-left p-4">Price</th>
                                    <th class="text-left p-4">Amount</th>
                                    <th class="text-left p-4">Status</th>
                                    <th class="text-left p-4">Date</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${allOrders.map(o => `
                                    <tr class="border-b border-border hover:bg-card-hover transition">
                                        <td class="p-4 text-sm font-mono">${o.id.slice(0, 12)}...</td>
                                        <td class="p-4 text-sm">${o.user_id.slice(0, 8)}...</td>
                                        <td class="p-4 text-sm">${o.pair}</td>
                                        <td class="p-4 text-sm">${o.type}</td>
                                        <td class="p-4"><span class="${o.side === 'buy' ? 'text-buy-green' : 'text-sell-red'}">${o.side.toUpperCase()}</span></td>
                                        <td class="p-4 font-mono">${formatPrice(o.price)}</td>
                                        <td class="p-4 font-mono">${o.amount}</td>
                                        <td class="p-4"><span class="badge badge-${o.status}">${o.status}</span></td>
                                        <td class="p-4 text-sm text-text-muted">${timeAgo(o.created_at)}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }

        // ============ TRADES TAB ============
        function renderAdminTrades() {
            const allTrades = [];
            Object.entries(adminData.trades).forEach(([userId, userTrades]) => {
                Object.entries(userTrades).forEach(([tradeId, trade]) => {
                    allTrades.push({ ...trade, id: tradeId });
                });
            });
            allTrades.sort((a, b) => new Date(b.created_at) - new Date(a.created_at));
            
            const totalVolume = allTrades.reduce((a, b) => a + (b.price * b.amount), 0);
            const totalFees = allTrades.reduce((a, b) => a + (b.fee || 0), 0);
            
            return `
                <div class="space-y-6">
                    <div class="grid grid-cols-2 gap-4">
                        <div class="bg-card border border-border rounded-xl p-4">
                            <div class="text-sm text-text-secondary">Total Volume</div>
                            <div class="text-2xl font-bold">${formatCurrency(totalVolume)}</div>
                        </div>
                        <div class="bg-card border border-border rounded-xl p-4">
                            <div class="text-sm text-text-secondary">Total Fees</div>
                            <div class="text-2xl font-bold text-accent-yellow">${formatCurrency(totalFees)}</div>
                        </div>
                    </div>

                    <div class="bg-card border border-border rounded-2xl overflow-hidden">
                        <table class="w-full">
                            <thead>
                                <tr class="text-xs text-text-muted border-b border-border">
                                    <th class="text-left p-4">Trade ID</th>
                                    <th class="text-left p-4">Pair</th>
                                    <th class="text-left p-4">Side</th>
                                    <th class="text-left p-4">Price</th>
                                    <th class="text-left p-4">Amount</th>
                                    <th class="text-left p-4">Fee</th>
                                    <th class="text-left p-4">Date</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${allTrades.map(t => `
                                    <tr class="border-b border-border hover:bg-card-hover transition">
                                        <td class="p-4 text-sm font-mono">${t.id.slice(0, 12)}...</td>
                                        <td class="p-4 text-sm">${t.pair}</td>
                                        <td class="p-4"><span class="${t.side === 'buy' ? 'text-buy-green' : 'text-sell-red'}">${t.side.toUpperCase()}</span></td>
                                        <td class="p-4 font-mono">${formatPrice(t.price)}</td>
                                        <td class="p-4 font-mono">${t.amount}</td>
                                        <td class="p-4 font-mono text-accent-yellow">${formatCurrency(t.fee || 0)}</td>
                                        <td class="p-4 text-sm text-text-muted">${timeAgo(t.created_at)}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }

        // ============ KYC TAB ============
        function renderAdminKYC() {
            const kycList = Object.entries(adminData.kyc);
            const pending = kycList.filter(([_, k]) => k.status === 'pending');
            const approved = kycList.filter(([_, k]) => k.status === 'approved');
            const rejected = kycList.filter(([_, k]) => k.status === 'rejected');
            
            return `
                <div class="space-y-6">
                    <div class="grid grid-cols-3 gap-4">
                        <div class="bg-card border border-border rounded-xl p-4 text-center">
                            <div class="text-2xl font-bold text-accent-yellow">${pending.length}</div>
                            <div class="text-sm text-text-secondary">Pending</div>
                        </div>
                        <div class="bg-card border border-border rounded-xl p-4 text-center">
                            <div class="text-2xl font-bold text-buy-green">${approved.length}</div>
                            <div class="text-sm text-text-secondary">Approved</div>
                        </div>
                        <div class="bg-card border border-border rounded-xl p-4 text-center">
                            <div class="text-2xl font-bold text-sell-red">${rejected.length}</div>
                            <div class="text-sm text-text-secondary">Rejected</div>
                        </div>
                    </div>

                    <div class="bg-card border border-border rounded-2xl overflow-hidden">
                        <table class="w-full">
                            <thead>
                                <tr class="text-xs text-text-muted border-b border-border">
                                    <th class="text-left p-4">User</th>
                                    <th class="text-left p-4">Name</th>
                                    <th class="text-left p-4">Document</th>
                                    <th class="text-left p-4">Status</th>
                                    <th class="text-left p-4">Submitted</th>
                                    <th class="text-right p-4">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${kycList.map(([userId, k]) => `
                                    <tr class="border-b border-border hover:bg-card-hover transition">
                                        <td class="p-4 text-sm">${userId.slice(0, 12)}...</td>
                                        <td class="p-4 text-sm">${k.name || '-'}</td>
                                        <td class="p-4 text-sm">${k.document_type || 'ID'}</td>
                                        <td class="p-4"><span class="badge badge-${k.status}">${k.status}</span></td>
                                        <td class="p-4 text-sm text-text-muted">${timeAgo(k.submitted_at)}</td>
                                        <td class="p-4 text-right">
                                            ${k.status === 'pending' ? `
                                                <button onclick="viewKYCDetails('${userId}')" class="text-accent-yellow hover:underline text-sm mr-2">View</button>
                                                <button onclick="approveKYC('${userId}')" class="text-buy-green hover:underline text-sm mr-2">Approve</button>
                                                <button onclick="rejectKYCPrompt('${userId}')" class="text-sell-red hover:underline text-sm">Reject</button>
                                            ` : `<span class="text-text-muted text-sm">${k.processed_at ? timeAgo(k.processed_at) : '-'}</span>`}
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }

        // ============ PAYMENT METHODS TAB ============
        function renderAdminPaymentMethods() {
            const pm = adminData.paymentMethods;
            
            return `
                <div class="space-y-6">
                    <!-- UPI Settings -->
                    <div class="bg-card border border-border rounded-2xl p-6">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold flex items-center gap-2">
                                <i class="fas fa-qrcode text-accent-yellow"></i> UPI Payment
                            </h3>
                            <label class="flex items-center gap-2">
                                <input type="checkbox" ${pm.upi?.status === 'active' ? 'checked' : ''} onchange="togglePaymentMethod('upi', this.checked)" class="w-4 h-4 accent-accent-yellow">
                                <span class="text-sm">Active</span>
                            </label>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm text-text-secondary mb-2">UPI ID</label>
                                <input type="text" id="upi-id" value="${pm.upi?.upiId || ''}" class="input-field w-full px-4 py-3 rounded-xl" placeholder="yourname@upi">
                            </div>
                            <div>
                                <label class="block text-sm text-text-secondary mb-2">QR Code URL</label>
                                <input type="text" id="upi-qr" value="${pm.upi?.qrCode || ''}" class="input-field w-full px-4 py-3 rounded-xl" placeholder="https://...">
                            </div>
                            <div>
                                <label class="block text-sm text-text-secondary mb-2">Min Amount</label>
                                <input type="number" id="upi-min" value="${pm.upi?.min || 100}" class="input-field w-full px-4 py-3 rounded-xl">
                            </div>
                            <div>
                                <label class="block text-sm text-text-secondary mb-2">Max Amount</label>
                                <input type="number" id="upi-max" value="${pm.upi?.max || 100000}" class="input-field w-full px-4 py-3 rounded-xl">
                            </div>
                        </div>
                        <button onclick="savePaymentMethod('upi')" class="btn-primary px-6 py-2 rounded-xl mt-4">Save UPI Settings</button>
                    </div>

                    <!-- Bank Settings -->
                    <div class="bg-card border border-border rounded-2xl p-6">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold flex items-center gap-2">
                                <i class="fas fa-university text-buy-green"></i> Bank Transfer
                            </h3>
                            <label class="flex items-center gap-2">
                                <input type="checkbox" ${pm.bank?.status === 'active' ? 'checked' : ''} onchange="togglePaymentMethod('bank', this.checked)" class="w-4 h-4 accent-buy-green">
                                <span class="text-sm">Active</span>
                            </label>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm text-text-secondary mb-2">Account Name</label>
                                <input type="text" id="bank-name" value="${pm.bank?.accountName || ''}" class="input-field w-full px-4 py-3 rounded-xl">
                            </div>
                            <div>
                                <label class="block text-sm text-text-secondary mb-2">Account Number</label>
                                <input type="text" id="bank-account" value="${pm.bank?.accountNumber || ''}" class="input-field w-full px-4 py-3 rounded-xl">
                            </div>
                            <div>
                                <label class="block text-sm text-text-secondary mb-2">IFSC Code</label>
                                <input type="text" id="bank-ifsc" value="${pm.bank?.ifsc || ''}" class="input-field w-full px-4 py-3 rounded-xl">
                            </div>
                            <div>
                                <label class="block text-sm text-text-secondary mb-2">Bank Name</label>
                                <input type="text" id="bank-bank" value="${pm.bank?.bankName || ''}" class="input-field w-full px-4 py-3 rounded-xl">
                            </div>
                            <div>
                                <label class="block text-sm text-text-secondary mb-2">Min Amount</label>
                                <input type="number" id="bank-min" value="${pm.bank?.min || 500}" class="input-field w-full px-4 py-3 rounded-xl">
                            </div>
                            <div>
                                <label class="block text-sm text-text-secondary mb-2">Max Amount</label>
                                <input type="number" id="bank-max" value="${pm.bank?.max || 500000}" class="input-field w-full px-4 py-3 rounded-xl">
                            </div>
                        </div>
                        <button onclick="savePaymentMethod('bank')" class="btn-primary px-6 py-2 rounded-xl mt-4">Save Bank Settings</button>
                    </div>

                    <!-- Crypto Settings -->
                    <div class="bg-card border border-border rounded-2xl p-6">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold flex items-center gap-2">
                                <i class="fab fa-bitcoin text-purple-500"></i> Cryptocurrency
                            </h3>
                            <label class="flex items-center gap-2">
                                <input type="checkbox" ${pm.crypto?.status === 'active' ? 'checked' : ''} onchange="togglePaymentMethod('crypto', this.checked)" class="w-4 h-4 accent-purple-500">
                                <span class="text-sm">Active</span>
                            </label>
                        </div>
                        <div class="space-y-4">
                            ${Object.entries(pm.crypto?.addresses || {}).map(([network, address]) => `
                                <div>
                                    <label class="block text-sm text-text-secondary mb-2">${network} Address</label>
                                    <input type="text" id="crypto-${network}" value="${address}" class="input-field w-full px-4 py-3 rounded-xl font-mono text-sm">
                                </div>
                            `).join('')}
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm text-text-secondary mb-2">Min Amount</label>
                                    <input type="number" id="crypto-min" value="${pm.crypto?.min || 10}" class="input-field w-full px-4 py-3 rounded-xl">
                                </div>
                                <div>
                                    <label class="block text-sm text-text-secondary mb-2">Max Amount</label>
                                    <input type="number" id="crypto-max" value="${pm.crypto?.max || 1000000}" class="input-field w-full px-4 py-3 rounded-xl">
                                </div>
                            </div>
                        </div>
                        <button onclick="savePaymentMethod('crypto')" class="btn-primary px-6 py-2 rounded-xl mt-4">Save Crypto Settings</button>
                    </div>
                </div>
            `;
        }

        // ============ ANNOUNCEMENTS TAB ============
        function renderAdminAnnouncements() {
            return `
                <div class="space-y-6">
                    <div class="flex justify-between items-center">
                        <h3 class="text-lg font-semibold">All Announcements</h3>
                        <button onclick="showAddAnnouncementModal()" class="btn-primary px-4 py-2 rounded-xl text-sm font-semibold">
                            <i class="fas fa-plus mr-2"></i>Add Announcement
                        </button>
                    </div>

                    <div class="space-y-4">
                        ${adminData.announcements.length === 0 ? `
                            <div class="text-center py-12 bg-card border border-border rounded-2xl">
                                <i class="fas fa-bullhorn text-4xl text-text-muted mb-4"></i>
                                <p class="text-text-secondary">No announcements yet</p>
                            </div>
                        ` : adminData.announcements.map((a, i) => `
                            <div class="bg-card border border-border rounded-2xl p-6">
                                <div class="flex justify-between items-start mb-3">
                                    <div>
                                        <h4 class="font-semibold text-lg">${a.title}</h4>
                                        <div class="text-sm text-text-muted">${timeAgo(a.created_at)}</div>
                                    </div>
                                    <div class="flex gap-2">
                                        <button onclick="editAnnouncement(${i})" class="text-accent-yellow hover:bg-accent-yellow/10 p-2 rounded-lg transition">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button onclick="deleteAnnouncement(${i})" class="text-sell-red hover:bg-sell-red/10 p-2 rounded-lg transition">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </div>
                                <p class="text-text-secondary">${a.content}</p>
                                ${a.link ? `<a href="${a.link}" target="_blank" class="text-accent-yellow text-sm mt-2 inline-block">Learn more <i class="fas fa-arrow-right ml-1"></i></a>` : ''}
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        // ============ TRADING PAIRS TAB ============
        function renderAdminTradingPairs() {
            return `
                <div class="space-y-6">
                    <div class="flex justify-between items-center">
                        <h3 class="text-lg font-semibold">Trading Pairs</h3>
                        <button onclick="showAddPairModal()" class="btn-primary px-4 py-2 rounded-xl text-sm font-semibold">
                            <i class="fas fa-plus mr-2"></i>Add Pair
                        </button>
                    </div>

                    <div class="bg-card border border-border rounded-2xl overflow-hidden">
                        <table class="w-full">
                            <thead>
                                <tr class="text-xs text-text-muted border-b border-border">
                                    <th class="text-left p-4">Pair</th>
                                    <th class="text-left p-4">Base</th>
                                    <th class="text-left p-4">Quote</th>
                                    <th class="text-left p-4">Price</th>
                                    <th class="text-left p-4">24h Change</th>
                                    <th class="text-left p-4">Status</th>
                                    <th class="text-right p-4">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${CONFIG.pairs.map((p, i) => `
                                    <tr class="border-b border-border hover:bg-card-hover transition">
                                        <td class="p-4 font-semibold">${p.symbol}</td>
                                        <td class="p-4 text-sm">${p.base}</td>
                                        <td class="p-4 text-sm">${p.quote}</td>
                                        <td class="p-4 font-mono">${formatPrice(p.price)}</td>
                                        <td class="p-4 ${p.change >= 0 ? 'text-buy-green' : 'text-sell-red'}">${p.change >= 0 ? '+' : ''}${p.change.toFixed(2)}%</td>
                                        <td class="p-4"><span class="badge badge-approved">Active</span></td>
                                        <td class="p-4 text-right">
                                            <button onclick="editPair(${i})" class="text-accent-yellow hover:underline text-sm mr-3">Edit</button>
                                            <button onclick="togglePair(${i})" class="text-sell-red hover:underline text-sm">Disable</button>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }

        // ============ SITE SETTINGS TAB ============
        function renderAdminSiteSettings() {
            const s = adminData.settings;
            return `
                <div class="space-y-6">
                    <div class="bg-card border border-border rounded-2xl p-6">
                        <h3 class="text-lg font-semibold mb-4">General Settings</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm text-text-secondary mb-2">Site Name</label>
                                <input type="text" id="site-name" value="${s.name || 'TREDING.STORE'}" class="input-field w-full px-4 py-3 rounded-xl">
                            </div>
                            <div>
                                <label class="block text-sm text-text-secondary mb-2">Logo Emoji</label>
                                <input type="text" id="site-logo" value="${s.logo || 'ðŸ“ˆ'}" class="input-field w-full px-4 py-3 rounded-xl">
                            </div>
                            <div>
                                <label class="block text-sm text-text-secondary mb-2">Primary Color</label>
                                <input type="color" id="site-color" value="${s.primaryColor || '#F0B90B'}" class="w-full h-12 rounded-xl">
                            </div>
                            <div>
                                <label class="block text-sm text-text-secondary mb-2">Trading Fee (%)</label>
                                <input type="number" id="site-fee" value="${s.tradingFee || 0.1}" step="0.01" class="input-field w-full px-4 py-3 rounded-xl">
                            </div>
                        </div>
                    </div>

                    <div class="bg-card border border-border rounded-2xl p-6">
                        <h3 class="text-lg font-semibold mb-4">Deposit/Withdrawal Limits</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm text-text-secondary mb-2">Min Deposit ($)</label>
                                <input type="number" id="min-deposit" value="${s.minDeposit || 10}" class="input-field w-full px-4 py-3 rounded-xl">
                            </div>
                            <div>
                                <label class="block text-sm text-text-secondary mb-2">Max Deposit ($)</label>
                                <input type="number" id="max-deposit" value="${s.maxDeposit || 100000}" class="input-field w-full px-4 py-3 rounded-xl">
                            </div>
                            <div>
                                <label class="block text-sm text-text-secondary mb-2">Min Withdrawal ($)</label>
                                <input type="number" id="min-withdrawal" value="${s.minWithdrawal || 10}" class="input-field w-full px-4 py-3 rounded-xl">
                            </div>
                            <div>
                                <label class="block text-sm text-text-secondary mb-2">Max Withdrawal ($)</label>
                                <input type="number" id="max-withdrawal" value="${s.maxWithdrawal || 50000}" class="input-field w-full px-4 py-3 rounded-xl">
                            </div>
                        </div>
                    </div>

                    <div class="bg-card border border-border rounded-2xl p-6">
                        <h3 class="text-lg font-semibold mb-4">Maintenance Mode</h3>
                        <label class="flex items-center gap-3">
                            <input type="checkbox" id="maintenance-mode" ${s.maintenanceMode ? 'checked' : ''} class="w-5 h-5 accent-accent-yellow">
                            <span>Enable Maintenance Mode</span>
                        </label>
                        <p class="text-sm text-text-muted mt-2">When enabled, only admins can access the site.</p>
                    </div>

                    <button onclick="saveSiteSettings()" class="btn-primary px-8 py-3 rounded-xl font-semibold">
                        <i class="fas fa-save mr-2"></i>Save All Settings
                    </button>
                </div>
            `;
        }

        // ============ WALLET MANAGER TAB ============
        function renderAdminWalletManager() {
            return `
                <div class="space-y-6">
                    <div class="bg-card border border-border rounded-2xl p-6">
                        <h3 class="text-lg font-semibold mb-4">Adjust User Balance</h3>
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                            <div>
                                <label class="block text-sm text-text-secondary mb-2">User ID / Email</label>
                                <input type="text" id="wallet-user" class="input-field w-full px-4 py-3 rounded-xl" placeholder="Enter user ID or email">
                            </div>
                            <div>
                                <label class="block text-sm text-text-secondary mb-2">Coin</label>
                                <select id="wallet-coin" class="input-field w-full px-4 py-3 rounded-xl">
                                    <option value="USDT">USDT</option>
                                    <option value="BTC">BTC</option>
                                    <option value="ETH">ETH</option>
                                    <option value="BNB">BNB</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm text-text-secondary mb-2">Amount</label>
                                <input type="number" id="wallet-amount" class="input-field w-full px-4 py-3 rounded-xl" placeholder="Enter amount">
                            </div>
                            <div>
                                <label class="block text-sm text-text-secondary mb-2">Action</label>
                                <div class="flex gap-2">
                                    <button onclick="adjustBalance('add')" class="flex-1 bg-buy-green hover:bg-buy-green-dark text-white py-3 rounded-xl font-semibold">Add</button>
                                    <button onclick="adjustBalance('subtract')" class="flex-1 bg-sell-red hover:bg-sell-red-dark text-white py-3 rounded-xl font-semibold">Deduct</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="bg-card border border-border rounded-2xl p-6">
                        <h3 class="text-lg font-semibold mb-4">Bulk Operations</h3>
                        <div class="flex gap-4">
                            <button onclick="showBulkAddModal()" class="px-4 py-2 bg-card-hover border border-border rounded-xl hover:border-buy-green transition">
                                <i class="fas fa-plus-circle text-buy-green mr-2"></i>Bulk Add
                            </button>
                            <button onclick="showBulkDeductModal()" class="px-4 py-2 bg-card-hover border border-border rounded-xl hover:border-sell-red transition">
                                <i class="fas fa-minus-circle text-sell-red mr-2"></i>Bulk Deduct
                            </button>
                            <button onclick="exportWalletData()" class="px-4 py-2 bg-card-hover border border-border rounded-xl hover:border-accent-yellow transition">
                                <i class="fas fa-download text-accent-yellow mr-2"></i>Export Data
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        // ============ REPORTS TAB ============
        function renderAdminReports() {
            const deposits = Object.values(adminData.deposits);
            const withdrawals = Object.values(adminData.withdrawals);
            const totalDeposit = deposits.filter(d => d.status === 'approved').reduce((a, b) => a + b.amount, 0);
            const totalWithdrawal = withdrawals.filter(w => w.status === 'approved').reduce((a, b) => a + b.amount, 0);
            
            return `
                <div class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="bg-card border border-border rounded-2xl p-6">
                            <div class="text-text-secondary text-sm mb-2">Total Deposits (Approved)</div>
                            <div class="text-3xl font-bold text-buy-green">${formatCurrency(totalDeposit)}</div>
                        </div>
                        <div class="bg-card border border-border rounded-2xl p-6">
                            <div class="text-text-secondary text-sm mb-2">Total Withdrawals (Approved)</div>
                            <div class="text-3xl font-bold text-sell-red">${formatCurrency(totalWithdrawal)}</div>
                        </div>
                        <div class="bg-card border border-border rounded-2xl p-6">
                            <div class="text-text-secondary text-sm mb-2">Net Balance</div>
                            <div class="text-3xl font-bold ${totalDeposit - totalWithdrawal >= 0 ? 'text-buy-green' : 'text-sell-red'}">${formatCurrency(totalDeposit - totalWithdrawal)}</div>
                        </div>
                    </div>

                    <div class="bg-card border border-border rounded-2xl p-6">
                        <h3 class="text-lg font-semibold mb-4">Generate Report</h3>
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                            <div>
                                <label class="block text-sm text-text-secondary mb-2">Report Type</label>
                                <select id="report-type" class="input-field w-full px-4 py-3 rounded-xl">
                                    <option value="deposits">Deposits</option>
                                    <option value="withdrawals">Withdrawals</option>
                                    <option value="trades">Trades</option>
                                    <option value="users">Users</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm text-text-secondary mb-2">From Date</label>
                                <input type="date" id="report-from" class="input-field w-full px-4 py-3 rounded-xl">
                            </div>
                            <div>
                                <label class="block text-sm text-text-secondary mb-2">To Date</label>
                                <input type="date" id="report-to" class="input-field w-full px-4 py-3 rounded-xl">
                            </div>
                            <div class="flex items-end">
                                <button onclick="generateReport()" class="btn-primary w-full py-3 rounded-xl font-semibold">
                                    <i class="fas fa-file-alt mr-2"></i>Generate
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // ============ ADMIN ACTION FUNCTIONS ============
        function switchAdminTab(tabId) {
            adminCurrentTab = tabId;
            navigateTo('admin');
        }

        async function savePaymentMethod(type) {
            let data = { status: document.querySelector(`input[onchange*="'${type}'"]`)?.checked ? 'active' : 'inactive' };
            
            if (type === 'upi') {
                data.upiId = document.getElementById('upi-id').value;
                data.qrCode = document.getElementById('upi-qr').value;
                data.min = parseFloat(document.getElementById('upi-min').value);
                data.max = parseFloat(document.getElementById('upi-max').value);
            } else if (type === 'bank') {
                data.accountName = document.getElementById('bank-name').value;
                data.accountNumber = document.getElementById('bank-account').value;
                data.ifsc = document.getElementById('bank-ifsc').value;
                data.bankName = document.getElementById('bank-bank').value;
                data.min = parseFloat(document.getElementById('bank-min').value);
                data.max = parseFloat(document.getElementById('bank-max').value);
            } else if (type === 'crypto') {
                data.addresses = {};
                document.querySelectorAll('[id^="crypto-"]').forEach(input => {
                    if (input.id !== 'crypto-min' && input.id !== 'crypto-max') {
                        const network = input.id.replace('crypto-', '');
                        data.addresses[network] = input.value;
                    }
                });
                data.min = parseFloat(document.getElementById('crypto-min').value);
                data.max = parseFloat(document.getElementById('crypto-max').value);
            }
            
            await firebaseDB.ref(`admin/payment_methods/${type}`).set(data);
            adminData.paymentMethods[type] = data;
            state.paymentMethods[type] = data;
            showToast('Payment method saved', 'success');
        }

        async function togglePaymentMethod(type, isActive) {
            await firebaseDB.ref(`admin/payment_methods/${type}/status`).set(isActive ? 'active' : 'inactive');
            adminData.paymentMethods[type].status = isActive ? 'active' : 'inactive';
            state.paymentMethods[type].status = isActive ? 'active' : 'inactive';
        }

        async function saveSiteSettings() {
            const settings = {
                name: document.getElementById('site-name').value,
                logo: document.getElementById('site-logo').value,
                primaryColor: document.getElementById('site-color').value,
                tradingFee: parseFloat(document.getElementById('site-fee').value),
                minDeposit: parseFloat(document.getElementById('min-deposit').value),
                maxDeposit: parseFloat(document.getElementById('max-deposit').value),
                minWithdrawal: parseFloat(document.getElementById('min-withdrawal').value),
                maxWithdrawal: parseFloat(document.getElementById('max-withdrawal').value),
                maintenanceMode: document.getElementById('maintenance-mode').checked
            };
            
            await firebaseDB.ref('admin/settings').set(settings);
            adminData.settings = settings;
            CONFIG.siteSettings = settings;
            showToast('Settings saved successfully', 'success');
        }

        function showAddAnnouncementModal() {
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal-content max-w-md w-full p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-bold">Add Announcement</h2>
                        <button onclick="this.closest('.modal-overlay').remove()" class="text-text-muted hover:text-text-primary">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm text-text-secondary mb-2">Title</label>
                            <input type="text" id="ann-title" class="input-field w-full px-4 py-3 rounded-xl" placeholder="Enter title">
                        </div>
                        <div>
                            <label class="block text-sm text-text-secondary mb-2">Content</label>
                            <textarea id="ann-content" class="input-field w-full px-4 py-3 rounded-xl" rows="4" placeholder="Enter announcement content"></textarea>
                        </div>
                        <div>
                            <label class="block text-sm text-text-secondary mb-2">Link (optional)</label>
                            <input type="text" id="ann-link" class="input-field w-full px-4 py-3 rounded-xl" placeholder="https://...">
                        </div>
                        <button onclick="addAnnouncement()" class="btn-primary w-full py-3 rounded-xl font-semibold">Add Announcement</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        async function addAnnouncement() {
            const title = document.getElementById('ann-title').value;
            const content = document.getElementById('ann-content').value;
            const link = document.getElementById('ann-link').value;
            
            if (!title || !content) {
                showToast('Please fill all required fields', 'error');
                return;
            }
            
            const announcement = {
                id: generateId(),
                title, content, link,
                created_at: getCurrentTimestamp()
            };
            
            await firebaseDB.ref(`admin/announcements/${announcement.id}`).set(announcement);
            adminData.announcements.push(announcement);
            document.querySelector('.modal-overlay').remove();
            showToast('Announcement added', 'success');
            navigateTo('admin');
        }

        async function deleteAnnouncement(index) {
            const ann = adminData.announcements[index];
            if (confirm('Delete this announcement?')) {
                await firebaseDB.ref(`admin/announcements/${ann.id}`).remove();
                adminData.announcements.splice(index, 1);
                showToast('Announcement deleted', 'success');
                navigateTo('admin');
            }
        }

        async function editNFT(id) {
            const nft = adminData.nfts[id];
            if (!nft) return;
            
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal-content max-w-md w-full p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-bold">Edit NFT</h2>
                        <button onclick="this.closest('.modal-overlay').remove()" class="text-text-muted hover:text-text-primary">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm text-text-secondary mb-2">Name</label>
                            <input type="text" id="edit-nft-name" class="input-field w-full px-4 py-3 rounded-xl" value="${nft.name}">
                        </div>
                        <div>
                            <label class="block text-sm text-text-secondary mb-2">Price (USDT)</label>
                            <input type="number" id="edit-nft-price" class="input-field w-full px-4 py-3 rounded-xl" value="${nft.price}">
                        </div>
                        <div>
                            <label class="block text-sm text-text-secondary mb-2">Status</label>
                            <select id="edit-nft-status" class="input-field w-full px-4 py-3 rounded-xl">
                                <option value="active" ${nft.status === 'active' ? 'selected' : ''}>Active</option>
                                <option value="sold" ${nft.status === 'sold' ? 'selected' : ''}>Sold</option>
                                <option value="inactive" ${nft.status === 'inactive' ? 'selected' : ''}>Inactive</option>
                            </select>
                        </div>
                        <button onclick="saveNFTEdit('${id}')" class="btn-primary w-full py-3 rounded-xl font-semibold">Save Changes</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        async function saveNFTEdit(id) {
            const updates = {
                name: document.getElementById('edit-nft-name').value,
                price: parseFloat(document.getElementById('edit-nft-price').value),
                status: document.getElementById('edit-nft-status').value
            };
            
            await firebaseDB.ref(`nft_listings/${id}`).update(updates);
            adminData.nfts[id] = { ...adminData.nfts[id], ...updates };
            document.querySelector('.modal-overlay').remove();
            showToast('NFT updated', 'success');
            navigateTo('admin');
        }

        async function deleteNFT(id) {
            if (confirm('Are you sure you want to delete this NFT?')) {
                await firebaseDB.ref(`nft_listings/${id}`).remove();
                delete adminData.nfts[id];
                showToast('NFT deleted', 'success');
                navigateTo('admin');
            }
        }

        function showUserDetails(userId) {
            const user = adminData.users[userId];
            if (!user) return;
            
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal-content max-w-lg w-full p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-bold">User Details</h2>
                        <button onclick="this.closest('.modal-overlay').remove()" class="text-text-muted hover:text-text-primary">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    <div class="flex items-center gap-4 mb-6">
                        <img src="${user.avatar}" class="w-16 h-16 rounded-full">
                        <div>
                            <div class="font-semibold text-lg">${user.name || 'Unknown'}</div>
                            <div class="text-text-muted">${user.email}</div>
                            <div class="text-xs text-text-muted mt-1">ID: ${userId}</div>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-4 mb-6">
                        <div class="bg-card-hover p-3 rounded-xl">
                            <div class="text-sm text-text-muted">Status</div>
                            <div class="${user.is_active ? 'text-buy-green' : 'text-sell-red'}">${user.is_active ? 'Active' : 'Blocked'}</div>
                        </div>
                        <div class="bg-card-hover p-3 rounded-xl">
                            <div class="text-sm text-text-muted">KYC Status</div>
                            <div class="capitalize">${user.kyc_status || 'Pending'}</div>
                        </div>
                        <div class="bg-card-hover p-3 rounded-xl">
                            <div class="text-sm text-text-muted">Joined</div>
                            <div>${new Date(user.created_at).toLocaleDateString()}</div>
                        </div>
                        <div class="bg-card-hover p-3 rounded-xl">
                            <div class="text-sm text-text-muted">Verified</div>
                            <div>${user.is_verified ? 'Yes' : 'No'}</div>
                        </div>
                    </div>
                    <div class="flex gap-3">
                        <button onclick="toggleUserStatus('${userId}', ${!user.is_active}); this.closest('.modal-overlay').remove()" class="flex-1 ${user.is_active ? 'bg-sell-red' : 'bg-buy-green'} text-white py-3 rounded-xl font-semibold">
                            ${user.is_active ? 'Block User' : 'Unblock User'}
                        </button>
                        <button onclick="showAdjustBalanceModal('${userId}'); this.closest('.modal-overlay').remove()" class="flex-1 bg-accent-yellow text-bg py-3 rounded-xl font-semibold">
                            Adjust Balance
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function showAdjustBalanceModal(userId) {
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal-content max-w-md w-full p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-bold">Adjust Balance</h2>
                        <button onclick="this.closest('.modal-overlay').remove()" class="text-text-muted hover:text-text-primary">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm text-text-secondary mb-2">Coin</label>
                            <select id="adj-coin" class="input-field w-full px-4 py-3 rounded-xl">
                                <option value="USDT">USDT</option>
                                <option value="BTC">BTC</option>
                                <option value="ETH">ETH</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm text-text-secondary mb-2">Amount</label>
                            <input type="number" id="adj-amount" class="input-field w-full px-4 py-3 rounded-xl" placeholder="Enter amount">
                        </div>
                        <div class="flex gap-3">
                            <button onclick="adjustUserBalance('${userId}', 'add')" class="flex-1 bg-buy-green text-white py-3 rounded-xl font-semibold">Add</button>
                            <button onclick="adjustUserBalance('${userId}', 'subtract')" class="flex-1 bg-sell-red text-white py-3 rounded-xl font-semibold">Deduct</button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        async function adjustUserBalance(userId, action) {
            const coin = document.getElementById('adj-coin').value;
            const amount = parseFloat(document.getElementById('adj-amount').value);
            
            if (!amount || amount <= 0) {
                showToast('Please enter a valid amount', 'error');
                return;
            }
            
            const walletRef = firebaseDB.ref(`wallets/${userId}/spot/${coin}`);
            const currentSnap = await walletRef.once('value');
            const current = currentSnap.val() || 0;
            
            const newBalance = action === 'add' ? current + amount : Math.max(0, current - amount);
            await walletRef.set(newBalance);
            
            document.querySelector('.modal-overlay').remove();
            showToast(`Balance ${action === 'add' ? 'added' : 'deducted'} successfully`, 'success');
        }

        async function approveKYC(userId) {
            await firebaseDB.ref(`users/${userId}`).update({ kyc_status: 'approved' });
            await firebaseDB.ref(`kyc/${userId}`).update({ status: 'approved', processed_at: getCurrentTimestamp() });
            adminData.users[userId].kyc_status = 'approved';
            showToast('KYC approved', 'success');
            navigateTo('admin');
        }

        async function rejectKYCPrompt(userId) {
            const reason = prompt('Enter rejection reason:');
            if (reason) {
                await firebaseDB.ref(`users/${userId}`).update({ kyc_status: 'rejected' });
                await firebaseDB.ref(`kyc/${userId}`).update({ status: 'rejected', rejection_reason: reason, processed_at: getCurrentTimestamp() });
                adminData.users[userId].kyc_status = 'rejected';
                showToast('KYC rejected', 'info');
                navigateTo('admin');
            }
        }

        function filterDeposits(status, btn) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            btn.classList.add('active');
            
            document.querySelectorAll('.deposit-row').forEach(row => {
                if (status === 'all' || row.dataset.status === status) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }

        function filterUsers() {
            const search = document.getElementById('user-search')?.value.toLowerCase() || '';
            const filter = document.getElementById('user-filter')?.value || 'all';
            
            document.querySelectorAll('#users-table-body tr').forEach(row => {
                const userId = row.dataset.userId;
                const user = adminData.users[userId];
                let show = true;
                
                if (search && !user.name?.toLowerCase().includes(search) && !user.email?.toLowerCase().includes(search)) {
                    show = false;
                }
                
                if (filter === 'active' && !user.is_active) show = false;
                if (filter === 'blocked' && user.is_active) show = false;
                if (filter === 'pending_kyc' && user.kyc_status !== 'pending') show = false;
                
                row.style.display = show ? '' : 'none';
            });
        }

        // Update the navigateTo function to use the new admin panel
        const originalNavigateTo = navigateTo;
        navigateTo = function(page) {
            if (page === 'admin') {
                state.currentPage = page;
                const app = document.getElementById('app');
                loadAllAdminData().then(() => {
                    app.innerHTML = renderFullAdmin();
                });
            } else {
                originalNavigateTo(page);
            }
        };
